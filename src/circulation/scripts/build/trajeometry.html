<!DOCTYPE html>
<!-- Generated by Cython 0.29.32 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: trajeometry.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
.cython .hll { background-color: #ffffcc }
.cython  { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.32</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="trajeometry.cpp">trajeometry.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># distutils: language=c++</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="c"># cython: boundscheck=False, wraparound=False, initializedcheck=False</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="c">#   Copyright 2023 Grégori MIGNEROT, Élian BELMONTE, Benjamin STACH</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="c">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="c">#   you may not use this file except in compliance with the License.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c">#   You may obtain a copy of the License at</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="c">#       http://www.apache.org/licenses/LICENSE-2.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="c">#   Unless required by applicable law or agreed to in writing, software</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="c">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: <span class="c">#   See the License for the specific language governing permissions and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="c">#   limitations under the License.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="sd">Module that does all the basic discrete curve geometry for the rest of the program</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">022</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">INFINITY</span><span class="p">,</span> <span class="n">NAN</span><span class="p">,</span> <span class="n">M_PI</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="k">from</span> <span class="nn">libc.stdlib</span> <span class="k">cimport</span> <span class="n">malloc</span><span class="p">,</span> <span class="n">free</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="k">from</span> <span class="nn">libcpp.vector</span> <span class="k">cimport</span> <span class="n">vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="c"># Return value of _project_on_curve_index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="k">cdef</span> <span class="k">struct</span> <span class="nf">_ProjectionIndex</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: 	<span class="nb">int</span> <span class="n">index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: 	<span class="n">double</span> <span class="n">vector_factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="c"># Return value of _next_point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: <span class="k">cdef</span> <span class="k">struct</span> <span class="nf">_NextPoint</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: 	<span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: 	<span class="nb">int</span> <span class="n">index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: 	<span class="n">double</span> <span class="n">vector_factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">040</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">_acos_clip</span><span class="p">(</span><span class="n">double</span> <span class="n">val</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>static double __pyx_f_11trajeometry__acos_clip(double __pyx_v_val) {
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">041</span>: 	<span class="sd">&quot;&quot;&quot;Utility function, when we try to get the angle between two vectors using the dot product,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="sd">	   sometimes floating-points shenanigans make the cos value get a little bit outside [-1, 1],</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">	   so this puts it back into the right range and computes the arccos&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">044</span>: 	<span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_val &lt; -1.0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">045</span>: 		<span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_r = acos(-1.0);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>: 	<span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_val &gt; 1.0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">047</span>: 		<span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_r = acos(1.0);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">048</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>: 		<span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = acos(__pyx_v_val);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">vector_angle</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">v1</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">v2</span><span class="p">):</span></pre>
<pre class='cython code score-39 '>static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static double __pyx_f_11trajeometry_vector_angle(__Pyx_memviewslice __pyx_v_v1, __Pyx_memviewslice __pyx_v_v2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_dotproduct;
  double __pyx_v_v1_norm;
  double __pyx_v_v2_norm;
  Py_ssize_t __pyx_v_i;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("vector_angle", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_vector_angle[] = "Compute the relative angle between two n-dimensional vectors\n\t   - v1 : double[D] : First vector\n\t   - v2 : double[D] : Second vector\n\t&lt;-------- double    : Relative angle in radians\n\t";
static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_v1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("vector_angle (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_v2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("vector_angle", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "vector_angle") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_v1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_v1.memview)) __PYX_ERR(0, 52, __pyx_L3_error)</span>
    __pyx_v_v2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_v2.memview)) __PYX_ERR(0, 52, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("vector_angle", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_vector_angle(__pyx_self, __pyx_v_v1, __pyx_v_v2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_vector_angle(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_v1, __Pyx_memviewslice __pyx_v_v2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("vector_angle", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_11trajeometry_vector_angle(__pyx_v_v1, __pyx_v_v2, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v2, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">053</span>: 	<span class="sd">&quot;&quot;&quot;Compute the relative angle between two n-dimensional vectors</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">	   - v1 : double[D] : First vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">	   - v2 : double[D] : Second vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: <span class="sd">	&lt;-------- double    : Relative angle in radians</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: 	<span class="c"># Use the usual dot product formula, arccos(v₁·v₂ / (||v₁|| × ||v₂||))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dotproduct</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="n">v1_norm</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="n">v2_norm</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dotproduct = 0.0;
  __pyx_v_v1_norm = 0.0;
  __pyx_v_v2_norm = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">060</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_v1.shape[0]);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>: 		<span class="n">dotproduct</span> <span class="o">+=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_dotproduct = (__pyx_v_dotproduct + ((*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_4 * __pyx_v_v1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_5 * __pyx_v_v2.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>: 		<span class="n">v1_norm</span> <span class="o">+=</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_v1_norm = (__pyx_v_v1_norm + ((*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_5 * __pyx_v_v1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_4 * __pyx_v_v1.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>: 		<span class="n">v2_norm</span> <span class="o">+=</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_v2_norm = (__pyx_v_v2_norm + ((*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_4 * __pyx_v_v2.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_5 * __pyx_v_v2.strides[0]) )))));
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>: 	<span class="k">return</span> <span class="n">_acos_clip</span><span class="p">(</span><span class="n">dotproduct</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v1_norm</span><span class="p">)</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2_norm</span><span class="p">)))</span></pre>
<pre class='cython code score-5 '>  __pyx_t_6 = (sqrt(__pyx_v_v1_norm) * sqrt(__pyx_v_v2_norm));
  if (unlikely(__pyx_t_6 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L1_error)</span>
  }
  __pyx_r = __pyx_f_11trajeometry__acos_clip((__pyx_v_dotproduct / __pyx_t_6));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">066</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">line_length</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">):</span></pre>
<pre class='cython code score-13 '>static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, PyObject *__pyx_arg_curve); /*proto*/
static double __pyx_f_11trajeometry_line_length(__Pyx_memviewslice __pyx_v_curve, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_length;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_num_points;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("line_length", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, PyObject *__pyx_arg_curve); /*proto*/
static char __pyx_doc_11trajeometry_2line_length[] = "Compute the actual length of a discrete curve, as the sum of the lengths of its segments\n\t   - curve : double[2, N] : Discrete curve to compute the length of\n\t&lt;----------- double       : Length of the curve in pixels\n\t";
static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, PyObject *__pyx_arg_curve) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("line_length (wrapper)", 0);
  assert(__pyx_arg_curve); {
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_arg_curve, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 68, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.line_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_2line_length(__pyx_self, __pyx_v_curve);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_2line_length(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("line_length", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_11trajeometry_line_length(__pyx_v_curve, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.line_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">069</span>: 	<span class="sd">&quot;&quot;&quot;Compute the actual length of a discrete curve, as the sum of the lengths of its segments</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: <span class="sd">	   - curve : double[2, N] : Discrete curve to compute the length of</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: <span class="sd">	&lt;----------- double       : Length of the curve in pixels</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">073</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">length</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_length = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">074</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">num_points</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_num_points = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_points</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_num_points - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>: 		<span class="n">length</span> <span class="o">+=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">])</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">])</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 0;
    __pyx_t_7 = (__pyx_v_i + 1);
    __pyx_t_8 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = 1;
    __pyx_t_11 = (__pyx_v_i + 1);
    __pyx_v_length = (__pyx_v_length + sqrt((pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) )))), 2.0) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) )))), 2.0))));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">077</span>: 	<span class="k">return</span> <span class="n">length</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_length;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>: <span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">_project_on_curve_index</span><span class="p">(</span><span class="n">double</span> <span class="n">point_x</span><span class="p">,</span> <span class="n">double</span> <span class="n">point_y</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static struct __pyx_t_11trajeometry__ProjectionIndex __pyx_f_11trajeometry__project_on_curve_index(double __pyx_v_point_x, double __pyx_v_point_y, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_best_index;
  int __pyx_v_best_orthogonal;
  double __pyx_v_best_factor;
  double __pyx_v_best_sqdistance;
  double __pyx_v_current_point_x;
  double __pyx_v_current_point_y;
  double __pyx_v_vector_x;
  double __pyx_v_vector_y;
  double __pyx_v_sqdistance;
  double __pyx_v_factor;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_project_on_curve_index", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry._project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>: 	<span class="sd">&quot;&quot;&quot;Return the closest point on the curve to the given point, including in-between curve samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>: <span class="sd">	   - point_x   : double           : Point to project, X coordinate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: <span class="sd">	   - point_y   : double           : Point to project, Y coordinate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: <span class="sd">	   - curve     : double[2, N]     : Numerical curve to project (point_x, point_y) onto</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: <span class="sd">	   - extend    : bool             : If True, when the projection is before the first sample of the curve, extend it</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>: <span class="sd">	   - min_index : int              : Minimum index to project to</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: <span class="sd">	&lt;--------------- _ProjectionIndex : .index is the index of the closest sample to the projection in the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>: <span class="sd">	                                  .vector_factor is the portion [0, 1] of the vector from curve[:, .index] to curve[:, .index+1] to add to the point at .index to get the actual closest point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: <span class="sd">	                                  If the projection is beyond the last sample of the curve, .index is set to -1 and .vector_factor to NAN</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: <span class="sd">	                                  If the projection is before the first sample of the curve and `extend` is False, .index is set to -1 and .vector_factor to NAN</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>: <span class="sd">	                                  If the projection is before the first sample of the curve and `extend` is True, .vector_factor is negative and possibly below -1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: <span class="sd">	                                  Otherwise, .vector_factor is positive and between 0 and 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">best_index</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_best_index = -1L;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>: 	<span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">best_orthogonal</span> <span class="o">=</span> <span class="bp">False</span></pre>
<pre class='cython code score-0 '>  __pyx_v_best_orthogonal = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">best_factor</span> <span class="o">=</span> <span class="n">NAN</span><span class="p">,</span> <span class="n">best_sqdistance</span> <span class="o">=</span> <span class="n">INFINITY</span></pre>
<pre class='cython code score-0 '>  __pyx_v_best_factor = NAN;
  __pyx_v_best_sqdistance = INFINITY;
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">current_point_x</span><span class="p">,</span> <span class="nf">current_point_y</span><span class="p">,</span> <span class="nf">vector_x</span><span class="p">,</span> <span class="nf">vector_y</span><span class="p">,</span> <span class="nf">sqdistance</span><span class="p">,</span> <span class="nf">factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_index</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = __pyx_v_min_index; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>: 		<span class="n">current_point_x</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_current_point_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>: 		<span class="n">current_point_y</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_current_point_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>: 		<span class="n">vector_x</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_point_x</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_v_vector_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - __pyx_v_current_point_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>: 		<span class="n">vector_y</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_point_y</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = (__pyx_v_i + 1);
    __pyx_v_vector_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))) - __pyx_v_current_point_y);
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: 		<span class="c"># Find the proportion of the vector at which the point orthogonally projects</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: 		<span class="c"># If it is within [0, 1[, then it can be better projected at a point on that vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: 		<span class="c"># Otherwise we continue with the curve sample alone</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>: 		<span class="n">factor</span> <span class="o">=</span> <span class="p">((</span><span class="n">point_x</span> <span class="o">-</span> <span class="n">current_point_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">point_y</span> <span class="o">-</span> <span class="n">current_point_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">vector_y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">vector_x</span><span class="o">*</span><span class="n">vector_x</span> <span class="o">+</span> <span class="n">vector_y</span><span class="o">*</span><span class="n">vector_y</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_6 = (((__pyx_v_point_x - __pyx_v_current_point_x) * __pyx_v_vector_x) + ((__pyx_v_point_y - __pyx_v_current_point_y) * __pyx_v_vector_y));
    __pyx_t_7 = ((__pyx_v_vector_x * __pyx_v_vector_x) + (__pyx_v_vector_y * __pyx_v_vector_y));
    if (unlikely(__pyx_t_7 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
    }
    __pyx_v_factor = (__pyx_t_6 / __pyx_t_7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>: 		<span class="k">if</span> <span class="p">(</span><span class="n">factor</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">extend</span><span class="p">))</span> <span class="ow">and</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((__pyx_v_factor &gt;= 0.0) != 0);
    if (!__pyx_t_9) {
    } else {
      goto __pyx_L7_next_and;
    }
    __pyx_t_9 = ((__pyx_v_i == 0) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_9 = (__pyx_v_extend != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_L7_next_and:;
    __pyx_t_9 = ((__pyx_v_factor &lt; 1.0) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>: 			<span class="n">current_point_x</span> <span class="o">+=</span> <span class="n">vector_x</span><span class="o">*</span><span class="n">factor</span></pre>
<pre class='cython code score-0 '>      __pyx_v_current_point_x = (__pyx_v_current_point_x + (__pyx_v_vector_x * __pyx_v_factor));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>: 			<span class="n">current_point_y</span> <span class="o">+=</span> <span class="n">vector_y</span><span class="o">*</span><span class="n">factor</span></pre>
<pre class='cython code score-0 '>      __pyx_v_current_point_y = (__pyx_v_current_point_y + (__pyx_v_vector_y * __pyx_v_factor));
</pre><pre class="cython line score-0">&#xA0;<span class="">113</span>: 		<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">114</span>: 			<span class="n">factor</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_factor = 0.0;
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">115</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: 		<span class="c"># Take the square distance (to spare a square root, it’s monotonous anyway) from the point to project to the current point or the projection onto the current vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: 		<span class="c"># The overall goal is to minimize this distance</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>: 		<span class="n">sqdistance</span> <span class="o">=</span> <span class="p">(</span><span class="n">point_x</span> <span class="o">-</span> <span class="n">current_point_x</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">point_y</span> <span class="o">-</span> <span class="n">current_point_y</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sqdistance = (pow((__pyx_v_point_x - __pyx_v_current_point_x), 2.0) + pow((__pyx_v_point_y - __pyx_v_current_point_y), 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">119</span>: 		<span class="k">if</span> <span class="n">sqdistance</span> <span class="o">&lt;</span> <span class="n">best_sqdistance</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_sqdistance &lt; __pyx_v_best_sqdistance) != 0);
    if (__pyx_t_8) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>: 			<span class="n">best_index</span> <span class="o">=</span> <span class="n">i</span></pre>
<pre class='cython code score-0 '>      __pyx_v_best_index = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>: 			<span class="n">best_factor</span> <span class="o">=</span> <span class="n">factor</span></pre>
<pre class='cython code score-0 '>      __pyx_v_best_factor = __pyx_v_factor;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>: 			<span class="n">best_sqdistance</span> <span class="o">=</span> <span class="n">sqdistance</span></pre>
<pre class='cython code score-0 '>      __pyx_v_best_sqdistance = __pyx_v_sqdistance;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">123</span>: 			<span class="n">best_orthogonal</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_best_orthogonal = (__pyx_v_factor &gt; 0.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: 	<span class="c"># Also check the distance to the last curve sample</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: 	<span class="c"># If it is closest to the point to project, then the point is beyond the curve and we fail</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: 	<span class="c"># However, this might be falsified by high curvatures near the end, so if the best point found previously</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: 	<span class="c"># was really orthogonal, keep it instead</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>: 	<span class="n">current_point_x</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = 0;
  __pyx_t_5 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_v_current_point_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">130</span>: 	<span class="n">current_point_y</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = 1;
  __pyx_t_4 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_v_current_point_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>: 	<span class="n">sqdistance</span> <span class="o">=</span> <span class="p">(</span><span class="n">point_x</span> <span class="o">-</span> <span class="n">current_point_x</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">point_y</span> <span class="o">-</span> <span class="n">current_point_y</span><span class="p">)</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>  __pyx_v_sqdistance = (pow((__pyx_v_point_x - __pyx_v_current_point_x), 2.0) + pow((__pyx_v_point_y - __pyx_v_current_point_y), 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>: 	<span class="k">if</span> <span class="n">sqdistance</span> <span class="o">&lt;</span> <span class="n">best_sqdistance</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">best_orthogonal</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = ((__pyx_v_sqdistance &lt; __pyx_v_best_sqdistance) != 0);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_9 = ((!(__pyx_v_best_orthogonal != 0)) != 0);
  __pyx_t_8 = __pyx_t_9;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>: 		<span class="k">return</span> <span class="n">_ProjectionIndex</span><span class="p">(</span><span class="n">index</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10.index = -1;
    __pyx_t_10.vector_factor = NAN;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: 	<span class="c"># If the point is before the first sample and no extension was required, fail</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>: 	<span class="k">if</span> <span class="n">best_index</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">best_index</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">best_factor</span> <span class="o">&lt;=</span> <span class="mf">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">extend</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = ((__pyx_v_best_index &lt; 0) != 0);
  if (!__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = ((__pyx_v_best_index == 0) != 0);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = ((__pyx_v_best_factor &lt;= 0.0) != 0);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = ((!(__pyx_v_extend != 0)) != 0);
  __pyx_t_8 = __pyx_t_9;
  __pyx_L15_bool_binop_done:;
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>: 		<span class="k">return</span> <span class="n">_ProjectionIndex</span><span class="p">(</span><span class="n">index</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10.index = -1;
    __pyx_t_10.vector_factor = NAN;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>: 		<span class="k">return</span> <span class="n">_ProjectionIndex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">best_index</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">best_factor</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_10.index = __pyx_v_best_index;
    __pyx_t_10.vector_factor = __pyx_v_best_factor;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">140</span>: </pre>
<pre class="cython line score-68" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>: <span class="k">def</span> <span class="nf">project_on_curve_index</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">point</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-68 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_5project_on_curve_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_4project_on_curve_index[] = "Return the closest point on the curve to the given point, including in-between curve samples\n\t   - point_x   : double[2]    : Point to project\n\t   - curve     : double[2, N] : Numerical curve to project `point` onto\n\t   - extend    : bool         : If True, when the projection is before the first sample of the curve, extend it\n\t   - min_index : Py_ssize_t   : Do not try to project before that index on the curve\n\t&lt;--------------- int          : Index of the closest sample on the curve\n\t&lt;--------------- double       : Portion [0, 1] of the vector from curve[:, index] to curve[:, index+1] to add to the point at `index` to get the actual closest point\n\t                                If the projection is before the first sample of the curve and `extend` is True, `vector_factor` is negative and possibly below -1.\n\t                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_5project_on_curve_index = {"project_on_curve_index", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_5project_on_curve_index, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_4project_on_curve_index};
static PyObject *__pyx_pw_11trajeometry_5project_on_curve_index(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_index (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_point)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_index", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_extend);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_min_index);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "project_on_curve_index") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 141, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 141, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)0);
    }
    if (values[3]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[3]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_index", 0, 2, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_4project_on_curve_index(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_4project_on_curve_index(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_result;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_index", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__29 = <span class='py_c_api'>PyTuple_Pack</span>(5, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__29);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__29);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_5project_on_curve_index, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_project_on_curve_index, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__30 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_project_on_curve_index, 141, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: 	<span class="sd">&quot;&quot;&quot;Return the closest point on the curve to the given point, including in-between curve samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: <span class="sd">	   - point_x   : double[2]    : Point to project</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: <span class="sd">	   - curve     : double[2, N] : Numerical curve to project `point` onto</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>: <span class="sd">	   - extend    : bool         : If True, when the projection is before the first sample of the curve, extend it</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: <span class="sd">	   - min_index : Py_ssize_t   : Do not try to project before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: <span class="sd">	&lt;--------------- int          : Index of the closest sample on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: <span class="sd">	&lt;--------------- double       : Portion [0, 1] of the vector from curve[:, index] to curve[:, index+1] to add to the point at `index` to get the actual closest point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: <span class="sd">	                                If the projection is before the first sample of the curve and `extend` is True, `vector_factor` is negative and possibly below -1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>: <span class="sd">	                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>: 	<span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">result</span> <span class="o">=</span> <span class="n">_project_on_curve_index</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">min_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_v_result = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>: 	<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_result.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>: 		<span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span></pre>
<pre class='cython code score-7 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple_);
    __pyx_r = __pyx_tuple_;
    goto __pyx_L0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(2, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 154, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>: 		<span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">vector_factor</span></pre>
<pre class='cython code score-15 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_result.index);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.vector_factor);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">157</span>: </pre>
<pre class="cython line score-71" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>: <span class="k">def</span> <span class="nf">project_on_curve_array</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">point</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-71 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_7project_on_curve_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_6project_on_curve_array[] = "Find the index closest to the orthogonal projection of a point onto a curve defined by a point sequence\n\t   - point     : double[2]    : 2D point to project on the curve\n\t   - curve     : double[2, N] : Curve to project the point onto, as a point sequence\n\t   - min_index : Py_ssize_t   : Do not try to project before that index on the curve\n\t&lt;--------------- int          : Index in `curve` closest to the orthogonal projection of `point`\n\t&lt;--------------- double[2]    : Projected point on the curve\n\t                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_7project_on_curve_array = {"project_on_curve_array", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_7project_on_curve_array, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_6project_on_curve_array};
static PyObject *__pyx_pw_11trajeometry_7project_on_curve_array(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_array (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_point)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_array", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_extend);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_min_index);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "project_on_curve_array") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 158, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 158, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)0);
    }
    if (values[3]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[3]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_array", 0, 2, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_6project_on_curve_array(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_6project_on_curve_array(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_array", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__31 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__31);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__31);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_7project_on_curve_array, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_project_on_curve_array, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__32 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_project_on_curve_array, 158, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">159</span>: 	<span class="sd">&quot;&quot;&quot;Find the index closest to the orthogonal projection of a point onto a curve defined by a point sequence</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>: <span class="sd">	   - point     : double[2]    : 2D point to project on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>: <span class="sd">	   - curve     : double[2, N] : Curve to project the point onto, as a point sequence</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: <span class="sd">	   - min_index : Py_ssize_t   : Do not try to project before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>: <span class="sd">	&lt;--------------- int          : Index in `curve` closest to the orthogonal projection of `point`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>: <span class="sd">	&lt;--------------- double[2]    : Projected point on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>: <span class="sd">	                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>: 	<span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">projection</span> <span class="o">=</span> <span class="n">_project_on_curve_index</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">min_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_v_projection = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>: 	<span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_projection.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>: 		<span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple_);
    __pyx_r = __pyx_tuple_;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>: 	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(((</span><span class="mf">1</span> <span class="o">-</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="o">*</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">],</span></pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = 0;
  __pyx_t_1 = __pyx_v_projection.index;
  __pyx_t_7 = 0;
  __pyx_t_8 = (__pyx_v_projection.index + 1);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>((((1.0 - __pyx_v_projection.vector_factor) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_curve.strides[1]) )))) + (__pyx_v_projection.vector_factor * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_8 * __pyx_v_curve.strides[1]) ))))));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
/* … */
  __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_9);
  __pyx_t_5 = 0;
  __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_4 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_9, __pyx_t_10) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_result = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>: 		                 <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="o">*</span><span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-5 '>  __pyx_t_8 = 1;
  __pyx_t_7 = __pyx_v_projection.index;
  __pyx_t_1 = 1;
  __pyx_t_2 = (__pyx_v_projection.index + 1);
  __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((((1.0 - __pyx_v_projection.vector_factor) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) )))) + (__pyx_v_projection.vector_factor * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_1 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))))));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>: 	<span class="k">return</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">result</span></pre>
<pre class='cython code score-11 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_projection.index);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_v_result);
  __pyx_t_4 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>: <span class="k">cdef</span> <span class="kt">_NextPoint</span> <span class="nf">_next_point</span><span class="p">(</span><span class="n">Py_ssize_t</span> <span class="n">closest_index</span><span class="p">,</span> <span class="n">double</span> <span class="n">vector_factor</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span> <span class="n">target_distance</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static struct __pyx_t_11trajeometry__NextPoint __pyx_f_11trajeometry__next_point(Py_ssize_t __pyx_v_closest_index, double __pyx_v_vector_factor, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_target_distance) {
  Py_ssize_t __pyx_v_current_index;
  Py_ssize_t __pyx_v_curve_size;
  double __pyx_v_distance;
  double __pyx_v_x_derivative;
  double __pyx_v_y_derivative;
  CYTHON_UNUSED double __pyx_v_current_point_x;
  CYTHON_UNUSED double __pyx_v_current_point_y;
  double __pyx_v_current_vector_norm;
  double __pyx_v_remaining_x;
  double __pyx_v_remaining_y;
  double __pyx_v_remaining_norm;
  struct __pyx_t_11trajeometry__NextPoint __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_next_point", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry._next_point", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">177</span>: 	<span class="sd">&quot;&quot;&quot;Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>: <span class="sd">	   - closest_index   : Py_ssize_t   : Index of the initial point on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>: <span class="sd">	   - vector_factor   : double       : Portion of the outgoing vector of the given index on the curve to add to get the initial point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: <span class="sd">	   - curve           : double[2, N] : Numerical curve to follow</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: <span class="sd">	   - target_distance : double       : Distance from the projection of the initial point to the result</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>: <span class="sd">	&lt;--------------------- _NextPoint   : .x and .y are the coordinates of the resulting point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: <span class="sd">	                                      .index is the index of the sample immediately before the resulting point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>: <span class="sd">	                                      .vector_factor is the portion [0, 1] of the vector from curve[:, .index] to curve[:, .index+1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: <span class="sd">										  to add to the point at .index to get the actual resulting point, might be negative if the initial vector_factor was too</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: <span class="sd">	                                      If the resulting point is beyond the last sample of the curve, .index is set to -1 and .x, .y and .vector_factor are set to NAN</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">current_index</span> <span class="o">=</span> <span class="n">closest_index</span></pre>
<pre class='cython code score-0 '>  __pyx_v_current_index = __pyx_v_closest_index;
</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">curve_size</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_curve_size = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">distance</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_distance = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x_derivative</span><span class="p">,</span> <span class="nf">y_derivative</span><span class="p">,</span> <span class="nf">current_point_x</span><span class="p">,</span> <span class="nf">current_point_y</span><span class="p">,</span> <span class="nf">current_vector_norm</span><span class="p">,</span> <span class="nf">remaining_x</span><span class="p">,</span> <span class="nf">remaining_y</span><span class="p">,</span> <span class="nf">remaining_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>: 	<span class="c"># Now loop on the curve samples starting from the initial projection until the cumulative distance adds up to `target_distance` or it overshoots the curve</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>: 	<span class="k">while</span> <span class="n">current_index</span> <span class="o">&lt;</span> <span class="n">curve_size</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_1 = ((__pyx_v_current_index &lt; (__pyx_v_curve_size - 1)) != 0);
    if (!__pyx_t_1) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">196</span>: 		<span class="c"># Get the vector from the current sample to the next</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>: 		<span class="n">x_derivative</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">current_index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2 = 0;
    __pyx_t_3 = (__pyx_v_current_index + 1);
    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_current_index;
    __pyx_v_x_derivative = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>: 		<span class="n">y_derivative</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">current_index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = (__pyx_v_current_index + 1);
    __pyx_t_3 = 1;
    __pyx_t_2 = __pyx_v_current_index;
    __pyx_v_y_derivative = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>: 		<span class="c"># When the vector_factor is non-null, take the part of the vector that remains *after* the vector_factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: 		<span class="c"># To start at the actual initial projection, including its vector part</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>: 		<span class="n">remaining_x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">vector_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_derivative</span></pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_x = ((1.0 - __pyx_v_vector_factor) * __pyx_v_x_derivative);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>: 		<span class="n">remaining_y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">vector_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_derivative</span></pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_y = ((1.0 - __pyx_v_vector_factor) * __pyx_v_y_derivative);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>: 		<span class="n">remaining_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">remaining_x</span><span class="o">*</span><span class="n">remaining_x</span> <span class="o">+</span> <span class="n">remaining_y</span><span class="o">*</span><span class="n">remaining_y</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_norm = sqrt(((__pyx_v_remaining_x * __pyx_v_remaining_x) + (__pyx_v_remaining_y * __pyx_v_remaining_y)));
</pre><pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: 		<span class="c"># This entire vectors would make us overshoot the target : the resulting point is between this sample and the next</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>: 		<span class="c"># We just need to compute the necessary proportion of the vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>: 		<span class="k">if</span> <span class="n">remaining_norm</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">target_distance</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = (((__pyx_v_remaining_norm + __pyx_v_distance) &gt; __pyx_v_target_distance) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>: 			<span class="n">current_vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x_derivative</span><span class="o">*</span><span class="n">x_derivative</span> <span class="o">+</span> <span class="n">y_derivative</span><span class="o">*</span><span class="n">y_derivative</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_current_vector_norm = sqrt(((__pyx_v_x_derivative * __pyx_v_x_derivative) + (__pyx_v_y_derivative * __pyx_v_y_derivative)));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>: 			<span class="n">vector_factor</span> <span class="o">+=</span> <span class="p">(</span><span class="n">target_distance</span> <span class="o">-</span> <span class="n">distance</span><span class="p">)</span> <span class="o">/</span> <span class="n">current_vector_norm</span></pre>
<pre class='cython code score-5 '>      __pyx_t_6 = (__pyx_v_target_distance - __pyx_v_distance);
      if (unlikely(__pyx_v_current_vector_norm == 0)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>
      }
      __pyx_v_vector_factor = (__pyx_v_vector_factor + (__pyx_t_6 / __pyx_v_current_vector_norm));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>: 			<span class="n">current_point_x</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_factor</span> <span class="o">*</span> <span class="n">x_derivative</span></pre>
<pre class='cython code score-0 '>      __pyx_t_2 = 0;
      __pyx_t_3 = __pyx_v_current_index;
      __pyx_v_current_point_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_x_derivative));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>: 			<span class="n">current_point_y</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_factor</span> <span class="o">*</span> <span class="n">y_derivative</span></pre>
<pre class='cython code score-0 '>      __pyx_t_3 = 1;
      __pyx_t_2 = __pyx_v_current_index;
      __pyx_v_current_point_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_y_derivative));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>: 			<span class="k">return</span> <span class="n">_NextPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_factor</span> <span class="o">*</span> <span class="n">x_derivative</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">current_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector_factor</span> <span class="o">*</span> <span class="n">y_derivative</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">current_index</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">vector_factor</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_2 = 0;
      __pyx_t_3 = __pyx_v_current_index;
      __pyx_t_7.x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_x_derivative));
      __pyx_t_3 = 1;
      __pyx_t_2 = __pyx_v_current_index;
      __pyx_t_7.y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_y_derivative));
      __pyx_t_7.index = __pyx_v_current_index;
      __pyx_t_7.vector_factor = __pyx_v_vector_factor;
      __pyx_r = __pyx_t_7;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: 		<span class="c"># Otherwise, just add this distance and continue on to the next sample</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>: 		<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>: 			<span class="n">current_index</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_current_index = (__pyx_v_current_index + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>: 			<span class="n">vector_factor</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_vector_factor = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>: 			<span class="n">distance</span> <span class="o">+=</span> <span class="n">remaining_norm</span></pre>
<pre class='cython code score-0 '>      __pyx_v_distance = (__pyx_v_distance + __pyx_v_remaining_norm);
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">220</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>: 	<span class="c"># We have overshot the curve, fail</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>: 	<span class="k">return</span> <span class="n">_NextPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NAN</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NAN</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7.x = NAN;
  __pyx_t_7.y = NAN;
  __pyx_t_7.index = -1;
  __pyx_t_7.vector_factor = NAN;
  __pyx_r = __pyx_t_7;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-86" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>: <span class="k">def</span> <span class="nf">next_point</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">point</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span> <span class="n">target_distance</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-86 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_9next_point(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_8next_point[] = "Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order\n\t   - point           : double[2]    : Initial point\n\t   - curve           : double[2, N] : Numerical curve to follow\n\t   - target_distance : double       : Distance from the projection of the initial point to the result\n\t   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve\n\t   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve\n\t&lt;--------------------- double[2]    : Coordinates of the resulting point\n\t                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return None\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_9next_point = {"next_point", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_9next_point, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_8next_point};
static PyObject *__pyx_pw_11trajeometry_9next_point(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_target_distance;
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_target_distance,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_point)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, 1); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_target_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, 2); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_extend);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_min_index);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "next_point") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 224, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 224, __pyx_L3_error)</span>
    __pyx_v_target_distance = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_target_distance == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)0);
    }
    if (values[4]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[4]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_8next_point(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_8next_point(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_target_distance, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__33 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_target_distance, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__33);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__33);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_9next_point, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_next_point, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__34 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_next_point, 224, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">225</span>: 	<span class="sd">&quot;&quot;&quot;Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>: <span class="sd">	   - point           : double[2]    : Initial point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>: <span class="sd">	   - curve           : double[2, N] : Numerical curve to follow</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>: <span class="sd">	   - target_distance : double       : Distance from the projection of the initial point to the result</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: <span class="sd">	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>: <span class="sd">	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>: <span class="sd">	&lt;--------------------- double[2]    : Coordinates of the resulting point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>: <span class="sd">	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>: 	<span class="c"># First take the closest point on the curve to the initial point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>: 	<span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">projection</span> <span class="o">=</span> <span class="n">_project_on_curve_index</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">min_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_v_projection = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);
</pre><pre class="cython line score-0">&#xA0;<span class="">236</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>: 	<span class="c"># The extension shenanigans are handled entirely by _project_on_curve_index, just fail when it fails</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>: 	<span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_projection.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>: 		<span class="k">return</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>: 	<span class="k">cdef</span> <span class="kt">_NextPoint</span> <span class="nf">result</span> <span class="o">=</span> <span class="n">_next_point</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">target_distance</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_result = __pyx_f_11trajeometry__next_point(__pyx_v_projection.index, __pyx_v_projection.vector_factor, __pyx_v_curve, __pyx_v_target_distance);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>: 	<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_result.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>: 		<span class="k">return</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">244</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>: 		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">y</span><span class="p">))</span></pre>
<pre class='cython code score-38 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.x);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.y);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_7);
    __pyx_t_5 = 0;
    __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
      __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      }
    }
    __pyx_t_4 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_7, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>: <span class="k">cdef</span> (<span class="nf">_NextPoint</span><span class="p">,</span> <span class="kt">double</span>) <span class="nf">_next_point_score</span><span class="p">(</span><span class="n">Py_ssize_t</span> <span class="n">closest_index</span><span class="p">,</span> <span class="n">double</span> <span class="n">vector_factor</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">scores</span><span class="p">,</span> <span class="n">double</span> <span class="n">target_distance</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static __pyx_ctuple_25469f__struct__space___dunderpyx_t_11trajeometry__dunderNextPoint__and_double__etc __pyx_f_11trajeometry__next_point_score(Py_ssize_t __pyx_v_closest_index, double __pyx_v_vector_factor, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_scores, double __pyx_v_target_distance, CYTHON_UNUSED int __pyx_v_extend, CYTHON_UNUSED Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  __pyx_ctuple_25469f__struct__space___dunderpyx_t_11trajeometry__dunderNextPoint__and_double__etc __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_next_point_score", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">248</span>: 	<span class="sd">&quot;&quot;&quot;Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>: <span class="sd">	   - closest_index   : Py_ssize_t   : Index of the initial point on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: <span class="sd">	   - vector_factor   : double       : Portion of the outgoing vector of the given index on the curve to add to get the initial point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: <span class="sd">	   - curve           : double[2, N] : Numerical curve to follow</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: <span class="sd">	   - target_distance : double       : Distance from the projection of the initial point to the result</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: <span class="sd">	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>: <span class="sd">	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: <span class="sd">	&lt;--------------------- _NextPoint   : Next point parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>: <span class="sd">	&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: <span class="sd">	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both invalid</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>: 	<span class="k">cdef</span> <span class="kt">_NextPoint</span> <span class="nf">result</span> <span class="o">=</span> <span class="n">_next_point</span><span class="p">(</span><span class="n">closest_index</span><span class="p">,</span> <span class="n">vector_factor</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">target_distance</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_result = __pyx_f_11trajeometry__next_point(__pyx_v_closest_index, __pyx_v_vector_factor, __pyx_v_curve, __pyx_v_target_distance);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>: 	<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_result.index &lt; 0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>: 		<span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2.f0 = __pyx_v_result;
    __pyx_t_2.f1 = NAN;
    __pyx_r = __pyx_t_2;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>: 		<span class="k">return</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">)</span> <span class="o">+</span> <span class="n">scores</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_3 = __pyx_v_result.index;
    __pyx_t_4 = (__pyx_v_result.index + 1);
    __pyx_t_2.f0 = __pyx_v_result;
    __pyx_t_2.f1 = (((*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_3 * __pyx_v_scores.strides[0]) ))) * (1.0 - __pyx_v_result.vector_factor)) + ((*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) ))) * __pyx_v_result.vector_factor));
    __pyx_r = __pyx_t_2;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-94" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>: <span class="k">def</span> <span class="nf">next_point_score</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">point</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">scores</span><span class="p">,</span> <span class="n">double</span> <span class="n">target_distance</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="o">=</span><span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-94 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_11next_point_score(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_10next_point_score[] = "Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order\n\t   - point           : double[2]    : Initial point\n\t   - curve           : double[2, N] : Numerical curve to follow\n\t   - target_distance : double       : Distance from the projection of the initial point to the result\n\t   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve\n\t   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve\n\t&lt;--------------------- double[2]    : Coordinates of the resulting point\n\t&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples\n\t                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both None\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_11next_point_score = {"next_point_score", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_11next_point_score, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_10next_point_score};
static PyObject *__pyx_pw_11trajeometry_11next_point_score(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_target_distance;
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point_score (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_scores,&amp;__pyx_n_s_target_distance,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_point)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 1); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_scores)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 2); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_target_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 3); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_extend);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_min_index);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "next_point_score") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_target_distance = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_target_distance == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[4]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)0);
    }
    if (values[5]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[5]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point_score", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_10next_point_score(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_scores, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_10next_point_score(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_scores, double __pyx_v_target_distance, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  double __pyx_v_score;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point_score", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point_score", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__35 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_scores, __pyx_n_s_target_distance, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result, __pyx_n_s_score);<span class='error_goto'> if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__35);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__35);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_11next_point_score, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_next_point_score, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__36 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_next_point_score, 265, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">266</span>: 	<span class="sd">&quot;&quot;&quot;Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: <span class="sd">	   - point           : double[2]    : Initial point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>: <span class="sd">	   - curve           : double[2, N] : Numerical curve to follow</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: <span class="sd">	   - target_distance : double       : Distance from the projection of the initial point to the result</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>: <span class="sd">	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: <span class="sd">	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>: <span class="sd">	&lt;--------------------- double[2]    : Coordinates of the resulting point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>: <span class="sd">	&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: <span class="sd">	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: 	<span class="c"># First take the closest point on the curve to the initial point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>: 	<span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">projection</span> <span class="o">=</span> <span class="n">_project_on_curve_index</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">min_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_v_projection = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);
</pre><pre class="cython line score-0">&#xA0;<span class="">278</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>: 	<span class="c"># The extension shenanigans are handled entirely by _project_on_curve_index, just fail when it fails</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>: 	<span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_projection.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-53" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>: 		<span class="k">return</span> <span class="p">(</span><span class="n">_NextPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NAN</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NAN</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">NAN</span><span class="p">),</span> <span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-53 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_x, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_y, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_index, __pyx_int_neg_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_vector_factor, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: 	<span class="k">cdef</span> <span class="kt">_NextPoint</span> <span class="nf">result</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">score</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>: 	<span class="n">result</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">_next_point_score</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">target_distance</span><span class="p">,</span> <span class="n">extend</span><span class="p">,</span> <span class="n">min_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_f_11trajeometry__next_point_score(__pyx_v_projection.index, __pyx_v_projection.vector_factor, __pyx_v_curve, __pyx_v_scores, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);
  __pyx_t_8 = __pyx_t_7.f0;
  __pyx_t_9 = __pyx_t_7.f1;
  __pyx_v_result = __pyx_t_8;
  __pyx_v_score = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>: 	<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3 = ((__pyx_v_result.index &lt; 0) != 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>: 		<span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span></pre>
<pre class='cython code score-7 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__2);
    __pyx_r = __pyx_tuple__2;
    goto __pyx_L0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(3, Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0">&#xA0;<span class="">289</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-53" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>: 		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">y</span><span class="p">)),</span> <span class="n">score</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">index</span></pre>
<pre class='cython code score-53 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.x);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.y);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_10);
    __pyx_t_5 = 0;
    __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      }
    }
    __pyx_t_6 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_10, __pyx_t_11) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_score);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_result.index);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 2, __pyx_t_11);
    __pyx_t_6 = 0;
    __pyx_t_4 = 0;
    __pyx_t_11 = 0;
    __pyx_r = __pyx_t_10;
    __pyx_t_10 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">291</span>: </pre>
<pre class="cython line score-68" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>: <span class="k">cpdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">project_from</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">point</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">vector</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_curve</span><span class="p">,</span> <span class="n">bint</span> <span class="n">extend</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">min_index</span><span class="p">):</span></pre>
<pre class='cython code score-68 '>static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static struct __pyx_t_11trajeometry__ProjectionIndex __pyx_f_11trajeometry_project_from(__Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_vector, __Pyx_memviewslice __pyx_v_target_curve, CYTHON_UNUSED int __pyx_v_extend, Py_ssize_t __pyx_v_min_index, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  double __pyx_v_check1_x;
  double __pyx_v_check1_y;
  double __pyx_v_check2_x;
  double __pyx_v_check2_y;
  double __pyx_v_ortho_x;
  double __pyx_v_ortho_y;
  double __pyx_v_denominator;
  double __pyx_v_interp;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_from", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_12project_from[] = "\302\253 Project \302\273 a point from the segment it belongs to, to another curve\n\t   The vector from the original point and its projection is orthogonal to the segment of origin, not to the target curve\n\t   Return the first intersection in the order of the target curve, not particularly the closest to the original point\n\t   - point        : double[2]        : Point to project\n\t   - vector       : double[2]        : The projection must be on the orthogonal vector to this relative to the point\n\t   - target_curve : double[2, N]     : Curve to project onto\n\t   - extend       : bool             : Stay valid even when the intersection is before the first sample of the curve\n\t   - min_index    : Py_ssize_t       : Do not search before that index on the curve\n\t&lt;------------------ _ProjectionIndex : Result of the projection, as (index, interpolation)\n\t                                       If no valid intersection was found, return .index = -1 and .vector_factor = NAN\n\t";
static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_target_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_from (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_vector,&amp;__pyx_n_s_target_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_point)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_vector)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_target_curve)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_extend)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_min_index)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "project_from") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_vector = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vector.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_target_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_target_curve.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[4]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_12project_from(__pyx_self, __pyx_v_point, __pyx_v_vector, __pyx_v_target_curve, __pyx_v_extend, __pyx_v_min_index);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_12project_from(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_vector, __Pyx_memviewslice __pyx_v_target_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_from", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_convert__to_py_struct____pyx_t_11trajeometry__ProjectionIndex(__pyx_f_11trajeometry_project_from(__pyx_v_point, __pyx_v_vector, __pyx_v_target_curve, __pyx_v_extend, __pyx_v_min_index, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_vector, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_target_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">293</span>: 	<span class="sd">&quot;&quot;&quot;« Project » a point from the segment it belongs to, to another curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: <span class="sd">	   The vector from the original point and its projection is orthogonal to the segment of origin, not to the target curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>: <span class="sd">	   Return the first intersection in the order of the target curve, not particularly the closest to the original point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: <span class="sd">	   - point        : double[2]        : Point to project</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: <span class="sd">	   - vector       : double[2]        : The projection must be on the orthogonal vector to this relative to the point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>: <span class="sd">	   - target_curve : double[2, N]     : Curve to project onto</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: <span class="sd">	   - extend       : bool             : Stay valid even when the intersection is before the first sample of the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>: <span class="sd">	   - min_index    : Py_ssize_t       : Do not search before that index on the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>: <span class="sd">	&lt;------------------ _ProjectionIndex : Result of the projection, as (index, interpolation)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>: <span class="sd">	                                       If no valid intersection was found, return .index = -1 and .vector_factor = NAN</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">check1_x</span><span class="p">,</span> <span class="nf">check1_y</span><span class="p">,</span> <span class="nf">check2_x</span><span class="p">,</span> <span class="nf">check2_y</span><span class="p">,</span> <span class="nf">ortho_x</span> <span class="o">=</span> <span class="o">-</span><span class="n">vector</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">ortho_y</span> <span class="o">=</span> <span class="n">vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_v_ortho_x = (-(*((double *) ( /* dim=0 */ (__pyx_v_vector.data + __pyx_t_1 * __pyx_v_vector.strides[0]) ))));
  __pyx_t_1 = 0;
  __pyx_v_ortho_y = (*((double *) ( /* dim=0 */ (__pyx_v_vector.data + __pyx_t_1 * __pyx_v_vector.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">306</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">denominator</span><span class="p">,</span> <span class="nf">interp</span>  <span class="c">#, factor</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_index</span><span class="p">,</span> <span class="n">target_curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_target_curve.shape[1]) - 1);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = __pyx_v_min_index; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>: 		<span class="n">check1_x</span> <span class="o">=</span> <span class="n">target_curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_check1_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_1 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>: 		<span class="n">check1_y</span> <span class="o">=</span> <span class="n">target_curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_1 = __pyx_v_i;
    __pyx_v_check1_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_5 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>: 		<span class="n">check2_x</span> <span class="o">=</span> <span class="n">target_curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_v_check2_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_1 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>: 		<span class="n">check2_y</span> <span class="o">=</span> <span class="n">target_curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_1 = (__pyx_v_i + 1);
    __pyx_v_check2_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_5 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>: 		<span class="c"># Basically, we solve the following vector equation :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: 		<span class="c"># point + factor*ortho = (1 - interp)*check1 + interp*check2,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: 		<span class="c"># to get the intersection between the orthogonal projecting line and the curve segment line</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>: 		<span class="c"># If the solution is defined and the interpolation factor is in [0, 1], then the intersection is on this segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>: 		<span class="n">denominator</span> <span class="o">=</span> <span class="n">check1_x</span><span class="o">*</span><span class="n">ortho_y</span> <span class="o">-</span> <span class="n">check1_y</span><span class="o">*</span><span class="n">ortho_x</span> <span class="o">-</span> <span class="n">check2_x</span><span class="o">*</span><span class="n">ortho_y</span> <span class="o">+</span> <span class="n">check2_y</span><span class="o">*</span><span class="n">ortho_x</span></pre>
<pre class='cython code score-0 '>    __pyx_v_denominator = ((((__pyx_v_check1_x * __pyx_v_ortho_y) - (__pyx_v_check1_y * __pyx_v_ortho_x)) - (__pyx_v_check2_x * __pyx_v_ortho_y)) + (__pyx_v_check2_y * __pyx_v_ortho_x));
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>: 		<span class="c"># Vector and interpolation factors undefined -&gt; the segment is colinear with the vector, skip</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>: 		<span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = ((__pyx_v_denominator == 0.0) != 0);
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>: 			<span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>: 		<span class="c"># Actually we only need the interpolation factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>: 		<span class="c"># factor = (check1_x*check2_y - check1_x*point[1] - check1_y*check2_x + check1_y*point[0] + check2_x*point[1] - check2_y*point[0]) / denominator</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>: 		<span class="n">interp</span> <span class="o">=</span> <span class="p">(</span><span class="n">check1_x</span><span class="o">*</span><span class="n">ortho_y</span> <span class="o">-</span> <span class="n">check1_y</span><span class="o">*</span><span class="n">ortho_x</span> <span class="o">-</span> <span class="n">point</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">ortho_y</span> <span class="o">+</span> <span class="n">point</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">ortho_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span></pre>
<pre class='cython code score-5 '>    __pyx_t_1 = 0;
    __pyx_t_5 = 1;
    __pyx_t_7 = ((((__pyx_v_check1_x * __pyx_v_ortho_y) - (__pyx_v_check1_y * __pyx_v_ortho_x)) - ((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))) * __pyx_v_ortho_y)) + ((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_5 * __pyx_v_point.strides[0]) ))) * __pyx_v_ortho_x));
    if (unlikely(__pyx_v_denominator == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
    }
    __pyx_v_interp = (__pyx_t_7 / __pyx_v_denominator);
</pre><pre class="cython line score-0">&#xA0;<span class="">326</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>: 		<span class="c"># Interpolation falls within the actual segment, or before if we’re in extended mode -&gt; found the intersection</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">328</span>: 		<span class="k">if</span> <span class="p">(</span><span class="n">interp</span> <span class="o">&gt;=</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">interp</span> <span class="o">&lt;=</span> <span class="mf">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">interp</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_interp &gt;= 0.0) != 0);
    if (!__pyx_t_8) {
      goto __pyx_L8_next_or;
    } else {
    }
    __pyx_t_8 = ((__pyx_v_interp &lt;= 1.0) != 0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_6 = __pyx_t_8;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_L8_next_or:;
    __pyx_t_8 = ((__pyx_v_i == 0) != 0);
    if (__pyx_t_8) {
    } else {
      __pyx_t_6 = __pyx_t_8;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_8 = ((__pyx_v_interp &lt; 0.0) != 0);
    __pyx_t_6 = __pyx_t_8;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_6) {
/* … */
    }
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">329</span>: 			<span class="k">return</span> <span class="n">_ProjectionIndex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9.index = __pyx_v_i;
      __pyx_t_9.vector_factor = __pyx_v_interp;
      __pyx_r = __pyx_t_9;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">330</span>: 	<span class="c"># Didn’t find any valid intersection -&gt; fail</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>: 	<span class="k">return</span> <span class="n">_ProjectionIndex</span><span class="p">(</span><span class="n">index</span><span class="o">=-</span><span class="mf">1</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="n">NAN</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9.index = -1;
  __pyx_t_9.vector_factor = NAN;
  __pyx_r = __pyx_t_9;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>: <span class="k">def</span> <span class="nf">resample_curve</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span> <span class="n">step</span><span class="p">):</span></pre>
<pre class='cython code score-56 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_15resample_curve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_14resample_curve[] = "Resample a curve such that points are (approximately) equidistant\n\t   - curve : double[2, N] : Numerical curve to resample\n\t   - step  : double       : Distance between the resampled points\n\t&lt;----------- double[2, M] : Resampled curve. Points are *approximately* at distance `step` from each other\n\t                            There is no guarantee on the actual number of points in the resampled curve";
static PyMethodDef __pyx_mdef_11trajeometry_15resample_curve = {"resample_curve", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_15resample_curve, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_14resample_curve};
static PyObject *__pyx_pw_11trajeometry_15resample_curve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_step;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("resample_curve (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_step,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_step)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resample_curve", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "resample_curve") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 334, __pyx_L3_error)</span>
    __pyx_v_step = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_step == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resample_curve", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.resample_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_14resample_curve(__pyx_self, __pyx_v_curve, __pyx_v_step);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_14resample_curve(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_step) {
  std::vector&lt;__pyx_ctuple_double__and_double&gt;  __pyx_v_resampled;
  CYTHON_UNUSED Py_ssize_t __pyx_v_last_index;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_point;
  PyObject *__pyx_v_result = NULL;
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  size_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("resample_curve", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.resample_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__37 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_curve, __pyx_n_s_step, __pyx_n_s_resampled, __pyx_n_s_last_index, __pyx_n_s_point, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__37);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__37);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_15resample_curve, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_resample_curve, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__38 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_resample_curve, 334, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">335</span>: 	<span class="sd">&quot;&quot;&quot;Resample a curve such that points are (approximately) equidistant</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>: <span class="sd">	   - curve : double[2, N] : Numerical curve to resample</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>: <span class="sd">	   - step  : double       : Distance between the resampled points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: <span class="sd">	&lt;----------- double[2, M] : Resampled curve. Points are *approximately* at distance `step` from each other</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: <span class="sd">	                            There is no guarantee on the actual number of points in the resampled curve&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>: 	<span class="c"># Keep the same first sample</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>: 	<span class="k">cdef</span> <span class="kt">vector</span>[(<span class="nf">double</span><span class="p">,</span> <span class="kt">double</span>)] <span class="nf">resampled</span></pre>
<pre class='cython code score-0 '>struct __pyx_ctuple_double__and_double {
  double f0;
  double f1;
};
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>: 	<span class="n">resampled</span><span class="o">.</span><span class="n">push_back</span><span class="p">((</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_t_5.f0 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_1 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) )));
  __pyx_t_5.f1 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
  try {
    __pyx_v_resampled.push_back(__pyx_t_5);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 342, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: 	<span class="c"># Then just apply _next_point in a loop until we find the end of the curve</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">345</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">last_index</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_last_index = -1L;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>: 	<span class="k">cdef</span> <span class="kt">_NextPoint</span> <span class="nf">point</span> <span class="o">=</span> <span class="n">_NextPoint</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="mf">0</span><span class="p">,</span> <span class="n">vector_factor</span><span class="o">=</span><span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_6.x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) )));
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_t_6.y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
  __pyx_t_6.index = 0;
  __pyx_t_6.vector_factor = 0.0;
  __pyx_v_point = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>: 	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  while (1) {
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>: 		<span class="n">point</span> <span class="o">=</span> <span class="n">_next_point</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_point = __pyx_f_11trajeometry__next_point(__pyx_v_point.index, __pyx_v_point.vector_factor, __pyx_v_curve, __pyx_v_step);
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: 		<span class="c"># Passed the end of the curve</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>: 		<span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_point.index &lt; 0) != 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">352</span>: 			<span class="k">break</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L4_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>: 		<span class="n">last_index</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="n">index</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = __pyx_v_point.index;
    __pyx_v_last_index = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>: 		<span class="n">resampled</span><span class="o">.</span><span class="n">push_back</span><span class="p">((</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5.f0 = __pyx_v_point.x;
    __pyx_t_5.f1 = __pyx_v_point.y;
    try {
      __pyx_v_resampled.push_back(__pyx_t_5);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 355, __pyx_L1_error)</span>
    }
  }
  __pyx_L4_break:;
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: 	<span class="c"># Copy the content of the vector into a fixed numpy array</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>: 	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="n">resampled</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_resampled.size());<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_10, __pyx_t_12) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_v_result = __pyx_t_9;
  __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">result_view</span> <span class="o">=</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 359, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">360</span>: 	<span class="k">cdef</span> <span class="kt">size_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resampled</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_14 = __pyx_v_resampled.size();
  __pyx_t_15 = __pyx_t_14;
  for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
    __pyx_v_i = __pyx_t_16;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>: 		<span class="n">result</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">resampled</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_resampled[__pyx_v_i]).f0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_11);
    __pyx_t_11 = 0;
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_t_12, __pyx_t_9) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>: 		<span class="n">result</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">resampled</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_resampled[__pyx_v_i]).f1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_12);
    __pyx_t_12 = 0;
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_t_11, __pyx_t_9) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>: 	<span class="k">return</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">365</span>: </pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>: <span class="k">cpdef</span> <span class="kt">bint</span> <span class="nf">segments_intersect</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">A</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">B</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">C</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">D</span><span class="p">):</span></pre>
<pre class='cython code score-50 '>static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_11trajeometry_segments_intersect(__Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B, __Pyx_memviewslice __pyx_v_C, __Pyx_memviewslice __pyx_v_D, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_determinant_A;
  double __pyx_v_determinant_B;
  double __pyx_v_determinant_C;
  double __pyx_v_determinant_D;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("segments_intersect", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_16segments_intersect[] = "Check whether the segments AB and CD intersect with each other\n\t   - A : double[2] : First point of the first segment\n\t   - B : double[2] : Second point of the first segment\n\t   - C : double[2] : First point of the second segment\n\t   - D : double[2] : Second point of the second segment\n\t&lt;------- bool      : Whether the segments AB and CD intersect\n\t";
static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_A = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_B = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_C = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_D = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("segments_intersect (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_A,&amp;__pyx_n_s_B,&amp;__pyx_n_s_C,&amp;__pyx_n_s_D,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_A)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_B)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_C)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_D)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "segments_intersect") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_A = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_A.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_B = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_B.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_C = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_C.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_D = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_D.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.segments_intersect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_16segments_intersect(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_C, __pyx_v_D);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_16segments_intersect(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B, __Pyx_memviewslice __pyx_v_C, __Pyx_memviewslice __pyx_v_D) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("segments_intersect", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_f_11trajeometry_segments_intersect(__pyx_v_A, __pyx_v_B, __pyx_v_C, __pyx_v_D, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.segments_intersect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_A, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_B, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_C, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_D, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">367</span>: 	<span class="sd">&quot;&quot;&quot;Check whether the segments AB and CD intersect with each other</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>: <span class="sd">	   - A : double[2] : First point of the first segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>: <span class="sd">	   - B : double[2] : Second point of the first segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>: <span class="sd">	   - C : double[2] : First point of the second segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>: <span class="sd">	   - D : double[2] : Second point of the second segment</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>: <span class="sd">	&lt;------- bool      : Whether the segments AB and CD intersect</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">determinant_A</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">A</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 1;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 1;
  __pyx_t_8 = 1;
  __pyx_v_determinant_A = ((((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_1 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_2 * __pyx_v_A.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_3 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_4 * __pyx_v_A.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_5 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_6 * __pyx_v_A.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_7 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_8 * __pyx_v_A.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">determinant_B</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = 0;
  __pyx_t_7 = 0;
  __pyx_t_6 = 1;
  __pyx_t_5 = 1;
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_2 = 1;
  __pyx_t_1 = 1;
  __pyx_v_determinant_B = ((((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_8 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_7 * __pyx_v_B.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_6 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_5 * __pyx_v_B.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_4 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_3 * __pyx_v_B.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_2 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_1 * __pyx_v_B.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">determinant_C</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">C</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 1;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 1;
  __pyx_t_8 = 1;
  __pyx_v_determinant_C = ((((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_1 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_2 * __pyx_v_C.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_3 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_4 * __pyx_v_C.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_5 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_6 * __pyx_v_C.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_7 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_8 * __pyx_v_C.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">determinant_D</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">D</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">D</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="n">D</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="n">D</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = 0;
  __pyx_t_7 = 0;
  __pyx_t_6 = 1;
  __pyx_t_5 = 1;
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_2 = 1;
  __pyx_t_1 = 1;
  __pyx_v_determinant_D = ((((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_8 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_7 * __pyx_v_D.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_6 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_5 * __pyx_v_D.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_4 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_3 * __pyx_v_D.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_2 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_1 * __pyx_v_D.strides[0]) ))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">378</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>: 	<span class="k">return</span> <span class="p">(((</span><span class="n">determinant_A</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">determinant_B</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">determinant_A</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">determinant_B</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">))</span> <span class="ow">and</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = ((__pyx_v_determinant_A &gt; 0.0) != 0);
  if (!__pyx_t_10) {
    goto __pyx_L5_next_or;
  } else {
  }
  __pyx_t_10 = ((__pyx_v_determinant_B &lt; 0.0) != 0);
  if (!__pyx_t_10) {
  } else {
    goto __pyx_L4_next_and;
  }
  __pyx_L5_next_or:;
  __pyx_t_10 = ((__pyx_v_determinant_A &lt; 0.0) != 0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_10 = ((__pyx_v_determinant_B &gt; 0.0) != 0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_L4_next_and:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>: 	        <span class="p">((</span><span class="n">determinant_C</span> <span class="o">&gt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">determinant_D</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">determinant_C</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">and</span> <span class="n">determinant_D</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = ((__pyx_v_determinant_C &gt; 0.0) != 0);
  if (!__pyx_t_10) {
    goto __pyx_L8_next_or;
  } else {
  }
  __pyx_t_10 = ((__pyx_v_determinant_D &lt; 0.0) != 0);
  if (!__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_L8_next_or:;
  __pyx_t_10 = ((__pyx_v_determinant_C &lt; 0.0) != 0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_10 = ((__pyx_v_determinant_D &gt; 0.0) != 0);
  __pyx_t_9 = __pyx_t_10;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_9;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>: <span class="k">cpdef</span> <span class="kt">void</span> <span class="nf">find_self_intersects</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">bint</span><span class="p">[:]</span> <span class="n">mask</span><span class="p">):</span></pre>
<pre class='cython code score-34 '>static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static void __pyx_f_11trajeometry_find_self_intersects(__Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_mask, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  CYTHON_UNUSED Py_ssize_t __pyx_v_result_size;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_self_intersects", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_18find_self_intersects[] = "Find the areas where a discrete curve intersects itself, and build a mask\n\t   Applying this mask to the curve remove the intersecting parts altogether\n\t   - curve : double[2, N] : Curve to check\n\t   - mask  : bool[N]      : Output for the mask\n\t";
static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_self_intersects (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_mask,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_self_intersects", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "find_self_intersects") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 382, __pyx_L3_error)</span>
    __pyx_v_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_mask.memview)) __PYX_ERR(0, 382, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_self_intersects", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_18find_self_intersects(__pyx_self, __pyx_v_curve, __pyx_v_mask);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_18find_self_intersects(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_mask) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_self_intersects", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_11trajeometry_find_self_intersects(__pyx_v_curve, __pyx_v_mask, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_mask, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">383</span>: 	<span class="sd">&quot;&quot;&quot;Find the areas where a discrete curve intersects itself, and build a mask</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>: <span class="sd">	   Applying this mask to the curve remove the intersecting parts altogether</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>: <span class="sd">	   - curve : double[2, N] : Curve to check</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>: <span class="sd">	   - mask  : bool[N]      : Output for the mask</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">result_size</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_result_size = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>: 	<span class="n">mask</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">True</span></pre>
<pre class='cython code score-0 '>  {
      int __pyx_temp_scalar = 1;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_v_mask.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_v_mask.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_v_mask.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">390</span>: 	<span class="c"># Check for intersection between each pair of segments</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>: 	<span class="c"># When two segments intersect, cut out everything in-between such that the points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>: 	<span class="c"># before the first segment and after the second segment are linked, removing the intersecting part</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">394</span>: 		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_v_curve.shape[1]) - 1);
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = (__pyx_v_i + 1); __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>: 			<span class="k">if</span> <span class="n">segments_intersect</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">j</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7.data = __pyx_v_curve.data;
      __pyx_t_7.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_7, 0);
      __pyx_t_7.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_7.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_7.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_7.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_8.data = __pyx_v_curve.data;
      __pyx_t_8.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_8, 0);
      __pyx_t_8.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_8.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_8.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_i + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_8.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_9.data = __pyx_v_curve.data;
      __pyx_t_9.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_9, 0);
      __pyx_t_9.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_9.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_9.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_j;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_9.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_10.data = __pyx_v_curve.data;
      __pyx_t_10.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_10, 0);
      __pyx_t_10.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_10.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_10.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_j + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11 = (__pyx_f_11trajeometry_segments_intersect(__pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, 0) != 0);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
      __pyx_t_7.memview = NULL;
      __pyx_t_7.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
      __pyx_t_8.memview = NULL;
      __pyx_t_8.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL;
      __pyx_t_9.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL;
      __pyx_t_10.data = NULL;
      if (__pyx_t_11) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>: 				<span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12.data = __pyx_v_mask.data;
        __pyx_t_12.memview = __pyx_v_mask.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 0);
        __pyx_t_13 = -1;
        if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_12,
    __pyx_v_mask.shape[0], __pyx_v_mask.strides[0], __pyx_v_mask.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_13,
    (__pyx_v_i + 1),
    (__pyx_v_j + 1),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
}

{
            int __pyx_temp_scalar = 0;
            {
                Py_ssize_t __pyx_temp_extent_0 = __pyx_t_12.shape[0];
                Py_ssize_t __pyx_temp_stride_0 = __pyx_t_12.strides[0];
                char *__pyx_temp_pointer_0;
                Py_ssize_t __pyx_temp_idx_0;
                __pyx_temp_pointer_0 = __pyx_t_12.data;
                for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                  *((int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                  __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                }
            }
        }
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
        __pyx_t_12.memview = NULL;
        __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>: <span class="k">def</span> <span class="nf">remove_self_intersects</span><span class="p">(</span><span class="n">curve</span><span class="p">):</span></pre>
<pre class='cython code score-20 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_21remove_self_intersects(PyObject *__pyx_self, PyObject *__pyx_v_curve); /*proto*/
static char __pyx_doc_11trajeometry_20remove_self_intersects[] = "Remove self-intersecting parts in a discrete curve\n\t   - curve : ndarray[2, N] : Curve to process\n\t&lt;----------- ndarray[2, M] : That same curve with self-intersecting parts removed\n\t                             This operation only deletes points without changing the others";
static PyMethodDef __pyx_mdef_11trajeometry_21remove_self_intersects = {"remove_self_intersects", (PyCFunction)__pyx_pw_11trajeometry_21remove_self_intersects, METH_O, __pyx_doc_11trajeometry_20remove_self_intersects};
static PyObject *__pyx_pw_11trajeometry_21remove_self_intersects(PyObject *__pyx_self, PyObject *__pyx_v_curve) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("remove_self_intersects (wrapper)", 0);
  __pyx_r = __pyx_pf_11trajeometry_20remove_self_intersects(__pyx_self, ((PyObject *)__pyx_v_curve));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_20remove_self_intersects(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_curve) {
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("remove_self_intersects", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.remove_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mask);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__39 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_curve, __pyx_n_s_mask);<span class='error_goto'> if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__39);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_21remove_self_intersects, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_remove_self_intersects, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__40 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_remove_self_intersects, 398, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">399</span>: 	<span class="sd">&quot;&quot;&quot;Remove self-intersecting parts in a discrete curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: <span class="sd">	   - curve : ndarray[2, N] : Curve to process</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: <span class="sd">	&lt;----------- ndarray[2, M] : That same curve with self-intersecting parts removed</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>: <span class="sd">	                             This operation only deletes points without changing the others&quot;&quot;&quot;</span></pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>: 	<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_curve, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, ((PyObject *)(&amp;PyInt_Type))) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_mask = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">404</span>: 	<span class="n">find_self_intersects</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span></pre>
<pre class='cython code score-4 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_curve, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_v_mask, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  __pyx_f_11trajeometry_find_self_intersects(__pyx_t_5, __pyx_t_6, 0);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __pyx_t_5.memview = NULL;
  __pyx_t_5.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>: 	<span class="k">return</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">mask</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-22 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_mask, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_curve, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
/* … */
  __pyx_slice__3 = <span class='py_c_api'>PySlice_New</span>(Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__3);
</pre><pre class="cython line score-0">&#xA0;<span class="">406</span>: </pre>
<pre class="cython line score-79" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>: <span class="k">def</span> <span class="nf">dilate_curve</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span> <span class="n">dilation</span><span class="p">,</span> <span class="nb">long</span> <span class="n">direction</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">scores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-79 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_23dilate_curve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_22dilate_curve[] = "Apply a \"dilation\" operation to a discrete curve, that is, offset it regularly regardless of the curve orientation :\n\t   all points of the dilated curve are approximately at the same distance of their corresponding original point\n\t   - curve     : double[2, N] : Curve to dilate\n\t   - dilation  : double       : Distance of the result to the original curve\n\t   - direction : int          : 1 or -1, to choose the offset direction\n\t   - scores    : double[N]    : Scores associated to the original curve, or None.\n\t&lt;--------------- double[2, M] : Dilated curve. The number of points may not be the same, as self-intersecting parts are removed\n\t&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the dilated curve, with the same parts cut out\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_23dilate_curve = {"dilate_curve", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_23dilate_curve, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_22dilate_curve};
static PyObject *__pyx_pw_11trajeometry_23dilate_curve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_dilation;
  long __pyx_v_direction;
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dilate_curve (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_dilation,&amp;__pyx_n_s_direction,&amp;__pyx_n_s_scores,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dilation)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, 1); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_direction)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, 2); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_scores);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dilate_curve") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 407, __pyx_L3_error)</span>
    __pyx_v_dilation = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dilation == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
    __pyx_v_direction = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_direction == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 407, __pyx_L3_error)</span>
    } else {
      __pyx_v_scores = __pyx_k__4;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_scores, 1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.dilate_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_22dilate_curve(__pyx_self, __pyx_v_curve, __pyx_v_dilation, __pyx_v_direction, __pyx_v_scores);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_22dilate_curve(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_dilation, long __pyx_v_direction, __Pyx_memviewslice __pyx_v_scores) {
  double *__pyx_v_dilated;
  __Pyx_memviewslice __pyx_v_dilated_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_gradient[2];
  double __pyx_v_gradient_norm;
  Py_ssize_t __pyx_v_i;
  int *__pyx_v_mask;
  __Pyx_memviewslice __pyx_v_mask_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_result_size;
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_result_index;
  __Pyx_memviewslice __pyx_v_result_scores_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result_scores = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dilate_curve", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_14, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_18, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.dilate_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_dilated_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_mask_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_scores_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_scores);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  __pyx_k__4 = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
/* … */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_curve, __pyx_n_s_dilation, __pyx_n_s_direction, __pyx_n_s_scores, __pyx_n_s_dilated, __pyx_n_s_dilated_view, __pyx_n_s_gradient, __pyx_n_s_gradient_norm, __pyx_n_s_i, __pyx_n_s_mask, __pyx_n_s_mask_view, __pyx_n_s_result_size, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_result_index, __pyx_n_s_result_scores_view, __pyx_n_s_result_scores);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_23dilate_curve, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dilate_curve, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__42 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_dilate_curve, 407, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>: 	<span class="sd">&quot;&quot;&quot;Apply a &quot;dilation&quot; operation to a discrete curve, that is, offset it regularly regardless of the curve orientation :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: <span class="sd">	   all points of the dilated curve are approximately at the same distance of their corresponding original point</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: <span class="sd">	   - curve     : double[2, N] : Curve to dilate</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: <span class="sd">	   - dilation  : double       : Distance of the result to the original curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: <span class="sd">	   - direction : int          : 1 or -1, to choose the offset direction</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>: <span class="sd">	   - scores    : double[N]    : Scores associated to the original curve, or None.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>: <span class="sd">	&lt;--------------- double[2, M] : Dilated curve. The number of points may not be the same, as self-intersecting parts are removed</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: <span class="sd">	&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the dilated curve, with the same parts cut out</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: 	<span class="c"># FIRST STEP : Offset the curve along its orthogonal vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>: 	<span class="k">cdef</span> <span class="kt">double</span>* <span class="nf">dilated</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span><span class="o">*&gt;</span> <span class="n">malloc</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_dilated = ((double *)malloc((((__pyx_v_curve.shape[0]) * (__pyx_v_curve.shape[1])) * (sizeof(double)))));
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">dilated_view</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span><span class="p">[:</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="p">:</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span><span class="mf">1</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">dilated</span></pre>
<pre class='cython code score-11 '>  if (!__pyx_v_dilated) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
    <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L1_error)</span>
  }
  __pyx_t_3 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_curve.shape[0])), ((Py_ssize_t)(__pyx_v_curve.shape[1])));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = __pyx_array_new(__pyx_t_2, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_3), (char *) "c", (char *) __pyx_v_dilated);
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_t_1), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_v_dilated_view = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[2] <span class="nf">gradient</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">gradient_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">424</span>: 		<span class="c"># Calculate the gradient with [-1, 0, 1] when possible, otherwise just the outgoing or incoming vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">425</span>: 		<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_i == 0) != 0);
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = 0;
      __pyx_t_10 = (__pyx_v_i + 1);
      __pyx_t_11 = 0;
      __pyx_t_12 = __pyx_v_i;
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = (__pyx_v_i + 1);
      __pyx_t_10 = 1;
      __pyx_t_9 = __pyx_v_i;
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">428</span>: 		<span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_i == ((__pyx_v_curve.shape[1]) - 1)) != 0);
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = 0;
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = 0;
      __pyx_t_12 = (__pyx_v_i - 1);
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = 1;
      __pyx_t_9 = (__pyx_v_i - 1);
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>: 		<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">432</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_9 = 0;
      __pyx_t_10 = (__pyx_v_i + 1);
      __pyx_t_11 = 0;
      __pyx_t_12 = (__pyx_v_i - 1);
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">433</span>: 			<span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = (__pyx_v_i + 1);
      __pyx_t_10 = 1;
      __pyx_t_9 = (__pyx_v_i - 1);
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>: 		<span class="n">gradient_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_v_gradient_norm = sqrt((((__pyx_v_gradient[0]) * (__pyx_v_gradient[0])) + ((__pyx_v_gradient[1]) * (__pyx_v_gradient[1]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">435</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">436</span>: 		<span class="c"># Offset by `dilation` in the direction orthogonal to the gradient, with direction to possibly reverse the orthogonal vectors</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">437</span>: 		<span class="n">dilated_view</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">direction</span><span class="o">*</span><span class="n">gradient</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dilation</span> <span class="o">/</span> <span class="n">gradient_norm</span></pre>
<pre class='cython code score-5 '>    __pyx_t_9 = 0;
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_13 = ((__pyx_v_direction * (__pyx_v_gradient[1])) * __pyx_v_dilation);
    if (unlikely(__pyx_v_gradient_norm == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 437, __pyx_L1_error)</span>
    }
    __pyx_t_11 = 0;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_dilated_view.data + __pyx_t_11 * __pyx_v_dilated_view.strides[0]) ) + __pyx_t_12 * __pyx_v_dilated_view.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (__pyx_t_13 / __pyx_v_gradient_norm));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>: 		<span class="n">dilated_view</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">direction</span><span class="o">*</span><span class="n">gradient</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dilation</span> <span class="o">/</span> <span class="n">gradient_norm</span></pre>
<pre class='cython code score-5 '>    __pyx_t_10 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_13 = ((__pyx_v_direction * (__pyx_v_gradient[0])) * __pyx_v_dilation);
    if (unlikely(__pyx_v_gradient_norm == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
    }
    __pyx_t_12 = 1;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_dilated_view.data + __pyx_t_12 * __pyx_v_dilated_view.strides[0]) ) + __pyx_t_11 * __pyx_v_dilated_view.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) + (__pyx_t_13 / __pyx_v_gradient_norm));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">440</span>: 	<span class="c"># SECOND STEP : Remove self-intersections with the mask computed by `find_self_intersects`</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>: 	<span class="k">cdef</span> <span class="kt">bint</span>* <span class="nf">mask</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">bint</span><span class="o">*&gt;</span><span class="n">malloc</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">bint</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>  __pyx_v_mask = ((int *)malloc(((__pyx_v_curve.shape[1]) * (sizeof(int)))));
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>: 	<span class="k">cdef</span> <span class="kt">bint</span>[<span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">mask_view</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">bint</span><span class="p">[:</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]:</span><span class="mf">1</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">mask</span></pre>
<pre class='cython code score-11 '>  if (!__pyx_v_mask) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
    <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  }
  __pyx_t_2 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_int);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_curve.shape[1])));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = __pyx_array_new(__pyx_t_3, sizeof(int), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_2), (char *) "fortran", (char *) __pyx_v_mask);
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_int</span>(((PyObject *)__pyx_t_1), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  __pyx_v_mask_view = __pyx_t_14;
  __pyx_t_14.memview = NULL;
  __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">443</span>: 	<span class="n">find_self_intersects</span><span class="p">(</span><span class="n">dilated_view</span><span class="p">,</span> <span class="n">mask_view</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_f_11trajeometry_find_self_intersects(__pyx_v_dilated_view, __pyx_v_mask_view, 0);
</pre><pre class="cython line score-0">&#xA0;<span class="">444</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">result_size</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_result_size = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">447</span>: 		<span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_mask[__pyx_v_i]) != 0);
    if (__pyx_t_8) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">448</span>: 			<span class="n">result_size</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_result_size = (__pyx_v_result_size + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">449</span>: </pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>: 	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="n">result_size</span><span class="p">))</span></pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_result_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
    }
  }
  __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_3, __pyx_t_16) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_15, __pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  __pyx_v_result = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">result_view</span> <span class="o">=</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 451, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">452</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">result_index</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_result_index = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>: 		<span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_mask[__pyx_v_i]) != 0);
    if (__pyx_t_8) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>: 			<span class="n">result_view</span><span class="p">[:,</span> <span class="n">result_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">dilated_view</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17.data = __pyx_v_dilated_view.data;
      __pyx_t_17.memview = __pyx_v_dilated_view.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_17, 0);
      __pyx_t_17.shape[0] = __pyx_v_dilated_view.shape[0];
__pyx_t_17.strides[0] = __pyx_v_dilated_view.strides[0];
    __pyx_t_17.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dilated_view.strides[1];
        __pyx_t_17.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_18.data = __pyx_v_result_view.data;
      __pyx_t_18.memview = __pyx_v_result_view.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_18, 0);
      __pyx_t_18.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_18.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_18.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_result_index;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_18.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_17, __pyx_t_18, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_18, 1);
      __pyx_t_18.memview = NULL;
      __pyx_t_18.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
      __pyx_t_17.memview = NULL;
      __pyx_t_17.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">456</span>: 			<span class="n">result_index</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_v_result_index = (__pyx_v_result_index + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">457</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">458</span>: 	<span class="c"># Compute the associated scores if necessary</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">result_scores_view</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">460</span>: 	<span class="k">if</span> <span class="n">scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((((PyObject *) __pyx_v_scores.memview) != Py_None) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>: 		<span class="n">result_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">result_size</span><span class="p">)</span></pre>
<pre class='cython code score-25 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_15, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_result_size);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_16, __pyx_t_3, __pyx_t_15) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_16, __pyx_t_15);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_v_result_scores = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>: 		<span class="n">result_scores_view</span> <span class="o">=</span> <span class="n">result_scores</span></pre>
<pre class='cython code score-2 '>    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_result_scores, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
    __pyx_v_result_scores_view = __pyx_t_17;
    __pyx_t_17.memview = NULL;
    __pyx_t_17.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">463</span>: 		<span class="n">result_index</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_result_index = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>: 		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_curve.shape[1]);
    __pyx_t_6 = __pyx_t_5;
    for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>: 			<span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = ((__pyx_v_mask[__pyx_v_i]) != 0);
      if (__pyx_t_8) {
/* … */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">466</span>: 				<span class="n">result_scores_view</span><span class="p">[</span><span class="n">result_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_result_index;
        *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_10 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_9 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>: 				<span class="n">result_index</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_v_result_index = (__pyx_v_result_index + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">468</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">469</span>: 	<span class="n">free</span><span class="p">(</span><span class="n">dilated</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  free(__pyx_v_dilated);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">470</span>: 	<span class="n">free</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  free(__pyx_v_mask);
</pre><pre class="cython line score-0">&#xA0;<span class="">471</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">472</span>: 	<span class="k">if</span> <span class="n">scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = ((((PyObject *) __pyx_v_scores.memview) != Py_None) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">473</span>: 		<span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result_scores</span></pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    if (unlikely(!__pyx_v_result_scores)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("result_scores"); <span class='error_goto'>__PYX_ERR(0, 473, __pyx_L1_error)</span> }
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 473, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_result);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result_scores);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result_scores);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_result_scores);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">474</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">475</span>: 		<span class="k">return</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    __pyx_r = __pyx_v_result;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">476</span>: </pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">477</span>: <span class="k">def</span> <span class="nf">strip_angles</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="n">double</span> <span class="n">max_angle</span><span class="p">,</span> <span class="n">double</span><span class="p">[:]</span> <span class="n">scores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span></pre>
<pre class='cython code score-66 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_25strip_angles(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_24strip_angles[] = "Cut out the points that make too sharp angles in the curve\n\t   - curve     : double[2, N] : Discrete curve to process\n\t   - max_angle : double       : Cut angles that are sharper than this (so, lower angle value), in radians\n\t   - scores    : double[N]    : Scores associated to each point of the curve, or None\n\t&lt;--------------- double[2, M] : Curve with sharp angles deleted\n\t&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the resulting curve, with the same points cut out\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_25strip_angles = {"strip_angles", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_25strip_angles, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_24strip_angles};
static PyObject *__pyx_pw_11trajeometry_25strip_angles(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_max_angle;
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("strip_angles (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_max_angle,&amp;__pyx_n_s_scores,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_max_angle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("strip_angles", 0, 2, 3, 1); <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_scores);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "strip_angles") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 477, __pyx_L3_error)</span>
    __pyx_v_max_angle = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_max_angle == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 477, __pyx_L3_error)</span>
    } else {
      __pyx_v_scores = __pyx_k__5;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_scores, 1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("strip_angles", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.strip_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_24strip_angles(__pyx_self, __pyx_v_curve, __pyx_v_max_angle, __pyx_v_scores);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_24strip_angles(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_max_angle, __Pyx_memviewslice __pyx_v_scores) {
  std::vector&lt;Py_ssize_t&gt;  __pyx_v_valid_indices;
  Py_ssize_t __pyx_v_i;
  double __pyx_v_angle;
  double __pyx_v_left_vector[2];
  double __pyx_v_right_vector[2];
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  size_t __pyx_v_result_index;
  __Pyx_memviewslice __pyx_v_result_scores_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result_scores = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("strip_angles", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_8));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_16, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.strip_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_scores_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_scores);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  __pyx_k__5 = __pyx_t_2;
  __pyx_t_2.memview = NULL;
  __pyx_t_2.data = NULL;
/* … */
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(15, __pyx_n_s_curve, __pyx_n_s_max_angle, __pyx_n_s_scores, __pyx_n_s_valid_indices, __pyx_n_s_i, __pyx_n_s_left_norm, __pyx_n_s_right_norm, __pyx_n_s_angle, __pyx_n_s_left_vector, __pyx_n_s_right_vector, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_result_index, __pyx_n_s_result_scores_view, __pyx_n_s_result_scores);<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_25strip_angles, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_strip_angles, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__44 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_strip_angles, 477, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">478</span>: 	<span class="sd">&quot;&quot;&quot;Cut out the points that make too sharp angles in the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>: <span class="sd">	   - curve     : double[2, N] : Discrete curve to process</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: <span class="sd">	   - max_angle : double       : Cut angles that are sharper than this (so, lower angle value), in radians</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: <span class="sd">	   - scores    : double[N]    : Scores associated to each point of the curve, or None</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: <span class="sd">	&lt;--------------- double[2, M] : Curve with sharp angles deleted</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: <span class="sd">	&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the resulting curve, with the same points cut out</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: 	<span class="k">cdef</span> <span class="kt">vector</span>[<span class="kt">Py_ssize_t</span>] <span class="nf">valid_indices</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">left_norm</span><span class="p">,</span> <span class="nf">right_norm</span><span class="p">,</span> <span class="nf">angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[2] <span class="nf">left_vector</span><span class="p">,</span> <span class="nf">right_vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">489</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 1; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">490</span>: 		<span class="c"># Compute the angle between the outgoing vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">491</span>: 		<span class="n">left_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i - 1);
    __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_v_i;
    (__pyx_v_left_vector[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">492</span>: 		<span class="n">left_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i - 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    (__pyx_v_left_vector[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">493</span>: 		<span class="n">right_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_v_i;
    (__pyx_v_right_vector[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>: 		<span class="n">right_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i + 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    (__pyx_v_right_vector[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">495</span>: 		<span class="n">angle</span> <span class="o">=</span> <span class="n">vector_angle</span><span class="p">(</span><span class="n">left_vector</span><span class="p">,</span> <span class="n">right_vector</span><span class="p">)</span></pre>
<pre class='cython code score-12 '>    __pyx_t_10 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_9 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_8 = __pyx_array_new(__pyx_t_9, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_10), (char *) "fortran", (char *) __pyx_v_left_vector);
    if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_8), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_t_9 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_8 = __pyx_array_new(__pyx_t_10, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_9), (char *) "fortran", (char *) __pyx_v_right_vector);
    if (unlikely(!__pyx_t_8)) <span class='error_goto'>__PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_8), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_8)); __pyx_t_8 = 0;
    __pyx_v_angle = __pyx_f_11trajeometry_vector_angle(__pyx_t_11, __pyx_t_12, 0);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.memview = NULL;
    __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">496</span>: 		<span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="n">max_angle</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_angle &gt; __pyx_v_max_angle) != 0);
    if (__pyx_t_13) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">497</span>: 			<span class="n">valid_indices</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      try {
        __pyx_v_valid_indices.push_back(__pyx_v_i);
      } catch(...) {
        __Pyx_CppExn2PyErr();
        <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">498</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>: 	<span class="c"># Copy the resulting point to a fixed numpy array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>: 	<span class="c"># Don’t forget to include the initial and final points</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>: 	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">2</span><span class="p">))</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>((__pyx_v_valid_indices.size() + 2));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
    }
  }
  __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_14, __pyx_t_10, __pyx_t_15) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_14, __pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_v_result = __pyx_t_9;
  __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">result_view</span> <span class="o">=</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_16;
  __pyx_t_16.memview = NULL;
  __pyx_t_16.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>: 	<span class="n">result_view</span><span class="p">[:,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12.data = __pyx_v_curve.data;
  __pyx_t_12.memview = __pyx_v_curve.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 0);
  __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
  __pyx_t_11.memview = __pyx_v_result_view.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 0);
  __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>: 	<span class="n">result_view</span><span class="p">[:,</span> <span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_12.data = __pyx_v_curve.data;
  __pyx_t_12.memview = __pyx_v_curve.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 0);
  __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = ((__pyx_v_curve.shape[1]) - 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
  __pyx_t_11.memview = __pyx_v_result_view.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 0);
  __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_valid_indices.size() + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">505</span>: 	<span class="k">cdef</span> <span class="kt">size_t</span> <span class="nf">result_index</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>: 	<span class="k">for</span> <span class="n">result_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_17 = __pyx_v_valid_indices.size();
  __pyx_t_18 = __pyx_t_17;
  for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
    __pyx_v_result_index = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>: 		<span class="n">result_view</span><span class="p">[:,</span> <span class="n">result_index</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[:,</span> <span class="n">valid_indices</span><span class="p">[</span><span class="n">result_index</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12.data = __pyx_v_curve.data;
    __pyx_t_12.memview = __pyx_v_curve.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 0);
    __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_valid_indices[__pyx_v_result_index]);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
    __pyx_t_11.memview = __pyx_v_result_view.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 0);
    __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_result_index + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.memview = NULL;
    __pyx_t_12.data = NULL;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">508</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>: 	<span class="c"># If necessary, also filter the scores</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">510</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">result_scores_view</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">511</span>: 	<span class="k">if</span> <span class="n">scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_13 = ((((PyObject *) __pyx_v_scores.memview) != Py_None) != 0);
  if (__pyx_t_13) {
/* … */
  }
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">512</span>: 		<span class="n">result_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_14, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>((__pyx_v_valid_indices.size() + 2));<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
      }
    }
    __pyx_t_9 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_15, __pyx_t_10, __pyx_t_14) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_15, __pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_v_result_scores = __pyx_t_9;
    __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">513</span>: 		<span class="n">result_scores_view</span> <span class="o">=</span> <span class="n">result_scores</span></pre>
<pre class='cython code score-2 '>    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_result_scores, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    __pyx_v_result_scores_view = __pyx_t_12;
    __pyx_t_12.memview = NULL;
    __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>: 		<span class="n">result_scores_view</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_5 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">515</span>: 		<span class="n">result_scores_view</span><span class="p">[</span><span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_v_scores.shape[0]) - 1);
    __pyx_t_17 = (__pyx_v_valid_indices.size() + 1);
    *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_17 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">516</span>: 		<span class="k">for</span> <span class="n">result_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">valid_indices</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = __pyx_v_valid_indices.size();
    __pyx_t_18 = __pyx_t_17;
    for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
      __pyx_v_result_index = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>: 			<span class="n">result_scores_view</span><span class="p">[</span><span class="n">result_index</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="n">valid_indices</span><span class="p">[</span><span class="n">result_index</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = (__pyx_v_valid_indices[__pyx_v_result_index]);
      __pyx_t_20 = (__pyx_v_result_index + 1);
      *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_20 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
    }
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">518</span>: 		<span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result_scores</span></pre>
<pre class='cython code score-10 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_v_result);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result_scores);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result_scores);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_v_result_scores);
    __pyx_r = __pyx_t_9;
    __pyx_t_9 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">519</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">520</span>: 		<span class="k">return</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    __pyx_r = __pyx_v_result;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">521</span>: </pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">522</span>: <span class="k">cpdef</span> <span class="kt">int</span> <span class="nf">savgol_window</span><span class="p">(</span><span class="nb">int</span> <span class="n">base_size</span><span class="p">,</span> <span class="nb">int</span> <span class="n">array_size</span><span class="p">):</span></pre>
<pre class='cython code score-44 '>static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_f_11trajeometry_savgol_window(int __pyx_v_base_size, int __pyx_v_array_size, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_window", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_26savgol_window[] = "Compute the best window size of the Savitzky-Golay filter for the given array size\n\t   - base_size  : int : Initial target window size\n\t   - array_size : int : Array size the filter has to be applied to\n\t&lt;---------------- int : Optimal window size for the array (odd value, &lt; array_size)";
static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  int __pyx_v_base_size;
  int __pyx_v_array_size;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_window (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_base_size,&amp;__pyx_n_s_array_size,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_base_size)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_array_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_window", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "savgol_window") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_base_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]); if (unlikely((__pyx_v_base_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
    __pyx_v_array_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_array_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_window", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_window", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_26savgol_window(__pyx_self, __pyx_v_base_size, __pyx_v_array_size);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_26savgol_window(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_base_size, int __pyx_v_array_size) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_window", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_f_11trajeometry_savgol_window(__pyx_v_base_size, __pyx_v_array_size, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_window", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">523</span>: 	<span class="sd">&quot;&quot;&quot;Compute the best window size of the Savitzky-Golay filter for the given array size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">524</span>: <span class="sd">	   - base_size  : int : Initial target window size</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">525</span>: <span class="sd">	   - array_size : int : Array size the filter has to be applied to</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">526</span>: <span class="sd">	&lt;---------------- int : Optimal window size for the array (odd value, &lt; array_size)&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>: 	<span class="k">if</span> <span class="n">base_size</span> <span class="o">&lt;</span> <span class="n">array_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_base_size &lt; __pyx_v_array_size) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">528</span>: 		<span class="k">return</span> <span class="n">base_size</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">base_size</span> <span class="o">%</span> <span class="mf">2</span><span class="p">)</span>  <span class="c"># Make it odd</span></pre>
<pre class='cython code score-0 '>    __pyx_r = (__pyx_v_base_size - (1 - __Pyx_mod_long(__pyx_v_base_size, 2)));
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">529</span>: 	<span class="k">else</span><span class="p">:</span>  <span class="c"># Array size smaller than the window size : use the array size as window size</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>: 		<span class="k">return</span> <span class="n">array_size</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">array_size</span> <span class="o">%</span> <span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = (__pyx_v_array_size - (1 - __Pyx_mod_long(__pyx_v_array_size, 2)));
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">531</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">532</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">533</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_savgol_coeffs_degree23</span><span class="p">(</span><span class="n">double</span><span class="p">[:]</span> <span class="n">coeffs</span><span class="p">,</span> <span class="nb">int</span> <span class="n">window_size</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_11trajeometry__savgol_coeffs_degree23(__Pyx_memviewslice __pyx_v_coeffs, int __pyx_v_window_size) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_i_first;
  Py_ssize_t __pyx_v_i_last;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_savgol_coeffs_degree23", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry._savgol_coeffs_degree23", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">534</span>: 	<span class="sd">&quot;&quot;&quot;Compute the Savitzky-Golay filter coefficients for the given `window_size` and polynomial degree 2 or 3,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>: <span class="sd">	   and put them in `coeffs`. There are `window_size` coefficients&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">i_first</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">window_size</span><span class="p">)</span> <span class="o">//</span> <span class="mf">2</span><span class="p">,</span> <span class="n">i_last</span> <span class="o">=</span> <span class="p">(</span><span class="n">window_size</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">//</span> <span class="mf">2</span></pre>
<pre class='cython code score-0 '>  __pyx_v_i_first = __Pyx_div_long((1 - __pyx_v_window_size), 2);
  __pyx_v_i_last = __Pyx_div_long((__pyx_v_window_size - 1), 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_first</span><span class="p">,</span> <span class="n">i_last</span> <span class="o">+</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_i_last + 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = __pyx_v_i_first; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>: 		<span class="n">coeffs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">i_first</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mf">3</span> <span class="o">*</span> <span class="n">window_size</span><span class="o">*</span><span class="n">window_size</span> <span class="o">-</span> <span class="mf">7</span> <span class="o">-</span> <span class="mf">20</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">window_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">window_size</span><span class="o">**</span><span class="mf">2</span> <span class="o">-</span> <span class="mf">4</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_4 = (((double)((((3 * __pyx_v_window_size) * __pyx_v_window_size) - 7) - ((20 * __pyx_v_i) * __pyx_v_i))) / 4.0);
    __pyx_t_5 = (((double)(__pyx_v_window_size * (__Pyx_pow_long(((long)__pyx_v_window_size), 2) - 4))) / 3.0);
    if (unlikely(__pyx_t_5 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L1_error)</span>
    }
    __pyx_t_6 = (__pyx_v_i - __pyx_v_i_first);
    *((double *) ( /* dim=0 */ (__pyx_v_coeffs.data + __pyx_t_6 * __pyx_v_coeffs.strides[0]) )) = (__pyx_t_4 / __pyx_t_5);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">539</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">540</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">541</span>: <span class="c"># Cache for reused Savitzky-Golay coefficients</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">542</span>: <span class="c"># TODO : Use a C++ map</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>: <span class="k">cdef</span> <span class="kt">dict</span> <span class="nf">_savgol_coeffs_cache</span> <span class="o">=</span> <span class="p">{}</span></pre>
<pre class='cython code score-3 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_v_11trajeometry__savgol_coeffs_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, ((PyObject*)__pyx_t_1));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">544</span>: </pre>
<pre class="cython line score-68" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>: <span class="k">def</span> <span class="nf">savgol_filter</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">,</span> <span class="nb">int</span> <span class="n">window_size</span><span class="p">,</span> <span class="nb">int</span> <span class="n">savgol_degree</span><span class="p">):</span></pre>
<pre class='cython code score-68 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_29savgol_filter(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_11trajeometry_28savgol_filter[] = "Apply a Savitzky-Golay filter on the given curve samples\n\t   - curve         : double[2, N] : Numerical curve to smooth\n\t   - window_size   : int          : Filter window size, must be odd and greater than `savgol_degree`\n\t   - savgol_degree : int          : Polynomial degree of the filter. Currently only support 2 and 3\n\t&lt;------------------- double[2, N] : Filtered curve samples\n\t";
static PyMethodDef __pyx_mdef_11trajeometry_29savgol_filter = {"savgol_filter", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11trajeometry_29savgol_filter, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11trajeometry_28savgol_filter};
static PyObject *__pyx_pw_11trajeometry_29savgol_filter(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_window_size;
  int __pyx_v_savgol_degree;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_filter (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_window_size,&amp;__pyx_n_s_savgol_degree,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_window_size)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_savgol_degree)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "savgol_filter") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 545, __pyx_L3_error)</span>
    __pyx_v_window_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_window_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
    __pyx_v_savgol_degree = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_savgol_degree == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_28savgol_filter(__pyx_self, __pyx_v_curve, __pyx_v_window_size, __pyx_v_savgol_degree);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_28savgol_filter(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_window_size, int __pyx_v_savgol_degree) {
  PyObject *__pyx_v_coeffs = NULL;
  Py_ssize_t __pyx_v_row;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_x;
  Py_ssize_t __pyx_v_npoints;
  Py_ssize_t __pyx_v_nrows;
  Py_ssize_t __pyx_v_i_first;
  Py_ssize_t __pyx_v_conv_index;
  __Pyx_memviewslice __pyx_v_coeffs_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_start_vector;
  double __pyx_v_end_vector;
  double __pyx_v_conv_value;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_filter", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coeffs);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_coeffs_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__45 = <span class='py_c_api'>PyTuple_Pack</span>(18, __pyx_n_s_curve, __pyx_n_s_window_size, __pyx_n_s_savgol_degree, __pyx_n_s_coeffs, __pyx_n_s_row, __pyx_n_s_i, __pyx_n_s_x, __pyx_n_s_npoints, __pyx_n_s_nrows, __pyx_n_s_i_first, __pyx_n_s_conv_index, __pyx_n_s_conv_x, __pyx_n_s_coeffs_view, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_start_vector, __pyx_n_s_end_vector, __pyx_n_s_conv_value);<span class='error_goto'> if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__45);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__45);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_11trajeometry_29savgol_filter, NULL, __pyx_n_s_trajeometry);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_savgol_filter, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__46 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__45, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_savgol_filter, 545, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__46)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">546</span>: 	<span class="sd">&quot;&quot;&quot;Apply a Savitzky-Golay filter on the given curve samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">547</span>: <span class="sd">	   - curve         : double[2, N] : Numerical curve to smooth</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">548</span>: <span class="sd">	   - window_size   : int          : Filter window size, must be odd and greater than `savgol_degree`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>: <span class="sd">	   - savgol_degree : int          : Polynomial degree of the filter. Currently only support 2 and 3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>: <span class="sd">	&lt;------------------- double[2, N] : Filtered curve samples</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>: 	<span class="c"># Check the assumptions of this implementation</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">553</span>: 	<span class="k">assert</span> <span class="n">savgol_degree</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    switch (__pyx_v_savgol_degree) {
      case 2:
      case 3:
      __pyx_t_1 = 1;
      break;
      default:
      __pyx_t_1 = 0;
      break;
    }
    if (unlikely(!(__pyx_t_1 != 0))) {
      <span class='py_c_api'>PyErr_SetNone</span>(PyExc_AssertionError);
      <span class='error_goto'>__PYX_ERR(0, 553, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>: 	<span class="k">assert</span> <span class="n">window_size</span> <span class="o">%</span> <span class="mf">2</span> <span class="o">==</span> <span class="mf">1</span></pre>
<pre class='cython code score-5 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    if (unlikely(!((__Pyx_mod_long(__pyx_v_window_size, 2) == 1) != 0))) {
      <span class='py_c_api'>PyErr_SetNone</span>(PyExc_AssertionError);
      <span class='error_goto'>__PYX_ERR(0, 554, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>: 	<span class="k">assert</span> <span class="n">window_size</span> <span class="o">&lt;=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">window_size</span> <span class="o">&gt;</span> <span class="n">savgol_degree</span></pre>
<pre class='cython code score-5 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    __pyx_t_2 = ((__pyx_v_window_size &lt;= (__pyx_v_curve.shape[1])) != 0);
    if (__pyx_t_2) {
    } else {
      __pyx_t_1 = __pyx_t_2;
      goto __pyx_L3_bool_binop_done;
    }
    __pyx_t_2 = ((__pyx_v_window_size &gt; __pyx_v_savgol_degree) != 0);
    __pyx_t_1 = __pyx_t_2;
    __pyx_L3_bool_binop_done:;
    if (unlikely(!__pyx_t_1)) {
      <span class='py_c_api'>PyErr_SetNone</span>(PyExc_AssertionError);
      <span class='error_goto'>__PYX_ERR(0, 555, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">556</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>: 	<span class="c"># Compute the convolution coefficients, or get them from the cache</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>: 	<span class="k">if</span> <span class="p">(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">savgol_degree</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_savgol_coeffs_cache</span><span class="p">:</span></pre>
<pre class='cython code score-19 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
    <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>
  }
  __pyx_t_1 = (<span class='pyx_c_api'>__Pyx_PyDict_ContainsTF</span>(__pyx_t_5, __pyx_v_11trajeometry__savgol_coeffs_cache, Py_EQ)); if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
/* … */
    goto __pyx_L5;
  }
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>: 		<span class="n">coeffs</span> <span class="o">=</span> <span class="n">_savgol_coeffs_cache</span><span class="p">[(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">savgol_degree</span><span class="p">)]</span></pre>
<pre class='cython code score-19 '>    if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>
    }
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_4);
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_coeffs = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">560</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>: 		<span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">window_size</span><span class="p">)</span></pre>
<pre class='cython code score-22 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_coeffs = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">562</span>: 		<span class="n">_savgol_coeffs_degree23</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">window_size</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_coeffs, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 562, __pyx_L1_error)</span>
    __pyx_f_11trajeometry__savgol_coeffs_degree23(__pyx_t_7, __pyx_v_window_size);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">563</span>: 		<span class="n">_savgol_coeffs_cache</span><span class="p">[(</span><span class="n">window_size</span><span class="p">,</span> <span class="n">savgol_degree</span><span class="p">)]</span> <span class="o">=</span> <span class="n">coeffs</span></pre>
<pre class='cython code score-22 '>    if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>
    }
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_5);
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, __pyx_t_3, __pyx_v_coeffs) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">564</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>: 	<span class="c"># Now apply a simple convolution to the curve</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>: 	<span class="c"># To avoid squishing the extreme points, we extrapolate the curve using its extreme vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">567</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">row</span><span class="p">,</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">x</span><span class="p">,</span> <span class="nf">npoints</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">i_first</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">window_size</span><span class="p">)</span> <span class="o">//</span> <span class="mf">2</span><span class="p">,</span> <span class="n">conv_index</span></pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_curve.shape[1]);
  __pyx_v_nrows = (__pyx_v_curve.shape[0]);
  __pyx_v_i_first = __Pyx_div_long((1 - __pyx_v_window_size), 2);
</pre><pre class="cython line score-0">&#xA0;<span class="">568</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">conv_x</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">569</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:]</span> <span class="n">coeffs_view</span> <span class="o">=</span> <span class="n">coeffs</span></pre>
<pre class='cython code score-2 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_coeffs, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 569, __pyx_L1_error)</span>
  __pyx_v_coeffs_view = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">570</span>: 	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-37 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_curve.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_curve.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_6);
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_8) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_result = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">result_view</span> <span class="o">=</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 571, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">572</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">start_vector</span><span class="p">,</span> <span class="nf">end_vector</span><span class="p">,</span> <span class="nf">conv_value</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>: 	<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = __pyx_v_nrows;
  __pyx_t_11 = __pyx_t_10;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_row = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>: 		<span class="n">start_vector</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = __pyx_v_row;
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_row;
    __pyx_t_16 = 1;
    __pyx_v_start_vector = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_13 * __pyx_v_curve.strides[0]) ) + __pyx_t_14 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_15 * __pyx_v_curve.strides[0]) ) + __pyx_t_16 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>: 		<span class="n">end_vector</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">npoints</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">npoints</span><span class="o">-</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_row;
    __pyx_t_15 = (__pyx_v_npoints - 1);
    __pyx_t_14 = __pyx_v_row;
    __pyx_t_13 = (__pyx_v_npoints - 2);
    __pyx_v_end_vector = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_16 * __pyx_v_curve.strides[0]) ) + __pyx_t_15 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_14 * __pyx_v_curve.strides[0]) ) + __pyx_t_13 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>: 		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_17 = __pyx_v_npoints;
    __pyx_t_18 = __pyx_t_17;
    for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
      __pyx_v_x = __pyx_t_19;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>: 			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">window_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_20 = __pyx_v_window_size;
      __pyx_t_21 = __pyx_t_20;
      for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_21; __pyx_t_22+=1) {
        __pyx_v_i = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">578</span>: 				<span class="c"># Index of the point to multiply this coefficient with</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">579</span>: 				<span class="n">conv_index</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">i_first</span></pre>
<pre class='cython code score-0 '>        __pyx_v_conv_index = ((__pyx_v_x + __pyx_v_i) + __pyx_v_i_first);
</pre><pre class="cython line score-0">&#xA0;<span class="">580</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>: 				<span class="c"># Index &lt; 0 -&gt; before the first sample. Extend with the first vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">582</span>: 				<span class="k">if</span> <span class="n">conv_index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_2 = ((__pyx_v_conv_index &lt; 0) != 0);
        if (__pyx_t_2) {
/* … */
          goto __pyx_L12;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">583</span>: 					<span class="n">conv_value</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_vector</span><span class="o">*</span><span class="n">conv_index</span></pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_row;
          __pyx_t_14 = 0;
          __pyx_v_conv_value = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_13 * __pyx_v_curve.strides[0]) ) + __pyx_t_14 * __pyx_v_curve.strides[1]) ))) - (__pyx_v_start_vector * __pyx_v_conv_index));
</pre><pre class="cython line score-0">&#xA0;<span class="">584</span>: 				<span class="c"># Index &gt;= npoints -&gt; beyond the last sample. Extend with the last vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">585</span>: 				<span class="k">elif</span> <span class="n">conv_index</span> <span class="o">&gt;=</span> <span class="n">npoints</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_2 = ((__pyx_v_conv_index &gt;= __pyx_v_npoints) != 0);
        if (__pyx_t_2) {
/* … */
          goto __pyx_L12;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>: 					<span class="n">conv_value</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">npoints</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">end_vector</span><span class="o">*</span><span class="p">(</span><span class="n">conv_index</span> <span class="o">-</span> <span class="p">(</span><span class="n">npoints</span><span class="o">-</span><span class="mf">1</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_row;
          __pyx_t_13 = (__pyx_v_npoints - 1);
          __pyx_v_conv_value = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_14 * __pyx_v_curve.strides[0]) ) + __pyx_t_13 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_end_vector * (__pyx_v_conv_index - (__pyx_v_npoints - 1))));
</pre><pre class="cython line score-0">&#xA0;<span class="">587</span>: 				<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">588</span>: 					<span class="n">conv_value</span> <span class="o">=</span> <span class="n">curve</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">conv_index</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_13 = __pyx_v_row;
          __pyx_t_14 = __pyx_v_conv_index;
          __pyx_v_conv_value = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_13 * __pyx_v_curve.strides[0]) ) + __pyx_t_14 * __pyx_v_curve.strides[1]) )));
        }
        __pyx_L12:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">589</span>: 				<span class="n">result_view</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">+=</span> <span class="n">conv_value</span> <span class="o">*</span> <span class="n">coeffs_view</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_14 = __pyx_v_i;
        __pyx_t_13 = __pyx_v_row;
        __pyx_t_15 = __pyx_v_x;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_result_view.data + __pyx_t_13 * __pyx_v_result_view.strides[0]) ) + __pyx_t_15 * __pyx_v_result_view.strides[1]) )) += (__pyx_v_conv_value * (*((double *) ( /* dim=0 */ (__pyx_v_coeffs_view.data + __pyx_t_14 * __pyx_v_coeffs_view.strides[0]) ))));
      }
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>: 	<span class="k">return</span> <span class="n">result</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">591</span>: </pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>: <span class="k">cpdef</span> <span class="kt">double</span> <span class="nf">mean_curvature</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve</span><span class="p">):</span></pre>
<pre class='cython code score-18 '>static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, PyObject *__pyx_arg_curve); /*proto*/
static double __pyx_f_11trajeometry_mean_curvature(__Pyx_memviewslice __pyx_v_curve, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_valid_points;
  double __pyx_v_prev_vector[2];
  double __pyx_v_next_vector[2];
  double __pyx_v_curvature_sum;
  double __pyx_v_prev_vector_norm;
  double __pyx_v_next_vector_norm;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_curvature", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_t_14));
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_18, 1);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, PyObject *__pyx_arg_curve); /*proto*/
static char __pyx_doc_11trajeometry_30mean_curvature[] = "Compute the mean curvature of the given curve, in rad/unit\n\t   - curve : double[2, N] : Curve to process\n\t&lt;----------- Mean of the local curvatures in rad/length unit\n\t";
static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, PyObject *__pyx_arg_curve) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_curvature (wrapper)", 0);
  assert(__pyx_arg_curve); {
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_arg_curve, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 592, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_30mean_curvature(__pyx_self, __pyx_v_curve);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_30mean_curvature(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_curvature", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_f_11trajeometry_mean_curvature(__pyx_v_curve, 0));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">593</span>: 	<span class="sd">&quot;&quot;&quot;Compute the mean curvature of the given curve, in rad/unit</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>: <span class="sd">	   - curve : double[2, N] : Curve to process</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>: <span class="sd">	&lt;----------- Mean of the local curvatures in rad/length unit</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">597</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">valid_points</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_valid_points = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">598</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[2] <span class="nf">prev_vector</span><span class="p">,</span> <span class="nf">next_vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">599</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">curvature_sum</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_curvature_sum = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">600</span>: 	<span class="c"># Our local curvature is the angle between the incoming and outgoing vectors, divided by the mean local segment length</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">-</span><span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 1; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">602</span>: 		<span class="n">prev_vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mf">1</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 0;
    __pyx_t_7 = (__pyx_v_i - 1);
    __pyx_t_8 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = 1;
    __pyx_t_11 = (__pyx_v_i - 1);
    __pyx_t_12[0] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
    __pyx_t_12[1] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))));
    memcpy(&amp;(__pyx_v_prev_vector[0]), __pyx_t_12, sizeof(__pyx_v_prev_vector[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>: 		<span class="n">next_vector</span> <span class="o">=</span> <span class="p">[</span><span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">curve</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 0;
    __pyx_t_10 = (__pyx_v_i + 1);
    __pyx_t_9 = 0;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i + 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_13[0] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_8 * __pyx_v_curve.strides[1]) ))));
    __pyx_t_13[1] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
    memcpy(&amp;(__pyx_v_next_vector[0]), __pyx_t_13, sizeof(__pyx_v_next_vector[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>: 		<span class="n">prev_vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">prev_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">prev_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">prev_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">prev_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_v_prev_vector_norm = sqrt((((__pyx_v_prev_vector[0]) * (__pyx_v_prev_vector[0])) + ((__pyx_v_prev_vector[1]) * (__pyx_v_prev_vector[1]))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>: 		<span class="n">next_vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">next_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">next_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">next_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">next_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_v_next_vector_norm = sqrt((((__pyx_v_next_vector[0]) * (__pyx_v_next_vector[0])) + ((__pyx_v_next_vector[1]) * (__pyx_v_next_vector[1]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">606</span>: </pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">607</span>: 		<span class="n">curvature_sum</span> <span class="o">+=</span> <span class="n">vector_angle</span><span class="p">(</span><span class="n">prev_vector</span><span class="p">,</span> <span class="n">next_vector</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">prev_vector_norm</span> <span class="o">+</span> <span class="n">next_vector_norm</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-17 '>    __pyx_t_16 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    __pyx_t_15 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_14 = __pyx_array_new(__pyx_t_15, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_16), (char *) "fortran", (char *) __pyx_v_prev_vector);
    if (unlikely(!__pyx_t_14)) <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_14), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_16 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    __pyx_t_14 = __pyx_array_new(__pyx_t_16, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_15), (char *) "fortran", (char *) __pyx_v_next_vector);
    if (unlikely(!__pyx_t_14)) <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_14), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_14)); __pyx_t_14 = 0;
    __pyx_t_19 = __pyx_f_11trajeometry_vector_angle(__pyx_t_17, __pyx_t_18, 0);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_17, 1);
    __pyx_t_17.memview = NULL;
    __pyx_t_17.data = NULL;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_18, 1);
    __pyx_t_18.memview = NULL;
    __pyx_t_18.data = NULL;
    __pyx_t_20 = ((__pyx_v_prev_vector_norm + __pyx_v_next_vector_norm) / 2.0);
    if (unlikely(__pyx_t_20 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
    }
    __pyx_v_curvature_sum = (__pyx_v_curvature_sum + (__pyx_t_19 / __pyx_t_20));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">608</span>: 		<span class="n">valid_points</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_valid_points = (__pyx_v_valid_points + 1);
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>: 	<span class="k">return</span> <span class="n">curvature_sum</span> <span class="o">/</span> <span class="n">valid_points</span></pre>
<pre class='cython code score-5 '>  if (unlikely(__pyx_v_valid_points == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 609, __pyx_L1_error)</span>
  }
  __pyx_r = (__pyx_v_curvature_sum / ((double)__pyx_v_valid_points));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">610</span>: </pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>: <span class="k">cpdef</span> <span class="nf">mean_parallel_distance</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve1</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">curve2</span><span class="p">):</span></pre>
<pre class='cython code score-36 '>static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_f_11trajeometry_mean_parallel_distance(__Pyx_memviewslice __pyx_v_curve1, __Pyx_memviewslice __pyx_v_curve2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  __Pyx_memviewslice __pyx_v_longest_line = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_shortest_line = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_paralleldiff;
  CYTHON_UNUSED double __pyx_v_vector1_x;
  CYTHON_UNUSED double __pyx_v_vector1_y;
  double __pyx_v_vector2_x;
  double __pyx_v_vector2_y;
  int __pyx_v_valid_points;
  Py_ssize_t __pyx_v_p;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_parallel_distance", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_longest_line, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_shortest_line, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_curve1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_parallel_distance (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve1,&amp;__pyx_n_s_curve2,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_curve2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mean_parallel_distance", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "mean_parallel_distance") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_curve1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve1.memview)) __PYX_ERR(0, 611, __pyx_L3_error)</span>
    __pyx_v_curve2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve2.memview)) __PYX_ERR(0, 611, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mean_parallel_distance", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_32mean_parallel_distance(__pyx_self, __pyx_v_curve1, __pyx_v_curve2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_32mean_parallel_distance(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve1, __Pyx_memviewslice __pyx_v_curve2) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_parallel_distance", 0);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_mean_parallel_distance(__pyx_v_curve1, __pyx_v_curve2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_curve2, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">612</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">:]</span> <span class="n">longest_line</span><span class="p">,</span> <span class="n">shortest_line</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">613</span>: 	<span class="k">if</span> <span class="n">line_length</span><span class="p">(</span><span class="n">curve1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">line_length</span><span class="p">(</span><span class="n">curve2</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_f_11trajeometry_line_length(__pyx_v_curve1, 0) &gt; __pyx_f_11trajeometry_line_length(__pyx_v_curve2, 0)) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>: 		<span class="n">longest_line</span> <span class="o">=</span> <span class="n">curve1</span></pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve1, 0);
    __pyx_v_longest_line = __pyx_v_curve1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">615</span>: 		<span class="n">shortest_line</span> <span class="o">=</span> <span class="n">curve2</span></pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve2, 0);
    __pyx_v_shortest_line = __pyx_v_curve2;
</pre><pre class="cython line score-0">&#xA0;<span class="">616</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>: 		<span class="n">longest_line</span> <span class="o">=</span> <span class="n">curve2</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve2, 0);
    __pyx_v_longest_line = __pyx_v_curve2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>: 		<span class="n">shortest_line</span> <span class="o">=</span> <span class="n">curve1</span></pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve1, 0);
    __pyx_v_shortest_line = __pyx_v_curve1;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">619</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>: 	<span class="c"># Now compute the average orthogonal distance and the average angle difference</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">621</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">paralleldiff</span> <span class="o">=</span> <span class="mf">0</span><span class="p">,</span> <span class="n">vector1_x</span><span class="p">,</span> <span class="n">vector1_y</span><span class="p">,</span> <span class="n">vector2_x</span><span class="p">,</span> <span class="n">vector2_y</span></pre>
<pre class='cython code score-0 '>  __pyx_v_paralleldiff = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">622</span>: 	<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">valid_points</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_valid_points = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">624</span>: 	<span class="k">cdef</span> <span class="kt">_ProjectionIndex</span> <span class="nf">projection</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">625</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">626</span>: 	<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">longest_line</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_longest_line.shape[1]) - 1);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_p = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>: 		<span class="n">projection</span> <span class="o">=</span> <span class="n">_project_on_curve_index</span><span class="p">(</span><span class="n">longest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="n">longest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">p</span><span class="p">],</span> <span class="n">shortest_line</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_p;
    __pyx_t_7 = 1;
    __pyx_t_8 = __pyx_v_p;
    __pyx_v_projection = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_5 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_6 * __pyx_v_longest_line.strides[1]) ))), (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_7 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_longest_line.strides[1]) ))), __pyx_v_shortest_line, 0, 0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">628</span>: 		<span class="k">if</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_projection.index &lt; 0) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">629</span>: 			<span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L4_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">630</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>: 		<span class="n">vector1_x</span> <span class="o">=</span> <span class="n">longest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">longest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = 0;
    __pyx_t_7 = (__pyx_v_p + 1);
    __pyx_t_6 = 0;
    __pyx_t_5 = __pyx_v_p;
    __pyx_v_vector1_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_8 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_longest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_6 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_5 * __pyx_v_longest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>: 		<span class="n">vector1_y</span> <span class="o">=</span> <span class="n">longest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">longest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_6 = (__pyx_v_p + 1);
    __pyx_t_7 = 1;
    __pyx_t_8 = __pyx_v_p;
    __pyx_v_vector1_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_5 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_6 * __pyx_v_longest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_7 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_longest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>: 		<span class="n">vector2_x</span> <span class="o">=</span> <span class="n">shortest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shortest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = 0;
    __pyx_t_7 = (__pyx_v_projection.index + 1);
    __pyx_t_6 = 0;
    __pyx_t_5 = __pyx_v_projection.index;
    __pyx_v_vector2_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_8 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_shortest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_6 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_5 * __pyx_v_shortest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>: 		<span class="n">vector2_y</span> <span class="o">=</span> <span class="n">shortest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">shortest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_6 = (__pyx_v_projection.index + 1);
    __pyx_t_7 = 1;
    __pyx_t_8 = __pyx_v_projection.index;
    __pyx_v_vector2_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_5 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_6 * __pyx_v_shortest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_7 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_shortest_line.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">635</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">636</span>: 		<span class="n">paralleldiff</span> <span class="o">+=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">longest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">shortest_line</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector2_x</span><span class="o">*</span><span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">))</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">longest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">p</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">shortest_line</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">vector2_y</span><span class="o">*</span><span class="n">projection</span><span class="o">.</span><span class="n">vector_factor</span><span class="p">))</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = 0;
    __pyx_t_7 = __pyx_v_p;
    __pyx_t_6 = 0;
    __pyx_t_5 = __pyx_v_projection.index;
    __pyx_t_9 = 1;
    __pyx_t_10 = __pyx_v_p;
    __pyx_t_11 = 1;
    __pyx_t_12 = __pyx_v_projection.index;
    __pyx_v_paralleldiff = (__pyx_v_paralleldiff + sqrt((pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_8 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_longest_line.strides[1]) ))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_6 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_5 * __pyx_v_shortest_line.strides[1]) ))) + (__pyx_v_vector2_x * __pyx_v_projection.vector_factor))), 2.0) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_9 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_10 * __pyx_v_longest_line.strides[1]) ))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_11 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_12 * __pyx_v_shortest_line.strides[1]) ))) + (__pyx_v_vector2_y * __pyx_v_projection.vector_factor))), 2.0))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>: 		<span class="n">valid_points</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_valid_points = (__pyx_v_valid_points + 1);
    __pyx_L4_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>: 	<span class="k">if</span> <span class="n">valid_points</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_valid_points == 0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>: 		<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span></pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_13, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_r = __pyx_t_14;
    __pyx_t_14 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">641</span>: 	<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>: 		<span class="k">return</span> <span class="n">paralleldiff</span> <span class="o">/</span> <span class="n">valid_points</span></pre>
<pre class='cython code score-11 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    if (unlikely(__pyx_v_valid_points == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 642, __pyx_L1_error)</span>
    }
    __pyx_t_14 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_paralleldiff / ((double)__pyx_v_valid_points)));<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 642, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_r = __pyx_t_14;
    __pyx_t_14 = 0;
    goto __pyx_L0;
  }
</pre></div></body></html>
