<!DOCTYPE html>
<!-- Generated by Cython 3.0.6 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: trajeometry.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.6</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="trajeometry.cpp">trajeometry.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: # distutils: language=c++</pre>
<pre class='cython code score-8 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: # cython: boundscheck=False, wraparound=False, initializedcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: #   Copyright 2023 Grégori MIGNEROT, Élian BELMONTE, Benjamin STACH</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #   Licensed under the Apache License, Version 2.0 (the "License");</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #   you may not use this file except in compliance with the License.</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #   You may obtain a copy of the License at</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: #       http://www.apache.org/licenses/LICENSE-2.0</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: #</pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: #   Unless required by applicable law or agreed to in writing, software</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: #   distributed under the License is distributed on an "AS IS" BASIS,</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: #   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: #   See the License for the specific language governing permissions and</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: #   limitations under the License.</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: Module that does all the basic discrete curve geometry for the rest of the program</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">022</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_numpy, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: cimport cython</pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: from libc.math cimport sqrt, acos, INFINITY, NAN, M_PI</pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: from libc.stdlib cimport malloc, free</pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: from libcpp.vector cimport vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: # Return value of _project_on_curve_index</pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: cdef struct _ProjectionIndex:</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: 	int index</pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: 	double vector_factor</pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: # Return value of _next_point</pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: cdef struct _NextPoint:</pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: 	double x, y</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: 	int index</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: 	double vector_factor</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">040</span>: cdef double _acos_clip(double val) noexcept nogil:</pre>
<pre class='cython code score-0 '>static double __pyx_f_11trajeometry__acos_clip(double __pyx_v_val) {
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">041</span>: 	"""Utility function, when we try to get the angle between two vectors using the dot product,</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: 	   sometimes floating-points shenanigans make the cos value get a little bit outside [-1, 1],</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: 	   so this puts it back into the right range and computes the arccos"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">044</span>: 	if val &lt; -1:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_val &lt; -1.0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">045</span>: 		return acos(-1)</pre>
<pre class='cython code score-0 '>    __pyx_r = acos(-1.0);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">046</span>: 	elif val &gt; 1:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_val &gt; 1.0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">047</span>: 		return acos(1)</pre>
<pre class='cython code score-0 '>    __pyx_r = acos(1.0);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">048</span>: 	else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">049</span>: 		return acos(val)</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = acos(__pyx_v_val);
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: </pre>
<pre class="cython line score-84" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">052</span>: cpdef double vector_angle(double[:] v1, double[:] v2):</pre>
<pre class='cython code score-84 '>static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static double __pyx_f_11trajeometry_vector_angle(__Pyx_memviewslice __pyx_v_v1, __Pyx_memviewslice __pyx_v_v2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_dotproduct;
  double __pyx_v_v1_norm;
  double __pyx_v_v2_norm;
  Py_ssize_t __pyx_v_i;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_vector_angle, "Compute the relative angle between two n-dimensional vectors\n\t   - v1 : double[D] : First vector\n\t   - v2 : double[D] : Second vector\n\t&lt;-------- double    : Relative angle in radians\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_1vector_angle = {"vector_angle", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_1vector_angle, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_vector_angle};
static PyObject *__pyx_pw_11trajeometry_1vector_angle(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_v1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("vector_angle (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,0};
  PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_v1)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_v2)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("vector_angle", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "vector_angle") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_v1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_v1.memview)) __PYX_ERR(0, 52, __pyx_L3_error)</span>
    __pyx_v_v2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_v2.memview)) __PYX_ERR(0, 52, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("vector_angle", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_v1, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_v2, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_vector_angle(__pyx_self, __pyx_v_v1, __pyx_v_v2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_v1, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_v2, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_vector_angle(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_v1, __Pyx_memviewslice __pyx_v_v2) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_vector_angle(__pyx_v_v1, __pyx_v_v2, 0); if (unlikely(__pyx_t_1 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.vector_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__28 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_v1, __pyx_n_s_v2);<span class='error_goto'> if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__28);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__28);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_1vector_angle, 0, __pyx_n_s_vector_angle, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__29));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_vector_angle, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 52, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__29 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_vector_angle, 52, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 52, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">053</span>: 	"""Compute the relative angle between two n-dimensional vectors</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: 	   - v1 : double[D] : First vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: 	   - v2 : double[D] : Second vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: 	&lt;-------- double    : Relative angle in radians</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: 	# Use the usual dot product formula, arccos(v₁·v₂ / (||v₁|| × ||v₂||))</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>: 	cdef double dotproduct = 0, v1_norm = 0, v2_norm = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_dotproduct = 0.0;
  __pyx_v_v1_norm = 0.0;
  __pyx_v_v2_norm = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">060</span>: 	cdef Py_ssize_t i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">061</span>: 	for i in range(v1.shape[0]):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_v1.shape[0]);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>: 		dotproduct += v1[i] * v2[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_dotproduct = (__pyx_v_dotproduct + ((*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_4 * __pyx_v_v1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_5 * __pyx_v_v2.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>: 		v1_norm += v1[i] * v1[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_v1_norm = (__pyx_v_v1_norm + ((*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_5 * __pyx_v_v1.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v1.data + __pyx_t_4 * __pyx_v_v1.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">064</span>: 		v2_norm += v2[i] * v2[i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_v2_norm = (__pyx_v_v2_norm + ((*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_4 * __pyx_v_v2.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v2.data + __pyx_t_5 * __pyx_v_v2.strides[0]) )))));
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>: 	return _acos_clip(dotproduct / (sqrt(v1_norm)*sqrt(v2_norm)))</pre>
<pre class='cython code score-5 '>  __pyx_t_6 = (sqrt(__pyx_v_v1_norm) * sqrt(__pyx_v_v2_norm));
  if (unlikely(__pyx_t_6 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 65, __pyx_L1_error)</span>
  }
  __pyx_r = __pyx_f_11trajeometry__acos_clip((__pyx_v_dotproduct / __pyx_t_6));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">066</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: </pre>
<pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>: cpdef double line_length(double[:, :] curve):</pre>
<pre class='cython code score-65 '>static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static double __pyx_f_11trajeometry_line_length(__Pyx_memviewslice __pyx_v_curve, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_length;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_num_points;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_2line_length, "Compute the actual length of a discrete curve, as the sum of the lengths of its segments\n\t   - curve : double[2, N] : Discrete curve to compute the length of\n\t&lt;----------- double       : Length of the curve in pixels\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_3line_length = {"line_length", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_3line_length, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_2line_length};
static PyObject *__pyx_pw_11trajeometry_3line_length(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("line_length (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,0};
  PyObject* values[1] = {0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "line_length") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 68, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("line_length", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.line_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_2line_length(__pyx_self, __pyx_v_curve);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_2line_length(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_line_length(__pyx_v_curve, 0); if (unlikely(__pyx_t_1 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.line_length", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__30 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_curve);<span class='error_goto'> if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__30);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__30);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_3line_length, 0, __pyx_n_s_line_length, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__31));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_line_length, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 68, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__31 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_line_length, 68, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">069</span>: 	"""Compute the actual length of a discrete curve, as the sum of the lengths of its segments</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>: 	   - curve : double[2, N] : Discrete curve to compute the length of</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>: 	&lt;----------- double       : Length of the curve in pixels</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">073</span>: 	cdef double length = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_length = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">074</span>: 	cdef Py_ssize_t i, num_points = curve.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_num_points = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">075</span>: 	for i in range(num_points - 1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_num_points - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">076</span>: 		length += sqrt((curve[0, i] - curve[0, i+1])**2 + (curve[1, i] - curve[1, i+1])**2)</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 0;
    __pyx_t_7 = (__pyx_v_i + 1);
    __pyx_t_8 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = 1;
    __pyx_t_11 = (__pyx_v_i + 1);
    __pyx_v_length = (__pyx_v_length + sqrt((pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) )))), 2.0) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) )))), 2.0))));
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">077</span>: 	return length</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_length;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>: cdef _ProjectionIndex _project_on_curve_index(double point_x, double point_y, double[:, :] curve, bint extend, Py_ssize_t min_index):</pre>
<pre class='cython code score-2 '>static struct __pyx_t_11trajeometry__ProjectionIndex __pyx_f_11trajeometry__project_on_curve_index(double __pyx_v_point_x, double __pyx_v_point_y, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_best_index;
  int __pyx_v_best_orthogonal;
  double __pyx_v_best_factor;
  double __pyx_v_best_sqdistance;
  double __pyx_v_current_point_x;
  double __pyx_v_current_point_y;
  double __pyx_v_vector_x;
  double __pyx_v_vector_y;
  double __pyx_v_sqdistance;
  double __pyx_v_factor;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry._project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>: 	"""Return the closest point on the curve to the given point, including in-between curve samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>: 	   - point_x   : double           : Point to project, X coordinate</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: 	   - point_y   : double           : Point to project, Y coordinate</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: 	   - curve     : double[2, N]     : Numerical curve to project (point_x, point_y) onto</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>: 	   - extend    : bool             : If True, when the projection is before the first sample of the curve, extend it</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>: 	   - min_index : int              : Minimum index to project to</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>: 	&lt;--------------- _ProjectionIndex : .index is the index of the closest sample to the projection in the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>: 	                                  .vector_factor is the portion [0, 1] of the vector from curve[:, .index] to curve[:, .index+1] to add to the point at .index to get the actual closest point</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: 	                                  If the projection is beyond the last sample of the curve, .index is set to -1 and .vector_factor to NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>: 	                                  If the projection is before the first sample of the curve and `extend` is False, .index is set to -1 and .vector_factor to NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>: 	                                  If the projection is before the first sample of the curve and `extend` is True, .vector_factor is negative and possibly below -1.</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: 	                                  Otherwise, .vector_factor is positive and between 0 and 1</pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>: 	cdef Py_ssize_t i, best_index = -1</pre>
<pre class='cython code score-0 '>  __pyx_v_best_index = -1L;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>: 	cdef bint best_orthogonal = False</pre>
<pre class='cython code score-0 '>  __pyx_v_best_orthogonal = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>: 	cdef double best_factor = NAN, best_sqdistance = INFINITY</pre>
<pre class='cython code score-0 '>  __pyx_v_best_factor = NAN;
  __pyx_v_best_sqdistance = INFINITY;
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: 	cdef double current_point_x, current_point_y, vector_x, vector_y, sqdistance, factor</pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>: 	for i in range(min_index, curve.shape[1]-1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = __pyx_v_min_index; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">101</span>: 		current_point_x = curve[0, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_current_point_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>: 		current_point_y = curve[1, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_current_point_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>: 		vector_x = curve[0, i+1] - current_point_x</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_v_vector_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - __pyx_v_current_point_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>: 		vector_y = curve[1, i+1] - current_point_y</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = (__pyx_v_i + 1);
    __pyx_v_vector_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))) - __pyx_v_current_point_y);
</pre><pre class="cython line score-0">&#xA0;<span class="">105</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>: 		# Find the proportion of the vector at which the point orthogonally projects</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: 		# If it is within [0, 1[, then it can be better projected at a point on that vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: 		# Otherwise we continue with the curve sample alone</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>: 		factor = ((point_x - current_point_x) * vector_x + (point_y - current_point_y) * vector_y) / (vector_x*vector_x + vector_y*vector_y)</pre>
<pre class='cython code score-5 '>    __pyx_t_6 = (((__pyx_v_point_x - __pyx_v_current_point_x) * __pyx_v_vector_x) + ((__pyx_v_point_y - __pyx_v_current_point_y) * __pyx_v_vector_y));
    __pyx_t_7 = ((__pyx_v_vector_x * __pyx_v_vector_x) + (__pyx_v_vector_y * __pyx_v_vector_y));
    if (unlikely(__pyx_t_7 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
    }
    __pyx_v_factor = (__pyx_t_6 / __pyx_t_7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>: 		if (factor &gt;= 0 or (i == 0 and extend)) and factor &lt; 1:</pre>
<pre class='cython code score-0 '>    __pyx_t_9 = (__pyx_v_factor &gt;= 0.0);
    if (!__pyx_t_9) {
    } else {
      goto __pyx_L7_next_and;
    }
    __pyx_t_9 = (__pyx_v_i == 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L6_bool_binop_done;
    }
    if (__pyx_v_extend) {
    } else {
      __pyx_t_8 = __pyx_v_extend;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_L7_next_and:;
    __pyx_t_9 = (__pyx_v_factor &lt; 1.0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>: 			current_point_x += vector_x*factor</pre>
<pre class='cython code score-0 '>      __pyx_v_current_point_x = (__pyx_v_current_point_x + (__pyx_v_vector_x * __pyx_v_factor));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>: 			current_point_y += vector_y*factor</pre>
<pre class='cython code score-0 '>      __pyx_v_current_point_y = (__pyx_v_current_point_y + (__pyx_v_vector_y * __pyx_v_factor));
</pre><pre class="cython line score-0">&#xA0;<span class="">113</span>: 		else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">114</span>: 			factor = 0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_factor = 0.0;
    }
    __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">115</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>: 		# Take the square distance (to spare a square root, it’s monotonous anyway) from the point to project to the current point or the projection onto the current vector</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: 		# The overall goal is to minimize this distance</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>: 		sqdistance = (point_x - current_point_x)**2 + (point_y - current_point_y)**2</pre>
<pre class='cython code score-0 '>    __pyx_v_sqdistance = (pow((__pyx_v_point_x - __pyx_v_current_point_x), 2.0) + pow((__pyx_v_point_y - __pyx_v_current_point_y), 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">119</span>: 		if sqdistance &lt; best_sqdistance:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (__pyx_v_sqdistance &lt; __pyx_v_best_sqdistance);
    if (__pyx_t_8) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>: 			best_index = i</pre>
<pre class='cython code score-0 '>      __pyx_v_best_index = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>: 			best_factor = factor</pre>
<pre class='cython code score-0 '>      __pyx_v_best_factor = __pyx_v_factor;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>: 			best_sqdistance = sqdistance</pre>
<pre class='cython code score-0 '>      __pyx_v_best_sqdistance = __pyx_v_sqdistance;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">123</span>: 			best_orthogonal = factor &gt; 0</pre>
<pre class='cython code score-0 '>      __pyx_v_best_orthogonal = (__pyx_v_factor &gt; 0.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">124</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>: 	# Also check the distance to the last curve sample</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>: 	# If it is closest to the point to project, then the point is beyond the curve and we fail</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: 	# However, this might be falsified by high curvatures near the end, so if the best point found previously</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>: 	# was really orthogonal, keep it instead</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">129</span>: 	current_point_x = curve[0, curve.shape[1]-1]</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = 0;
  __pyx_t_5 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_v_current_point_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">130</span>: 	current_point_y = curve[1, curve.shape[1]-1]</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = 1;
  __pyx_t_4 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_v_current_point_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>: 	sqdistance = (point_x - current_point_x)**2 + (point_y - current_point_y)**2</pre>
<pre class='cython code score-0 '>  __pyx_v_sqdistance = (pow((__pyx_v_point_x - __pyx_v_current_point_x), 2.0) + pow((__pyx_v_point_y - __pyx_v_current_point_y), 2.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">132</span>: 	if sqdistance &lt; best_sqdistance and not best_orthogonal:</pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_sqdistance &lt; __pyx_v_best_sqdistance);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_9 = (!__pyx_v_best_orthogonal);
  __pyx_t_8 = __pyx_t_9;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>: 		return _ProjectionIndex(index=-1, vector_factor=NAN)</pre>
<pre class='cython code score-0 '>    __pyx_t_10.index = -1;
    __pyx_t_10.vector_factor = NAN;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: 	# If the point is before the first sample and no extension was required, fail</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>: 	if best_index &lt; 0 or (best_index == 0 and best_factor &lt;= 0 and not extend):</pre>
<pre class='cython code score-0 '>  __pyx_t_9 = (__pyx_v_best_index &lt; 0);
  if (!__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = (__pyx_v_best_index == 0);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = (__pyx_v_best_factor &lt;= 0.0);
  if (__pyx_t_9) {
  } else {
    __pyx_t_8 = __pyx_t_9;
    goto __pyx_L15_bool_binop_done;
  }
  __pyx_t_9 = (!__pyx_v_extend);
  __pyx_t_8 = __pyx_t_9;
  __pyx_L15_bool_binop_done:;
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>: 		return _ProjectionIndex(index=-1, vector_factor=NAN)</pre>
<pre class='cython code score-0 '>    __pyx_t_10.index = -1;
    __pyx_t_10.vector_factor = NAN;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>: 	else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>: 		return _ProjectionIndex(index=best_index, vector_factor=best_factor)</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_10.index = __pyx_v_best_index;
    __pyx_t_10.vector_factor = __pyx_v_best_factor;
    __pyx_r = __pyx_t_10;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">140</span>: </pre>
<pre class="cython line score-132" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>: def project_on_curve_index(double[:] point, double[:, :] curve, bint extend=False, Py_ssize_t min_index=0):</pre>
<pre class='cython code score-132 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_5project_on_curve_index(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_4project_on_curve_index, "Return the closest point on the curve to the given point, including in-between curve samples\n\t   - point_x   : double[2]    : Point to project\n\t   - curve     : double[2, N] : Numerical curve to project `point` onto\n\t   - extend    : bool         : If True, when the projection is before the first sample of the curve, extend it\n\t   - min_index : Py_ssize_t   : Do not try to project before that index on the curve\n\t&lt;--------------- int          : Index of the closest sample on the curve\n\t&lt;--------------- double       : Portion [0, 1] of the vector from curve[:, index] to curve[:, index+1] to add to the point at `index` to get the actual closest point\n\t                                If the projection is before the first sample of the curve and `extend` is True, `vector_factor` is negative and possibly below -1.\n\t                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_5project_on_curve_index = {"project_on_curve_index", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_5project_on_curve_index, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_4project_on_curve_index};
static PyObject *__pyx_pw_11trajeometry_5project_on_curve_index(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_index (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
  PyObject* values[4] = {0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_point)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_index", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_extend);
          if (value) { values[2] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_min_index);
          if (value) { values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "project_on_curve_index") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 141, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 141, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)((int)0));
    }
    if (values[3]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[3]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)((Py_ssize_t)0));
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_index", 0, 2, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_4project_on_curve_index(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_4project_on_curve_index(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_result;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__32 = <span class='py_c_api'>PyTuple_Pack</span>(5, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__32);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((Py_ssize_t)0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L1_error)</span>;
  __pyx_t_7 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_5project_on_curve_index, 0, __pyx_n_s_project_on_curve_index, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__33));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_project_on_curve_index, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 141, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__33 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_project_on_curve_index, 141, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 141, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: 	"""Return the closest point on the curve to the given point, including in-between curve samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: 	   - point_x   : double[2]    : Point to project</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: 	   - curve     : double[2, N] : Numerical curve to project `point` onto</pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>: 	   - extend    : bool         : If True, when the projection is before the first sample of the curve, extend it</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: 	   - min_index : Py_ssize_t   : Do not try to project before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: 	&lt;--------------- int          : Index of the closest sample on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: 	&lt;--------------- double       : Portion [0, 1] of the vector from curve[:, index] to curve[:, index+1] to add to the point at `index` to get the actual closest point</pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: 	                                If the projection is before the first sample of the curve and `extend` is True, `vector_factor` is negative and possibly below -1.</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>: 	                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>: 	cdef _ProjectionIndex result = _project_on_curve_index(point[0], point[1], curve, extend, min_index)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_t_3 = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  __pyx_v_result = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>: 	if result.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_result.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>: 		return None, None</pre>
<pre class='cython code score-7 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__15);
    __pyx_r = __pyx_tuple__15;
    goto __pyx_L0;
/* … */
  __pyx_tuple__15 = <span class='py_c_api'>PyTuple_Pack</span>(2, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 154, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__15);
</pre><pre class="cython line score-0">&#xA0;<span class="">155</span>: 	else:</pre>
<pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>: 		return result.index, result.vector_factor</pre>
<pre class='cython code score-17 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_result.index);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.vector_factor);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 156, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 156, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 156, __pyx_L1_error)</span>;
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">157</span>: </pre>
<pre class="cython line score-135" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>: def project_on_curve_array(double[:] point, double[:, :] curve, bint extend=False, Py_ssize_t min_index=0):</pre>
<pre class='cython code score-135 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_7project_on_curve_array(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_6project_on_curve_array, "Find the index closest to the orthogonal projection of a point onto a curve defined by a point sequence\n\t   - point     : double[2]    : 2D point to project on the curve\n\t   - curve     : double[2, N] : Curve to project the point onto, as a point sequence\n\t   - min_index : Py_ssize_t   : Do not try to project before that index on the curve\n\t&lt;--------------- int          : Index in `curve` closest to the orthogonal projection of `point`\n\t&lt;--------------- double[2]    : Projected point on the curve\n\t                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_7project_on_curve_array = {"project_on_curve_array", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_7project_on_curve_array, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_6project_on_curve_array};
static PyObject *__pyx_pw_11trajeometry_7project_on_curve_array(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_on_curve_array (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
  PyObject* values[4] = {0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_point)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_array", 0, 2, 4, 1); <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_extend);
          if (value) { values[2] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_min_index);
          if (value) { values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "project_on_curve_array") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 158, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 158, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)((int)0));
    }
    if (values[3]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[3]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)((Py_ssize_t)0));
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_on_curve_array", 0, 2, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_6project_on_curve_array(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_6project_on_curve_array(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_on_curve_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__34 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__34);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__34);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((Py_ssize_t)0));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_7project_on_curve_array, 0, __pyx_n_s_project_on_curve_array, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__35));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_5, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_project_on_curve_array, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_codeobj__35 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_project_on_curve_array, 158, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">159</span>: 	"""Find the index closest to the orthogonal projection of a point onto a curve defined by a point sequence</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>: 	   - point     : double[2]    : 2D point to project on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>: 	   - curve     : double[2, N] : Curve to project the point onto, as a point sequence</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: 	   - min_index : Py_ssize_t   : Do not try to project before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>: 	&lt;--------------- int          : Index in `curve` closest to the orthogonal projection of `point`</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>: 	&lt;--------------- double[2]    : Projected point on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>: 	                                If the projection is beyond the last sample or before the first sample and `extend` is False, both return values are None</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>: 	cdef _ProjectionIndex projection = _project_on_curve_index(point[0], point[1], curve, extend, min_index)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_t_3 = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)</span>
  __pyx_v_projection = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>: 	if projection.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_projection.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>: 		return None, None</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__15);
    __pyx_r = __pyx_tuple__15;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>: 	result = np.asarray(((1 - projection.vector_factor) * curve[0, projection.index] + projection.vector_factor*curve[0, projection.index + 1],</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = 0;
  __pyx_t_1 = __pyx_v_projection.index;
  __pyx_t_8 = 0;
  __pyx_t_9 = (__pyx_v_projection.index + 1);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((((1.0 - __pyx_v_projection.vector_factor) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_curve.strides[1]) )))) + (__pyx_v_projection.vector_factor * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
/* … */
  __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 171, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>;
  __pyx_t_6 = 0;
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_12 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      __pyx_t_12 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_11};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_7, __pyx_callargs+1-__pyx_t_12, 1+__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 171, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_v_result = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>: 		                 (1 - projection.vector_factor) * curve[1, projection.index] + projection.vector_factor*curve[1, projection.index + 1]))</pre>
<pre class='cython code score-5 '>  __pyx_t_9 = 1;
  __pyx_t_8 = __pyx_v_projection.index;
  __pyx_t_1 = 1;
  __pyx_t_2 = (__pyx_v_projection.index + 1);
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>((((1.0 - __pyx_v_projection.vector_factor) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_8 * __pyx_v_curve.strides[1]) )))) + (__pyx_v_projection.vector_factor * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_1 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))))));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 172, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>: 	return projection.index, result</pre>
<pre class='cython code score-13 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_projection.index);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 173, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_v_result)) <span class='error_goto'>__PYX_ERR(0, 173, __pyx_L1_error)</span>;
  __pyx_t_5 = 0;
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>: cdef _NextPoint _next_point(Py_ssize_t closest_index, double vector_factor, double[:, :] curve, double target_distance):</pre>
<pre class='cython code score-2 '>static struct __pyx_t_11trajeometry__NextPoint __pyx_f_11trajeometry__next_point(Py_ssize_t __pyx_v_closest_index, double __pyx_v_vector_factor, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_target_distance) {
  Py_ssize_t __pyx_v_current_index;
  Py_ssize_t __pyx_v_curve_size;
  double __pyx_v_distance;
  double __pyx_v_x_derivative;
  double __pyx_v_y_derivative;
  CYTHON_UNUSED double __pyx_v_current_point_x;
  CYTHON_UNUSED double __pyx_v_current_point_y;
  double __pyx_v_current_vector_norm;
  double __pyx_v_remaining_x;
  double __pyx_v_remaining_y;
  double __pyx_v_remaining_norm;
  struct __pyx_t_11trajeometry__NextPoint __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry._next_point", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">177</span>: 	"""Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>: 	   - closest_index   : Py_ssize_t   : Index of the initial point on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>: 	   - vector_factor   : double       : Portion of the outgoing vector of the given index on the curve to add to get the initial point</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>: 	   - curve           : double[2, N] : Numerical curve to follow</pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: 	   - target_distance : double       : Distance from the projection of the initial point to the result</pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>: 	&lt;--------------------- _NextPoint   : .x and .y are the coordinates of the resulting point</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>: 	                                      .index is the index of the sample immediately before the resulting point</pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>: 	                                      .vector_factor is the portion [0, 1] of the vector from curve[:, .index] to curve[:, .index+1]</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: 										  to add to the point at .index to get the actual resulting point, might be negative if the initial vector_factor was too</pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: 	                                      If the resulting point is beyond the last sample of the curve, .index is set to -1 and .x, .y and .vector_factor are set to NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>: 	cdef Py_ssize_t current_index = closest_index</pre>
<pre class='cython code score-0 '>  __pyx_v_current_index = __pyx_v_closest_index;
</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>: 	cdef Py_ssize_t curve_size = curve.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_curve_size = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>: 	cdef double distance = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_distance = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">192</span>: 	cdef double x_derivative, y_derivative, current_point_x, current_point_y, current_vector_norm, remaining_x, remaining_y, remaining_norm</pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>: 	# Now loop on the curve samples starting from the initial projection until the cumulative distance adds up to `target_distance` or it overshoots the curve</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>: 	while current_index &lt; curve_size - 1:</pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_1 = (__pyx_v_current_index &lt; (__pyx_v_curve_size - 1));
    if (!__pyx_t_1) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">196</span>: 		# Get the vector from the current sample to the next</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>: 		x_derivative = curve[0, current_index + 1] - curve[0, current_index]</pre>
<pre class='cython code score-0 '>    __pyx_t_2 = 0;
    __pyx_t_3 = (__pyx_v_current_index + 1);
    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_current_index;
    __pyx_v_x_derivative = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>: 		y_derivative = curve[1, current_index + 1] - curve[1, current_index]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = (__pyx_v_current_index + 1);
    __pyx_t_3 = 1;
    __pyx_t_2 = __pyx_v_current_index;
    __pyx_v_y_derivative = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>: 		# When the vector_factor is non-null, take the part of the vector that remains *after* the vector_factor</pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: 		# To start at the actual initial projection, including its vector part</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>: 		remaining_x = (1 - vector_factor) * x_derivative</pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_x = ((1.0 - __pyx_v_vector_factor) * __pyx_v_x_derivative);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>: 		remaining_y = (1 - vector_factor) * y_derivative</pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_y = ((1.0 - __pyx_v_vector_factor) * __pyx_v_y_derivative);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>: 		remaining_norm = sqrt(remaining_x*remaining_x + remaining_y*remaining_y)</pre>
<pre class='cython code score-0 '>    __pyx_v_remaining_norm = sqrt(((__pyx_v_remaining_x * __pyx_v_remaining_x) + (__pyx_v_remaining_y * __pyx_v_remaining_y)));
</pre><pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: 		# This entire vectors would make us overshoot the target : the resulting point is between this sample and the next</pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>: 		# We just need to compute the necessary proportion of the vector</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">208</span>: 		if remaining_norm + distance &gt; target_distance:</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_remaining_norm + __pyx_v_distance) &gt; __pyx_v_target_distance);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>: 			current_vector_norm = sqrt(x_derivative*x_derivative + y_derivative*y_derivative)</pre>
<pre class='cython code score-0 '>      __pyx_v_current_vector_norm = sqrt(((__pyx_v_x_derivative * __pyx_v_x_derivative) + (__pyx_v_y_derivative * __pyx_v_y_derivative)));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>: 			vector_factor += (target_distance - distance) / current_vector_norm</pre>
<pre class='cython code score-5 '>      __pyx_t_6 = (__pyx_v_target_distance - __pyx_v_distance);
      if (unlikely(__pyx_v_current_vector_norm == 0)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        <span class='error_goto'>__PYX_ERR(0, 210, __pyx_L1_error)</span>
      }
      __pyx_v_vector_factor = (__pyx_v_vector_factor + (__pyx_t_6 / __pyx_v_current_vector_norm));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>: 			current_point_x = curve[0, current_index] + vector_factor * x_derivative</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = 0;
      __pyx_t_3 = __pyx_v_current_index;
      __pyx_v_current_point_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_x_derivative));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>: 			current_point_y = curve[1, current_index] + vector_factor * y_derivative</pre>
<pre class='cython code score-0 '>      __pyx_t_3 = 1;
      __pyx_t_2 = __pyx_v_current_index;
      __pyx_v_current_point_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_y_derivative));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>: 			return _NextPoint(x=curve[0, current_index] + vector_factor * x_derivative, y=curve[1, current_index] + vector_factor * y_derivative, index=current_index, vector_factor=vector_factor)</pre>
<pre class='cython code score-0 '>      __pyx_t_2 = 0;
      __pyx_t_3 = __pyx_v_current_index;
      __pyx_t_7.x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_2 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_x_derivative));
      __pyx_t_3 = 1;
      __pyx_t_2 = __pyx_v_current_index;
      __pyx_t_7.y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_vector_factor * __pyx_v_y_derivative));
      __pyx_t_7.index = __pyx_v_current_index;
      __pyx_t_7.vector_factor = __pyx_v_vector_factor;
      __pyx_r = __pyx_t_7;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">214</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: 		# Otherwise, just add this distance and continue on to the next sample</pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>: 		else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>: 			current_index += 1</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_current_index = (__pyx_v_current_index + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>: 			vector_factor = 0</pre>
<pre class='cython code score-0 '>      __pyx_v_vector_factor = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>: 			distance += remaining_norm</pre>
<pre class='cython code score-0 '>      __pyx_v_distance = (__pyx_v_distance + __pyx_v_remaining_norm);
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">220</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>: 	# We have overshot the curve, fail</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>: 	return _NextPoint(x=NAN, y=NAN, index=-1, vector_factor=NAN)</pre>
<pre class='cython code score-0 '>  __pyx_t_7.x = NAN;
  __pyx_t_7.y = NAN;
  __pyx_t_7.index = -1;
  __pyx_t_7.vector_factor = NAN;
  __pyx_r = __pyx_t_7;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-159" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>: def next_point(double[:] point, double[:, :] curve, double target_distance, bint extend=False, Py_ssize_t min_index=0):</pre>
<pre class='cython code score-159 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_9next_point(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_8next_point, "Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order\n\t   - point           : double[2]    : Initial point\n\t   - curve           : double[2, N] : Numerical curve to follow\n\t   - target_distance : double       : Distance from the projection of the initial point to the result\n\t   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve\n\t   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve\n\t&lt;--------------------- double[2]    : Coordinates of the resulting point\n\t                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return None\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_9next_point = {"next_point", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_9next_point, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_8next_point};
static PyObject *__pyx_pw_11trajeometry_9next_point(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_target_distance;
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_target_distance,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
  PyObject* values[5] = {0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_point)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, 1); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_distance)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, 2); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_extend);
          if (value) { values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_min_index);
          if (value) { values[4] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "next_point") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 224, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 224, __pyx_L3_error)</span>
    __pyx_v_target_distance = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_target_distance == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)((int)0));
    }
    if (values[4]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[4]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)((Py_ssize_t)0));
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point", 0, 3, 5, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_8next_point(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_8next_point(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_target_distance, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__36 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_target_distance, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result);<span class='error_goto'> if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__36);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__36);
/* … */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((Py_ssize_t)0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>;
  __pyx_t_5 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_9next_point, 0, __pyx_n_s_next_point, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__37));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_7, __pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_next_point, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__37 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_next_point, 224, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 224, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">225</span>: 	"""Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>: 	   - point           : double[2]    : Initial point</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>: 	   - curve           : double[2, N] : Numerical curve to follow</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>: 	   - target_distance : double       : Distance from the projection of the initial point to the result</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>: 	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>: 	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>: 	&lt;--------------------- double[2]    : Coordinates of the resulting point</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>: 	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return None</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>: 	# First take the closest point on the curve to the initial point</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>: 	cdef _ProjectionIndex projection = _project_on_curve_index(point[0], point[1], curve, extend, min_index)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_t_3 = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 235, __pyx_L1_error)</span>
  __pyx_v_projection = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">236</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>: 	# The extension shenanigans are handled entirely by _project_on_curve_index, just fail when it fails</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>: 	if projection.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_projection.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">239</span>: 		return None</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">240</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>: 	cdef _NextPoint result = _next_point(projection.index, projection.vector_factor, curve, target_distance)</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_f_11trajeometry__next_point(__pyx_v_projection.index, __pyx_v_projection.vector_factor, __pyx_v_curve, __pyx_v_target_distance);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 241, __pyx_L1_error)</span>
  __pyx_v_result = __pyx_t_5;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>: 	if result.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_result.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>: 		return None</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">244</span>: 	else:</pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>: 		return np.asarray((result.x, result.y))</pre>
<pre class='cython code score-40 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.x);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.y);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 245, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>;
    __pyx_t_7 = 0;
    __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    __pyx_t_11 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_8))) {
      __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_8);
      if (likely(__pyx_t_9)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_8);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_8, function);
        __pyx_t_11 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_10};
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_8, __pyx_callargs+1-__pyx_t_11, 1+__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 245, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_r = __pyx_t_6;
    __pyx_t_6 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>: cdef (_NextPoint, double) _next_point_score(Py_ssize_t closest_index, double vector_factor, double[:, :] curve, double[:] scores, double target_distance, bint extend, Py_ssize_t min_index):</pre>
<pre class='cython code score-2 '>static __pyx_ctuple_struct__dunderpyx_t_11trajeometry__dunderNextPoint__and_double __pyx_f_11trajeometry__next_point_score(Py_ssize_t __pyx_v_closest_index, double __pyx_v_vector_factor, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_scores, double __pyx_v_target_distance, CYTHON_UNUSED int __pyx_v_extend, CYTHON_UNUSED Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  __pyx_ctuple_struct__dunderpyx_t_11trajeometry__dunderNextPoint__and_double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry._next_point_score", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">248</span>: 	"""Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>: 	   - closest_index   : Py_ssize_t   : Index of the initial point on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>: 	   - vector_factor   : double       : Portion of the outgoing vector of the given index on the curve to add to get the initial point</pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: 	   - curve           : double[2, N] : Numerical curve to follow</pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: 	   - target_distance : double       : Distance from the projection of the initial point to the result</pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>: 	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>: 	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>: 	&lt;--------------------- _NextPoint   : Next point parameters</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>: 	&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>: 	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both invalid</pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>: 	cdef _NextPoint result = _next_point(closest_index, vector_factor, curve, target_distance)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_f_11trajeometry__next_point(__pyx_v_closest_index, __pyx_v_vector_factor, __pyx_v_curve, __pyx_v_target_distance);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 259, __pyx_L1_error)</span>
  __pyx_v_result = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>: 	if result.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_result.index &lt; 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>: 		return (result, NAN)</pre>
<pre class='cython code score-0 '>    __pyx_t_3.f0 = __pyx_v_result;
    __pyx_t_3.f1 = NAN;
    __pyx_r = __pyx_t_3;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">262</span>: 	else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>: 		return (result, scores[result.index]*(1-result.vector_factor) + scores[result.index + 1]*result.vector_factor)</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_t_4 = __pyx_v_result.index;
    __pyx_t_5 = (__pyx_v_result.index + 1);
    __pyx_t_3.f0 = __pyx_v_result;
    __pyx_t_3.f1 = (((*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) ))) * (1.0 - __pyx_v_result.vector_factor)) + ((*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_5 * __pyx_v_scores.strides[0]) ))) * __pyx_v_result.vector_factor));
    __pyx_r = __pyx_t_3;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-176" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>: def next_point_score(double[:] point, double[:, :] curve, double[:] scores, double target_distance, bint extend=False, Py_ssize_t min_index=0):</pre>
<pre class='cython code score-176 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_11next_point_score(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_10next_point_score, "Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order\n\t   - point           : double[2]    : Initial point\n\t   - curve           : double[2, N] : Numerical curve to follow\n\t   - target_distance : double       : Distance from the projection of the initial point to the result\n\t   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve\n\t   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve\n\t&lt;--------------------- double[2]    : Coordinates of the resulting point\n\t&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples\n\t                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both None\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_11next_point_score = {"next_point_score", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_11next_point_score, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_10next_point_score};
static PyObject *__pyx_pw_11trajeometry_11next_point_score(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_target_distance;
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("next_point_score (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_curve,&amp;__pyx_n_s_scores,&amp;__pyx_n_s_target_distance,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
  PyObject* values[6] = {0,0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_point)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 1); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scores)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 2); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_distance)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, 3); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_extend);
          if (value) { values[4] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_min_index);
          if (value) { values[5] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "next_point_score") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 265, __pyx_L3_error)</span>
    __pyx_v_target_distance = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_target_distance == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[4]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    } else {
      __pyx_v_extend = ((int)((int)0));
    }
    if (values[5]) {
      __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[5]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
    } else {
      __pyx_v_min_index = ((Py_ssize_t)((Py_ssize_t)0));
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("next_point_score", 0, 4, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point_score", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_10next_point_score(__pyx_self, __pyx_v_point, __pyx_v_curve, __pyx_v_scores, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_10next_point_score(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_scores, double __pyx_v_target_distance, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_result;
  double __pyx_v_score;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.next_point_score", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__38 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_point, __pyx_n_s_curve, __pyx_n_s_scores, __pyx_n_s_target_distance, __pyx_n_s_extend, __pyx_n_s_min_index, __pyx_n_s_projection, __pyx_n_s_result, __pyx_n_s_score);<span class='error_goto'> if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__38);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__38);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>(((Py_ssize_t)0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L1_error)</span>;
  __pyx_t_7 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_11next_point_score, 0, __pyx_n_s_next_point_score, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__39));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_next_point_score, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 265, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__39 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_next_point_score, 265, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">266</span>: 	"""Find a point along the curve that is `target_distance` further than the projection of (point_x, point_y) on the curve, along its given order</pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>: 	   - point           : double[2]    : Initial point</pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>: 	   - curve           : double[2, N] : Numerical curve to follow</pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: 	   - target_distance : double       : Distance from the projection of the initial point to the result</pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>: 	   - extend          : bool         : Stay valid even when the initial point is before the first sample of the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: 	   - min_index       : Py_ssize_t   : Do not try to start before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>: 	&lt;--------------------- double[2]    : Coordinates of the resulting point</pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>: 	&lt;--------------------- double       : Score of the resulting point, taking into account the surrounding samples when it is in-between two samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: 	                                      If the initial point projection is before the first sample of the curve and `extend` is False, or if the resulting point is beyond the last sample of the curve, return both None</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: 	# First take the closest point on the curve to the initial point</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>: 	cdef _ProjectionIndex projection = _project_on_curve_index(point[0], point[1], curve, extend, min_index)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 1;
  __pyx_t_3 = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))), (*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_2 * __pyx_v_point.strides[0]) ))), __pyx_v_curve, __pyx_v_extend, __pyx_v_min_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 277, __pyx_L1_error)</span>
  __pyx_v_projection = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">278</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>: 	# The extension shenanigans are handled entirely by _project_on_curve_index, just fail when it fails</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>: 	if projection.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_projection.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">281</span>: 		return (_NextPoint(x=NAN, y=NAN, index=-1, vector_factor=NAN), NAN)</pre>
<pre class='cython code score-55 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_x, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_y, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_index, __pyx_int_neg_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_vector_factor, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(NAN);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 281, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 281, __pyx_L1_error)</span>;
    __pyx_t_5 = 0;
    __pyx_t_6 = 0;
    __pyx_r = __pyx_t_7;
    __pyx_t_7 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: 	cdef _NextPoint result</pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: 	cdef double score</pre>
<pre class="cython line score-0">&#xA0;<span class="">285</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>: 	result, score = _next_point_score(projection.index, projection.vector_factor, curve, scores, target_distance, extend, min_index)</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = __pyx_f_11trajeometry__next_point_score(__pyx_v_projection.index, __pyx_v_projection.vector_factor, __pyx_v_curve, __pyx_v_scores, __pyx_v_target_distance, __pyx_v_extend, __pyx_v_min_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 286, __pyx_L1_error)</span>
  __pyx_t_9 = __pyx_t_8.f0;
  __pyx_t_10 = __pyx_t_8.f1;
  __pyx_v_result = __pyx_t_9;
  __pyx_v_score = __pyx_t_10;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>: 	if result.index &lt; 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = (__pyx_v_result.index &lt; 0);
  if (__pyx_t_4) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>: 		return None, None, None</pre>
<pre class='cython code score-7 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_tuple__16);
    __pyx_r = __pyx_tuple__16;
    goto __pyx_L0;
/* … */
  __pyx_tuple__16 = <span class='py_c_api'>PyTuple_Pack</span>(3, Py_None, Py_None, Py_None);<span class='error_goto'> if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__16);
</pre><pre class="cython line score-0">&#xA0;<span class="">289</span>: 	else:</pre>
<pre class="cython line score-58" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>: 		return np.asarray((result.x, result.y)), score, result.index</pre>
<pre class='cython code score-58 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.x);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_11 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_result.y);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>;
    __pyx_t_6 = 0;
    __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_13 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_11 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_11)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        __pyx_t_13 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_12};
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_score);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_result.index);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 2, __pyx_t_12)) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>;
    __pyx_t_7 = 0;
    __pyx_t_5 = 0;
    __pyx_t_12 = 0;
    __pyx_r = __pyx_t_11;
    __pyx_t_11 = 0;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">291</span>: </pre>
<pre class="cython line score-135" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>: cpdef _ProjectionIndex project_from(double[:] point, double[:] vector, double[:, :] target_curve, bint extend, Py_ssize_t min_index):</pre>
<pre class='cython code score-135 '>static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static struct __pyx_t_11trajeometry__ProjectionIndex __pyx_f_11trajeometry_project_from(__Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_vector, __Pyx_memviewslice __pyx_v_target_curve, CYTHON_UNUSED int __pyx_v_extend, Py_ssize_t __pyx_v_min_index, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  double __pyx_v_check1_x;
  double __pyx_v_check1_y;
  double __pyx_v_check2_x;
  double __pyx_v_check2_y;
  double __pyx_v_ortho_x;
  double __pyx_v_ortho_y;
  double __pyx_v_denominator;
  double __pyx_v_interp;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_pretend_to_initialize(&amp;__pyx_r);
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_12project_from, "\302\253 Project \302\273 a point from the segment it belongs to, to another curve\n\t   The vector from the original point and its projection is orthogonal to the segment of origin, not to the target curve\n\t   Return the first intersection in the order of the target curve, not particularly the closest to the original point\n\t   - point        : double[2]        : Point to project\n\t   - vector       : double[2]        : The projection must be on the orthogonal vector to this relative to the point\n\t   - target_curve : double[2, N]     : Curve to project onto\n\t   - extend       : bool             : Stay valid even when the intersection is before the first sample of the curve\n\t   - min_index    : Py_ssize_t       : Do not search before that index on the curve\n\t&lt;------------------ _ProjectionIndex : Result of the projection, as (index, interpolation)\n\t                                       If no valid intersection was found, return .index = -1 and .vector_factor = NAN\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_13project_from = {"project_from", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_13project_from, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_12project_from};
static PyObject *__pyx_pw_11trajeometry_13project_from(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_point = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_target_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_extend;
  Py_ssize_t __pyx_v_min_index;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("project_from (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_point,&amp;__pyx_n_s_vector,&amp;__pyx_n_s_target_curve,&amp;__pyx_n_s_extend,&amp;__pyx_n_s_min_index,0};
  PyObject* values[5] = {0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_point)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_vector)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_extend)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_min_index)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[4]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "project_from") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 5)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
      values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
    }
    __pyx_v_point = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_point.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_vector = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_vector.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_target_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_target_curve.memview)) __PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_extend = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[3]); if (unlikely((__pyx_v_extend == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
    __pyx_v_min_index = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[4]); if (unlikely((__pyx_v_min_index == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("project_from", 1, 5, 5, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vector, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_12project_from(__pyx_self, __pyx_v_point, __pyx_v_vector, __pyx_v_target_curve, __pyx_v_extend, __pyx_v_min_index);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_point, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_vector, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_12project_from(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_point, __Pyx_memviewslice __pyx_v_vector, __Pyx_memviewslice __pyx_v_target_curve, int __pyx_v_extend, Py_ssize_t __pyx_v_min_index) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_project_from(__pyx_v_point, __pyx_v_vector, __pyx_v_target_curve, __pyx_v_extend, __pyx_v_min_index, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_convert__to_py_struct____pyx_t_11trajeometry__ProjectionIndex(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.project_from", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__40 = <span class='py_c_api'>PyTuple_Pack</span>(5, __pyx_n_s_point, __pyx_n_s_vector, __pyx_n_s_target_curve, __pyx_n_s_extend, __pyx_n_s_min_index);<span class='error_goto'> if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__40);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__40);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_13project_from, 0, __pyx_n_s_project_from, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__41));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_project_from, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__41 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_project_from, 292, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__41)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">293</span>: 	"""« Project » a point from the segment it belongs to, to another curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">294</span>: 	   The vector from the original point and its projection is orthogonal to the segment of origin, not to the target curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">295</span>: 	   Return the first intersection in the order of the target curve, not particularly the closest to the original point</pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: 	   - point        : double[2]        : Point to project</pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: 	   - vector       : double[2]        : The projection must be on the orthogonal vector to this relative to the point</pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>: 	   - target_curve : double[2, N]     : Curve to project onto</pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: 	   - extend       : bool             : Stay valid even when the intersection is before the first sample of the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>: 	   - min_index    : Py_ssize_t       : Do not search before that index on the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">301</span>: 	&lt;------------------ _ProjectionIndex : Result of the projection, as (index, interpolation)</pre>
<pre class="cython line score-0">&#xA0;<span class="">302</span>: 	                                       If no valid intersection was found, return .index = -1 and .vector_factor = NAN</pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: 	cdef Py_ssize_t i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>: 	cdef double check1_x, check1_y, check2_x, check2_y, ortho_x = -vector[1], ortho_y = vector[0]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 1;
  __pyx_v_ortho_x = (-(*((double *) ( /* dim=0 */ (__pyx_v_vector.data + __pyx_t_1 * __pyx_v_vector.strides[0]) ))));
  __pyx_t_1 = 0;
  __pyx_v_ortho_y = (*((double *) ( /* dim=0 */ (__pyx_v_vector.data + __pyx_t_1 * __pyx_v_vector.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">306</span>: 	cdef double denominator, interp  #, factor</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>: 	for i in range(min_index, target_curve.shape[1] - 1):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = ((__pyx_v_target_curve.shape[1]) - 1);
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = __pyx_v_min_index; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>: 		check1_x = target_curve[0, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_check1_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_1 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>: 		check1_y = target_curve[1, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_1 = __pyx_v_i;
    __pyx_v_check1_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_5 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>: 		check2_x = target_curve[0, i+1]</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_v_check2_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_1 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>: 		check2_y = target_curve[1, i+1]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_1 = (__pyx_v_i + 1);
    __pyx_v_check2_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_curve.data + __pyx_t_5 * __pyx_v_target_curve.strides[0]) ) + __pyx_t_1 * __pyx_v_target_curve.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>: 		# Basically, we solve the following vector equation :</pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: 		# point + factor*ortho = (1 - interp)*check1 + interp*check2,</pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: 		# to get the intersection between the orthogonal projecting line and the curve segment line</pre>
<pre class="cython line score-0">&#xA0;<span class="">316</span>: 		# If the solution is defined and the interpolation factor is in [0, 1], then the intersection is on this segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>: 		denominator = check1_x*ortho_y - check1_y*ortho_x - check2_x*ortho_y + check2_y*ortho_x</pre>
<pre class='cython code score-0 '>    __pyx_v_denominator = ((((__pyx_v_check1_x * __pyx_v_ortho_y) - (__pyx_v_check1_y * __pyx_v_ortho_x)) - (__pyx_v_check2_x * __pyx_v_ortho_y)) + (__pyx_v_check2_y * __pyx_v_ortho_x));
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>: 		# Vector and interpolation factors undefined -&gt; the segment is colinear with the vector, skip</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>: 		if denominator == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = (__pyx_v_denominator == 0.0);
    if (__pyx_t_6) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>: 			continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">322</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>: 		# Actually we only need the interpolation factor</pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>: 		# factor = (check1_x*check2_y - check1_x*point[1] - check1_y*check2_x + check1_y*point[0] + check2_x*point[1] - check2_y*point[0]) / denominator</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>: 		interp = (check1_x*ortho_y - check1_y*ortho_x - point[0]*ortho_y + point[1]*ortho_x) / denominator</pre>
<pre class='cython code score-5 '>    __pyx_t_1 = 0;
    __pyx_t_5 = 1;
    __pyx_t_7 = ((((__pyx_v_check1_x * __pyx_v_ortho_y) - (__pyx_v_check1_y * __pyx_v_ortho_x)) - ((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_1 * __pyx_v_point.strides[0]) ))) * __pyx_v_ortho_y)) + ((*((double *) ( /* dim=0 */ (__pyx_v_point.data + __pyx_t_5 * __pyx_v_point.strides[0]) ))) * __pyx_v_ortho_x));
    if (unlikely(__pyx_v_denominator == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
    }
    __pyx_v_interp = (__pyx_t_7 / __pyx_v_denominator);
</pre><pre class="cython line score-0">&#xA0;<span class="">326</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>: 		# Interpolation falls within the actual segment, or before if we’re in extended mode -&gt; found the intersection</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">328</span>: 		if (interp &gt;= 0 and interp &lt;= 1) or (i == 0 and interp &lt; 0):</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (__pyx_v_interp &gt;= 0.0);
    if (!__pyx_t_8) {
      goto __pyx_L8_next_or;
    } else {
    }
    __pyx_t_8 = (__pyx_v_interp &lt;= 1.0);
    if (!__pyx_t_8) {
    } else {
      __pyx_t_6 = __pyx_t_8;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_L8_next_or:;
    __pyx_t_8 = (__pyx_v_i == 0);
    if (__pyx_t_8) {
    } else {
      __pyx_t_6 = __pyx_t_8;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_8 = (__pyx_v_interp &lt; 0.0);
    __pyx_t_6 = __pyx_t_8;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_6) {
/* … */
    }
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">329</span>: 			return _ProjectionIndex(index=i, vector_factor=interp)</pre>
<pre class='cython code score-0 '>      __pyx_t_9.index = __pyx_v_i;
      __pyx_t_9.vector_factor = __pyx_v_interp;
      __pyx_r = __pyx_t_9;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">330</span>: 	# Didn’t find any valid intersection -&gt; fail</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>: 	return _ProjectionIndex(index=-1, vector_factor=NAN)</pre>
<pre class='cython code score-0 '>  __pyx_t_9.index = -1;
  __pyx_t_9.vector_factor = NAN;
  __pyx_r = __pyx_t_9;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-83" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>: def resample_curve(double[:, :] curve, double step):</pre>
<pre class='cython code score-83 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_15resample_curve(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_14resample_curve, "Resample a curve such that points are (approximately) equidistant\n\t   - curve : double[2, N] : Numerical curve to resample\n\t   - step  : double       : Distance between the resampled points\n\t&lt;----------- double[2, M] : Resampled curve. Points are *approximately* at distance `step` from each other\n\t                            There is no guarantee on the actual number of points in the resampled curve");
static PyMethodDef __pyx_mdef_11trajeometry_15resample_curve = {"resample_curve", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_15resample_curve, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_14resample_curve};
static PyObject *__pyx_pw_11trajeometry_15resample_curve(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_step;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("resample_curve (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_step,0};
  PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_step)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resample_curve", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "resample_curve") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 334, __pyx_L3_error)</span>
    __pyx_v_step = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_step == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("resample_curve", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.resample_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_14resample_curve(__pyx_self, __pyx_v_curve, __pyx_v_step);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_14resample_curve(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_step) {
  std::vector&lt;__pyx_ctuple_double__and_double&gt;  __pyx_v_resampled;
  CYTHON_UNUSED Py_ssize_t __pyx_v_last_index;
  struct __pyx_t_11trajeometry__NextPoint __pyx_v_point;
  PyObject *__pyx_v_result = NULL;
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  size_t __pyx_v_i;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_13, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.resample_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_view, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__42 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_curve, __pyx_n_s_step, __pyx_n_s_resampled, __pyx_n_s_last_index, __pyx_n_s_point, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_i);<span class='error_goto'> if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__42);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__42);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_15resample_curve, 0, __pyx_n_s_resample_curve, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__43));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_resample_curve, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__43 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_resample_curve, 334, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__43)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">335</span>: 	"""Resample a curve such that points are (approximately) equidistant</pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>: 	   - curve : double[2, N] : Numerical curve to resample</pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>: 	   - step  : double       : Distance between the resampled points</pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: 	&lt;----------- double[2, M] : Resampled curve. Points are *approximately* at distance `step` from each other</pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: 	                            There is no guarantee on the actual number of points in the resampled curve"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>: 	# Keep the same first sample</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">341</span>: 	cdef vector[(double, double)] resampled</pre>
<pre class='cython code score-0 '>struct __pyx_ctuple_double__and_double {
  double f0;
  double f1;
};
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">342</span>: 	resampled.push_back((curve[0, 0], curve[1, 0]))</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_t_5.f0 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_1 * __pyx_v_curve.strides[0]) ) + __pyx_t_2 * __pyx_v_curve.strides[1]) )));
  __pyx_t_5.f1 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
  try {
    __pyx_v_resampled.push_back(__pyx_t_5);
  } catch(...) {
    __Pyx_CppExn2PyErr();
    <span class='error_goto'>__PYX_ERR(0, 342, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">343</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: 	# Then just apply _next_point in a loop until we find the end of the curve</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">345</span>: 	cdef Py_ssize_t last_index = -1</pre>
<pre class='cython code score-0 '>  __pyx_v_last_index = -1L;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>: 	cdef _NextPoint point = _NextPoint(x=curve[0, 0], y=curve[1, 0], index=0, vector_factor=0)</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_6.x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_3 * __pyx_v_curve.strides[1]) )));
  __pyx_t_3 = 1;
  __pyx_t_4 = 0;
  __pyx_t_6.y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_3 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) )));
  __pyx_t_6.index = 0;
  __pyx_t_6.vector_factor = 0.0;
  __pyx_v_point = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>: 	while True:</pre>
<pre class='cython code score-0 '>  while (1) {
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>: 		point = _next_point(point.index, point.vector_factor, curve, step)</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_f_11trajeometry__next_point(__pyx_v_point.index, __pyx_v_point.vector_factor, __pyx_v_curve, __pyx_v_step);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L1_error)</span>
    __pyx_v_point = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: 		# Passed the end of the curve</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>: 		if point.index &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = (__pyx_v_point.index &lt; 0);
    if (__pyx_t_7) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">352</span>: 			break</pre>
<pre class='cython code score-0 '>      goto __pyx_L4_break;
</pre><pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>: 		last_index = point.index</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = __pyx_v_point.index;
    __pyx_v_last_index = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>: 		resampled.push_back((point.x, point.y))</pre>
<pre class='cython code score-0 '>    __pyx_t_5.f0 = __pyx_v_point.x;
    __pyx_t_5.f1 = __pyx_v_point.y;
    try {
      __pyx_v_resampled.push_back(__pyx_t_5);
    } catch(...) {
      __Pyx_CppExn2PyErr();
      <span class='error_goto'>__PYX_ERR(0, 355, __pyx_L1_error)</span>
    }
  }
  __pyx_L4_break:;
</pre><pre class="cython line score-0">&#xA0;<span class="">356</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: 	# Copy the content of the vector into a fixed numpy array</pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>: 	result = np.empty((2, resampled.size()))</pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_resampled.size());<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_int_2)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>;
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_12};
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_11, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  }
  __pyx_v_result = __pyx_t_9;
  __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>: 	cdef double[:, :] result_view = result</pre>
<pre class='cython code score-2 '>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_13.memview)) __PYX_ERR(0, 359, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_13;
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">360</span>: 	cdef size_t i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>: 	for i in range(resampled.size()):</pre>
<pre class='cython code score-0 '>  __pyx_t_14 = __pyx_v_resampled.size();
  __pyx_t_15 = __pyx_t_14;
  for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
    __pyx_v_i = __pyx_t_16;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>: 		result[0, i] = resampled[i][0]</pre>
<pre class='cython code score-24 '>    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_resampled[__pyx_v_i]).f0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_0);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_int_0)) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_12, 1, __pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>;
    __pyx_t_11 = 0;
    if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_t_12, __pyx_t_9) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>: 		result[1, i] = resampled[i][1]</pre>
<pre class='cython code score-24 '>    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_resampled[__pyx_v_i]).f1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(__pyx_v_i);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_1);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_int_1)) <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_11, 1, __pyx_t_12)) <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>;
    __pyx_t_12 = 0;
    if (unlikely((<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_result, __pyx_t_11, __pyx_t_9) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 363, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>: 	return result</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">365</span>: </pre>
<pre class="cython line score-113" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>: cpdef bint segments_intersect(double[:] A, double[:] B, double[:] C, double[:] D):</pre>
<pre class='cython code score-113 '>static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static int __pyx_f_11trajeometry_segments_intersect(__Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B, __Pyx_memviewslice __pyx_v_C, __Pyx_memviewslice __pyx_v_D, CYTHON_UNUSED int __pyx_skip_dispatch) {
  double __pyx_v_determinant_A;
  double __pyx_v_determinant_B;
  double __pyx_v_determinant_C;
  double __pyx_v_determinant_D;
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_16segments_intersect, "Check whether the segments AB and CD intersect with each other\n\t   - A : double[2] : First point of the first segment\n\t   - B : double[2] : Second point of the first segment\n\t   - C : double[2] : First point of the second segment\n\t   - D : double[2] : Second point of the second segment\n\t&lt;------- bool      : Whether the segments AB and CD intersect\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_17segments_intersect = {"segments_intersect", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_17segments_intersect, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_16segments_intersect};
static PyObject *__pyx_pw_11trajeometry_17segments_intersect(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_A = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_B = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_C = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_D = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("segments_intersect (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_A,&amp;__pyx_n_s_B,&amp;__pyx_n_s_C,&amp;__pyx_n_s_D,0};
  PyObject* values[4] = {0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_A)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_B)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_C)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_D)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[3]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "segments_intersect") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 4)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
    }
    __pyx_v_A = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_A.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_B = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_B.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_C = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_C.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
    __pyx_v_D = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_D.memview)) __PYX_ERR(0, 366, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("segments_intersect", 1, 4, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_A, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_B, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_C, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_D, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.segments_intersect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_16segments_intersect(__pyx_self, __pyx_v_A, __pyx_v_B, __pyx_v_C, __pyx_v_D);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_A, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_B, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_C, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_D, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_16segments_intersect(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B, __Pyx_memviewslice __pyx_v_C, __Pyx_memviewslice __pyx_v_D) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_segments_intersect(__pyx_v_A, __pyx_v_B, __pyx_v_C, __pyx_v_D, 0); if (unlikely(__pyx_t_1 == ((int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.segments_intersect", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__44 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_A, __pyx_n_s_B, __pyx_n_s_C, __pyx_n_s_D);<span class='error_goto'> if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__44);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__44);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_17segments_intersect, 0, __pyx_n_s_segments_intersect, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__45));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_segments_intersect, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__45 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_segments_intersect, 366, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__45)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">367</span>: 	"""Check whether the segments AB and CD intersect with each other</pre>
<pre class="cython line score-0">&#xA0;<span class="">368</span>: 	   - A : double[2] : First point of the first segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">369</span>: 	   - B : double[2] : Second point of the first segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">370</span>: 	   - C : double[2] : First point of the second segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">371</span>: 	   - D : double[2] : Second point of the second segment</pre>
<pre class="cython line score-0">&#xA0;<span class="">372</span>: 	&lt;------- bool      : Whether the segments AB and CD intersect</pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">374</span>: 	cdef double determinant_A = (C[0]-A[0]) * (D[1]-A[1]) - (D[0]-A[0]) * (C[1]-A[1])</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 1;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 1;
  __pyx_t_8 = 1;
  __pyx_v_determinant_A = ((((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_1 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_2 * __pyx_v_A.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_3 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_4 * __pyx_v_A.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_5 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_6 * __pyx_v_A.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_7 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_8 * __pyx_v_A.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>: 	cdef double determinant_B = (C[0]-B[0]) * (D[1]-B[1]) - (D[0]-B[0]) * (C[1]-B[1])</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = 0;
  __pyx_t_7 = 0;
  __pyx_t_6 = 1;
  __pyx_t_5 = 1;
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_2 = 1;
  __pyx_t_1 = 1;
  __pyx_v_determinant_B = ((((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_8 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_7 * __pyx_v_B.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_6 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_5 * __pyx_v_B.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_4 * __pyx_v_D.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_3 * __pyx_v_B.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_2 * __pyx_v_C.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_1 * __pyx_v_B.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>: 	cdef double determinant_C = (A[0]-C[0]) * (B[1]-C[1]) - (B[0]-C[0]) * (A[1]-C[1])</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = 1;
  __pyx_t_4 = 1;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_7 = 1;
  __pyx_t_8 = 1;
  __pyx_v_determinant_C = ((((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_1 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_2 * __pyx_v_C.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_3 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_4 * __pyx_v_C.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_5 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_6 * __pyx_v_C.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_7 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_C.data + __pyx_t_8 * __pyx_v_C.strides[0]) ))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">377</span>: 	cdef double determinant_D = (A[0]-D[0]) * (B[1]-D[1]) - (B[0]-D[0]) * (A[1]-D[1])</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = 0;
  __pyx_t_7 = 0;
  __pyx_t_6 = 1;
  __pyx_t_5 = 1;
  __pyx_t_4 = 0;
  __pyx_t_3 = 0;
  __pyx_t_2 = 1;
  __pyx_t_1 = 1;
  __pyx_v_determinant_D = ((((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_8 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_7 * __pyx_v_D.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_6 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_5 * __pyx_v_D.strides[0]) ))))) - (((*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_4 * __pyx_v_B.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_3 * __pyx_v_D.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_2 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_D.data + __pyx_t_1 * __pyx_v_D.strides[0]) ))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">378</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>: 	return (((determinant_A &gt; 0 and determinant_B &lt; 0) or (determinant_A &lt; 0 and determinant_B &gt; 0)) and</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = (__pyx_v_determinant_A &gt; 0.0);
  if (!__pyx_t_10) {
    goto __pyx_L5_next_or;
  } else {
  }
  __pyx_t_10 = (__pyx_v_determinant_B &lt; 0.0);
  if (!__pyx_t_10) {
  } else {
    goto __pyx_L4_next_and;
  }
  __pyx_L5_next_or:;
  __pyx_t_10 = (__pyx_v_determinant_A &lt; 0.0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_10 = (__pyx_v_determinant_B &gt; 0.0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_L4_next_and:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>: 	        ((determinant_C &gt; 0 and determinant_D &lt; 0) or (determinant_C &lt; 0 and determinant_D &gt; 0)))</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = (__pyx_v_determinant_C &gt; 0.0);
  if (!__pyx_t_10) {
    goto __pyx_L8_next_or;
  } else {
  }
  __pyx_t_10 = (__pyx_v_determinant_D &lt; 0.0);
  if (!__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_L8_next_or:;
  __pyx_t_10 = (__pyx_v_determinant_C &lt; 0.0);
  if (__pyx_t_10) {
  } else {
    __pyx_t_9 = __pyx_t_10;
    goto __pyx_L3_bool_binop_done;
  }
  __pyx_t_10 = (__pyx_v_determinant_D &gt; 0.0);
  __pyx_t_9 = __pyx_t_10;
  __pyx_L3_bool_binop_done:;
  __pyx_r = __pyx_t_9;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-74" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>: cpdef void find_self_intersects(double[:, :] curve, bint[:] mask):</pre>
<pre class='cython code score-74 '>static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static void __pyx_f_11trajeometry_find_self_intersects(__Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_mask, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_j;
  CYTHON_UNUSED Py_ssize_t __pyx_v_result_size;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_10, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_18find_self_intersects, "Find the areas where a discrete curve intersects itself, and build a mask\n\t   Applying this mask to the curve remove the intersecting parts altogether\n\t   - curve : double[2, N] : Curve to check\n\t   - mask  : bool[N]      : Output for the mask\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_19find_self_intersects = {"find_self_intersects", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_19find_self_intersects, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_18find_self_intersects};
static PyObject *__pyx_pw_11trajeometry_19find_self_intersects(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("find_self_intersects (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_mask,0};
  PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mask)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_self_intersects", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_self_intersects") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 382, __pyx_L3_error)</span>
    __pyx_v_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_bint</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_mask.memview)) __PYX_ERR(0, 382, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("find_self_intersects", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_18find_self_intersects(__pyx_self, __pyx_v_curve, __pyx_v_mask);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_18find_self_intersects(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, __Pyx_memviewslice __pyx_v_mask) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_f_11trajeometry_find_self_intersects(__pyx_v_curve, __pyx_v_mask, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  __pyx_t_1 = __Pyx_void_to_None(NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.find_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__46 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_curve, __pyx_n_s_mask);<span class='error_goto'> if (unlikely(!__pyx_tuple__46)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__46);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__46);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_19find_self_intersects, 0, __pyx_n_s_find_self_intersects, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__47));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_find_self_intersects, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__47 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_find_self_intersects, 382, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__47)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">383</span>: 	"""Find the areas where a discrete curve intersects itself, and build a mask</pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>: 	   Applying this mask to the curve remove the intersecting parts altogether</pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>: 	   - curve : double[2, N] : Curve to check</pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>: 	   - mask  : bool[N]      : Output for the mask</pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>: 	cdef Py_ssize_t i, j, result_size = curve.shape[1]</pre>
<pre class='cython code score-0 '>  __pyx_v_result_size = (__pyx_v_curve.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>: 	mask[:] = True</pre>
<pre class='cython code score-0 '>  {
      int __pyx_temp_scalar = 1;
      {
          Py_ssize_t __pyx_temp_extent_0 = __pyx_v_mask.shape[0];
          Py_ssize_t __pyx_temp_stride_0 = __pyx_v_mask.strides[0];
          char *__pyx_temp_pointer_0;
          Py_ssize_t __pyx_temp_idx_0;
          __pyx_temp_pointer_0 = __pyx_v_mask.data;
          for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
            *((int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
            __pyx_temp_pointer_0 += __pyx_temp_stride_0;
          }
      }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">390</span>: 	# Check for intersection between each pair of segments</pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>: 	# When two segments intersect, cut out everything in-between such that the points</pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>: 	# before the first segment and after the second segment are linked, removing the intersecting part</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>: 	for i in range(curve.shape[1]-1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">394</span>: 		for j in range(i+1, curve.shape[1]-1):</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_v_curve.shape[1]) - 1);
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = (__pyx_v_i + 1); __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>: 			if segments_intersect(curve[:, i], curve[:, i+1], curve[:, j], curve[:, j+1]):</pre>
<pre class='cython code score-5 '>      __pyx_t_7.data = __pyx_v_curve.data;
      __pyx_t_7.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_7, 1);
      __pyx_t_7.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_7.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_7.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_7.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_8.data = __pyx_v_curve.data;
      __pyx_t_8.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_8, 1);
      __pyx_t_8.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_8.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_8.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_i + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_8.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_9.data = __pyx_v_curve.data;
      __pyx_t_9.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_9.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_9.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_j;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_9.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_10.data = __pyx_v_curve.data;
      __pyx_t_10.memview = __pyx_v_curve.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_10.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_10.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_j + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_10.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11 = __pyx_f_11trajeometry_segments_intersect(__pyx_t_7, __pyx_t_8, __pyx_t_9, __pyx_t_10, 0); if (unlikely(__pyx_t_11 == ((int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 395, __pyx_L1_error)</span>
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
      __pyx_t_7.memview = NULL; __pyx_t_7.data = NULL;
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
      __pyx_t_8.memview = NULL; __pyx_t_8.data = NULL;
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_9, 1);
      __pyx_t_9.memview = NULL; __pyx_t_9.data = NULL;
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_10, 1);
      __pyx_t_10.memview = NULL; __pyx_t_10.data = NULL;
      if (__pyx_t_11) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>: 				mask[i+1:j+1] = False</pre>
<pre class='cython code score-0 '>        __pyx_t_12.data = __pyx_v_mask.data;
        __pyx_t_12.memview = __pyx_v_mask.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 1);
        __pyx_t_13 = -1;
        if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_12,
    __pyx_v_mask.shape[0], __pyx_v_mask.strides[0], __pyx_v_mask.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_13,
    (__pyx_v_i + 1),
    (__pyx_v_j + 1),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
}

{
            int __pyx_temp_scalar = 0;
            {
                Py_ssize_t __pyx_temp_extent_0 = __pyx_t_12.shape[0];
                Py_ssize_t __pyx_temp_stride_0 = __pyx_t_12.strides[0];
                char *__pyx_temp_pointer_0;
                Py_ssize_t __pyx_temp_idx_0;
                __pyx_temp_pointer_0 = __pyx_t_12.data;
                for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 &lt; __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                  *((int *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                  __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                }
            }
        }
        __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
        __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>: </pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>: def remove_self_intersects(curve):</pre>
<pre class='cython code score-51 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_21remove_self_intersects(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_20remove_self_intersects, "Remove self-intersecting parts in a discrete curve\n\t   - curve : ndarray[2, N] : Curve to process\n\t&lt;----------- ndarray[2, M] : That same curve with self-intersecting parts removed\n\t                             This operation only deletes points without changing the others");
static PyMethodDef __pyx_mdef_11trajeometry_21remove_self_intersects = {"remove_self_intersects", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_21remove_self_intersects, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_20remove_self_intersects};
static PyObject *__pyx_pw_11trajeometry_21remove_self_intersects(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_curve = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("remove_self_intersects (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,0};
  PyObject* values[1] = {0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "remove_self_intersects") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
    }
    __pyx_v_curve = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("remove_self_intersects", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.remove_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_20remove_self_intersects(__pyx_self, __pyx_v_curve);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_20remove_self_intersects(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_curve) {
  PyObject *__pyx_v_mask = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.remove_self_intersects", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mask);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_21remove_self_intersects, 0, __pyx_n_s_remove_self_intersects, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__48));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_remove_self_intersects, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
  __pyx_codeobj__48 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__46, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_remove_self_intersects, 398, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__48)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">399</span>: 	"""Remove self-intersecting parts in a discrete curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: 	   - curve : ndarray[2, N] : Curve to process</pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: 	&lt;----------- ndarray[2, M] : That same curve with self-intersecting parts removed</pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>: 	                             This operation only deletes points without changing the others"""</pre>
<pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>: 	mask = np.ones(curve.shape[1], dtype=int)</pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_curve, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, ((PyObject *)(&amp;PyInt_Type))) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_mask = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">404</span>: 	find_self_intersects(curve, mask)</pre>
<pre class='cython code score-4 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_curve, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_5.memview)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_bint</span>(__pyx_v_mask, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  __pyx_f_11trajeometry_find_self_intersects(__pyx_t_5, __pyx_t_6, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_5, 1);
  __pyx_t_5.memview = NULL; __pyx_t_5.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL; __pyx_t_6.data = NULL;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>: 	return curve[:, mask &gt; 0]</pre>
<pre class='cython code score-19 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_mask, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_slice__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_slice__5)) <span class='error_goto'>__PYX_ERR(0, 405, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 405, __pyx_L1_error)</span>;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(__pyx_v_curve, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">406</span>: </pre>
<pre class="cython line score-156" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>: def dilate_curve(double[:, :] curve, double dilation, long direction, double[:] scores=None):</pre>
<pre class='cython code score-156 '>static PyObject *__pyx_pf_11trajeometry_34__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_memoryview_fromslice(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self)-&gt;__pyx_arg_scores, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 1, Py_None)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_23dilate_curve(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_22dilate_curve, "Apply a \"dilation\" operation to a discrete curve, that is, offset it regularly regardless of the curve orientation :\n\t   all points of the dilated curve are approximately at the same distance of their corresponding original point\n\t   - curve     : double[2, N] : Curve to dilate\n\t   - dilation  : double       : Distance of the result to the original curve\n\t   - direction : int          : 1 or -1, to choose the offset direction\n\t   - scores    : double[N]    : Scores associated to the original curve, or None.\n\t&lt;--------------- double[2, M] : Dilated curve. The number of points may not be the same, as self-intersecting parts are removed\n\t&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the dilated curve, with the same parts cut out\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_23dilate_curve = {"dilate_curve", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_23dilate_curve, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_22dilate_curve};
static PyObject *__pyx_pw_11trajeometry_23dilate_curve(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_dilation;
  long __pyx_v_direction;
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dilate_curve (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_dilation,&amp;__pyx_n_s_direction,&amp;__pyx_n_s_scores,0};
  PyObject* values[4] = {0,0,0,0};
    __pyx_defaults *__pyx_dynamic_args = <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_self);
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dilation)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, 1); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_direction)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, 2); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scores);
          if (value) { values[3] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "dilate_curve") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 407, __pyx_L3_error)</span>
    __pyx_v_dilation = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_dilation == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
    __pyx_v_direction = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[2]); if (unlikely((__pyx_v_direction == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
    if (values[3]) {
      __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 407, __pyx_L3_error)</span>
    } else {
      __pyx_v_scores = __pyx_dynamic_args-&gt;__pyx_arg_scores;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_scores, 1);
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dilate_curve", 0, 3, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.dilate_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_22dilate_curve(__pyx_self, __pyx_v_curve, __pyx_v_dilation, __pyx_v_direction, __pyx_v_scores);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_22dilate_curve(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_dilation, long __pyx_v_direction, __Pyx_memviewslice __pyx_v_scores) {
  double *__pyx_v_dilated;
  __Pyx_memviewslice __pyx_v_dilated_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_gradient[2];
  double __pyx_v_gradient_norm;
  Py_ssize_t __pyx_v_i;
  int *__pyx_v_mask;
  __Pyx_memviewslice __pyx_v_mask_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_result_size;
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  Py_ssize_t __pyx_v_result_index;
  __Pyx_memviewslice __pyx_v_result_scores_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result_scores = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_4, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_14, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_18, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_19, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.dilate_curve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_dilated_view, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_mask_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_scores_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_scores);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__49 = <span class='py_c_api'>PyTuple_Pack</span>(17, __pyx_n_s_curve, __pyx_n_s_dilation, __pyx_n_s_direction, __pyx_n_s_scores, __pyx_n_s_dilated, __pyx_n_s_dilated_view, __pyx_n_s_gradient, __pyx_n_s_gradient_norm, __pyx_n_s_i, __pyx_n_s_mask, __pyx_n_s_mask_view, __pyx_n_s_result_size, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_result_index, __pyx_n_s_result_scores_view, __pyx_n_s_result_scores);<span class='error_goto'> if (unlikely(!__pyx_tuple__49)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__49);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__49);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_23dilate_curve, 0, __pyx_n_s_dilate_curve, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__50));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (!<span class='pyx_c_api'>__Pyx_CyFunction_InitDefaults</span>(__pyx_t_4, sizeof(__pyx_defaults), 0)) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults, __pyx_t_4)-&gt;__pyx_arg_scores = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsGetter</span>(__pyx_t_4, __pyx_pf_11trajeometry_34__defaults__);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dilate_curve, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__50 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 0, 17, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__49, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_dilate_curve, 407, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__50)) __PYX_ERR(0, 407, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>: 	"""Apply a "dilation" operation to a discrete curve, that is, offset it regularly regardless of the curve orientation :</pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: 	   all points of the dilated curve are approximately at the same distance of their corresponding original point</pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: 	   - curve     : double[2, N] : Curve to dilate</pre>
<pre class="cython line score-0">&#xA0;<span class="">411</span>: 	   - dilation  : double       : Distance of the result to the original curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">412</span>: 	   - direction : int          : 1 or -1, to choose the offset direction</pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>: 	   - scores    : double[N]    : Scores associated to the original curve, or None.</pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>: 	&lt;--------------- double[2, M] : Dilated curve. The number of points may not be the same, as self-intersecting parts are removed</pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: 	&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the dilated curve, with the same parts cut out</pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: 	# FIRST STEP : Offset the curve along its orthogonal vectors</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>: 	cdef double* dilated = &lt;double*&gt; malloc(curve.shape[0] * curve.shape[1] * sizeof(double))</pre>
<pre class='cython code score-0 '>  __pyx_v_dilated = ((double *)malloc((((__pyx_v_curve.shape[0]) * (__pyx_v_curve.shape[1])) * (sizeof(double)))));
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>: 	cdef double[:, :] dilated_view = &lt;double[:curve.shape[0], :curve.shape[1]:1]&gt; dilated</pre>
<pre class='cython code score-11 '>  if (!__pyx_v_dilated) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
    <span class='error_goto'>__PYX_ERR(0, 419, __pyx_L1_error)</span>
  }
  __pyx_t_3 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_curve.shape[0])), ((Py_ssize_t)(__pyx_v_curve.shape[1])));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = __pyx_array_new(__pyx_t_2, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_3), (char *) "c", (char *) __pyx_v_dilated);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(((PyObject *)__pyx_t_1), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 419, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_dilated_view = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">420</span>: 	cdef double[2] gradient</pre>
<pre class="cython line score-0">&#xA0;<span class="">421</span>: 	cdef double gradient_norm</pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: 	cdef Py_ssize_t i</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>: 	for i in range(curve.shape[1]):</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0">&#xA0;<span class="">424</span>: 		# Calculate the gradient with [-1, 0, 1] when possible, otherwise just the outgoing or incoming vectors</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">425</span>: 		if i == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (__pyx_v_i == 0);
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>: 			gradient[0] = curve[0, i+1] - curve[0, i]</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = 0;
      __pyx_t_10 = (__pyx_v_i + 1);
      __pyx_t_11 = 0;
      __pyx_t_12 = __pyx_v_i;
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>: 			gradient[1] = curve[1, i+1] - curve[1, i]</pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = (__pyx_v_i + 1);
      __pyx_t_10 = 1;
      __pyx_t_9 = __pyx_v_i;
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">428</span>: 		elif i == curve.shape[1] - 1:</pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (__pyx_v_i == ((__pyx_v_curve.shape[1]) - 1));
    if (__pyx_t_8) {
/* … */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>: 			gradient[0] = curve[0, i] - curve[0, i-1]</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = 0;
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = 0;
      __pyx_t_12 = (__pyx_v_i - 1);
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>: 			gradient[1] = curve[1, i] - curve[1, i-1]</pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = 1;
      __pyx_t_9 = (__pyx_v_i - 1);
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>: 		else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">432</span>: 			gradient[0] = curve[0, i+1] - curve[0, i-1]</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_9 = 0;
      __pyx_t_10 = (__pyx_v_i + 1);
      __pyx_t_11 = 0;
      __pyx_t_12 = (__pyx_v_i - 1);
      (__pyx_v_gradient[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_12 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">433</span>: 			gradient[1] = curve[1, i+1] - curve[1, i-1]</pre>
<pre class='cython code score-0 '>      __pyx_t_12 = 1;
      __pyx_t_11 = (__pyx_v_i + 1);
      __pyx_t_10 = 1;
      __pyx_t_9 = (__pyx_v_i - 1);
      (__pyx_v_gradient[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_12 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))));
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>: 		gradient_norm = sqrt(gradient[0]*gradient[0] + gradient[1]*gradient[1])</pre>
<pre class='cython code score-0 '>    __pyx_v_gradient_norm = sqrt((((__pyx_v_gradient[0]) * (__pyx_v_gradient[0])) + ((__pyx_v_gradient[1]) * (__pyx_v_gradient[1]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">435</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">436</span>: 		# Offset by `dilation` in the direction orthogonal to the gradient, with direction to possibly reverse the orthogonal vectors</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">437</span>: 		dilated_view[0, i] = curve[0, i] - direction*gradient[1] * dilation / gradient_norm</pre>
<pre class='cython code score-5 '>    __pyx_t_9 = 0;
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_13 = ((__pyx_v_direction * (__pyx_v_gradient[1])) * __pyx_v_dilation);
    if (unlikely(__pyx_v_gradient_norm == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 437, __pyx_L1_error)</span>
    }
    __pyx_t_11 = 0;
    __pyx_t_12 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_dilated_view.data + __pyx_t_11 * __pyx_v_dilated_view.strides[0]) ) + __pyx_t_12 * __pyx_v_dilated_view.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (__pyx_t_13 / __pyx_v_gradient_norm));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>: 		dilated_view[1, i] = curve[1, i] + direction*gradient[0] * dilation / gradient_norm</pre>
<pre class='cython code score-5 '>    __pyx_t_10 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_13 = ((__pyx_v_direction * (__pyx_v_gradient[0])) * __pyx_v_dilation);
    if (unlikely(__pyx_v_gradient_norm == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
    }
    __pyx_t_12 = 1;
    __pyx_t_11 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_dilated_view.data + __pyx_t_12 * __pyx_v_dilated_view.strides[0]) ) + __pyx_t_11 * __pyx_v_dilated_view.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) + (__pyx_t_13 / __pyx_v_gradient_norm));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">439</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">440</span>: 	# SECOND STEP : Remove self-intersections with the mask computed by `find_self_intersects`</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>: 	cdef bint* mask = &lt;bint*&gt;malloc(curve.shape[1] * sizeof(bint))</pre>
<pre class='cython code score-0 '>  __pyx_v_mask = ((int *)malloc(((__pyx_v_curve.shape[1]) * (sizeof(int)))));
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>: 	cdef bint[::1] mask_view = &lt;bint[:curve.shape[1]:1]&gt; mask</pre>
<pre class='cython code score-11 '>  if (!__pyx_v_mask) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ValueError,"Cannot create cython.array from NULL pointer");
    <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  }
  __pyx_t_2 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_bint);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)(__pyx_v_curve.shape[1])));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = __pyx_array_new(__pyx_t_3, sizeof(int), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_2), (char *) "fortran", (char *) __pyx_v_mask);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dc_bint</span>(((PyObject *)__pyx_t_1), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mask_view = __pyx_t_14;
  __pyx_t_14.memview = NULL;
  __pyx_t_14.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">443</span>: 	find_self_intersects(dilated_view, mask_view)</pre>
<pre class='cython code score-0 '>  __pyx_f_11trajeometry_find_self_intersects(__pyx_v_dilated_view, __pyx_v_mask_view, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 443, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">444</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">445</span>: 	cdef Py_ssize_t result_size = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_result_size = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">446</span>: 	for i in range(curve.shape[1]):</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">447</span>: 		if mask[i]:</pre>
<pre class='cython code score-0 '>    if ((__pyx_v_mask[__pyx_v_i])) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">448</span>: 			result_size += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_result_size = (__pyx_v_result_size + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">449</span>: </pre>
<pre class="cython line score-35" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>: 	result = np.empty((2, result_size))</pre>
<pre class='cython code score-35 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_result_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_int_2)) <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_17 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
      __pyx_t_17 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_16};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_15, __pyx_callargs+1-__pyx_t_17, 1+__pyx_t_17);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  }
  __pyx_v_result = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>: 	cdef double[:, :] result_view = result</pre>
<pre class='cython code score-2 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_4.memview)) __PYX_ERR(0, 451, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_4;
  __pyx_t_4.memview = NULL;
  __pyx_t_4.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">452</span>: 	cdef Py_ssize_t result_index = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_result_index = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>: 	for i in range(curve.shape[1]):</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_curve.shape[1]);
  __pyx_t_6 = __pyx_t_5;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">454</span>: 		if mask[i]:</pre>
<pre class='cython code score-0 '>    if ((__pyx_v_mask[__pyx_v_i])) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>: 			result_view[:, result_index] = dilated_view[:, i]</pre>
<pre class='cython code score-0 '>      __pyx_t_18.data = __pyx_v_dilated_view.data;
      __pyx_t_18.memview = __pyx_v_dilated_view.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_18, 1);
      __pyx_t_18.shape[0] = __pyx_v_dilated_view.shape[0];
__pyx_t_18.strides[0] = __pyx_v_dilated_view.strides[0];
    __pyx_t_18.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_dilated_view.strides[1];
        __pyx_t_18.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_19.data = __pyx_v_result_view.data;
      __pyx_t_19.memview = __pyx_v_result_view.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_19, 1);
      __pyx_t_19.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_19.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_19.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = __pyx_v_result_index;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_19.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely((__pyx_memoryview_copy_contents(__pyx_t_18, __pyx_t_19, 1, 1, 0) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 455, __pyx_L1_error)</span>
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_19, 1);
      __pyx_t_19.memview = NULL; __pyx_t_19.data = NULL;
      __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_18, 1);
      __pyx_t_18.memview = NULL; __pyx_t_18.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">456</span>: 			result_index += 1</pre>
<pre class='cython code score-0 '>      __pyx_v_result_index = (__pyx_v_result_index + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">457</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">458</span>: 	# Compute the associated scores if necessary</pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>: 	cdef double[:] result_scores_view</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">460</span>: 	if scores is not None:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (((PyObject *) __pyx_v_scores.memview) != Py_None);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">461</span>: 		result_scores = np.empty(result_size)</pre>
<pre class='cython code score-25 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_15, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_result_size);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 461, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_3 = NULL;
    __pyx_t_17 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
        __pyx_t_17 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_15};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_16, __pyx_callargs+1-__pyx_t_17, 1+__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 461, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    }
    __pyx_v_result_scores = __pyx_t_2;
    __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">462</span>: 		result_scores_view = result_scores</pre>
<pre class='cython code score-2 '>    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_result_scores, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 462, __pyx_L1_error)</span>
    __pyx_v_result_scores_view = __pyx_t_18;
    __pyx_t_18.memview = NULL;
    __pyx_t_18.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">463</span>: 		result_index = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_result_index = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>: 		for i in range(curve.shape[1]):</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (__pyx_v_curve.shape[1]);
    __pyx_t_6 = __pyx_t_5;
    for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
      __pyx_v_i = __pyx_t_7;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>: 			if mask[i]:</pre>
<pre class='cython code score-0 '>      if ((__pyx_v_mask[__pyx_v_i])) {
/* … */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">466</span>: 				result_scores_view[result_index] = scores[i]</pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_result_index;
        *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_10 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_9 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>: 				result_index += 1</pre>
<pre class='cython code score-0 '>        __pyx_v_result_index = (__pyx_v_result_index + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">468</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">469</span>: 	free(dilated)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_dilated);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">470</span>: 	free(mask)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_mask);
</pre><pre class="cython line score-0">&#xA0;<span class="">471</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">472</span>: 	if scores is not None:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (((PyObject *) __pyx_v_scores.memview) != Py_None);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">473</span>: 		return result, result_scores</pre>
<pre class='cython code score-14 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    if (unlikely(!__pyx_v_result_scores)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundLocalError</span>("result_scores"); <span class='error_goto'>__PYX_ERR(0, 473, __pyx_L1_error)</span> }
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 473, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_result)) <span class='error_goto'>__PYX_ERR(0, 473, __pyx_L1_error)</span>;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result_scores);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result_scores);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_result_scores)) <span class='error_goto'>__PYX_ERR(0, 473, __pyx_L1_error)</span>;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">474</span>: 	else:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">475</span>: 		return result</pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    __pyx_r = __pyx_v_result;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">476</span>: </pre>
<pre class="cython line score-134" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">477</span>: def strip_angles(double[:, :] curve, double max_angle, double[:] scores=None):</pre>
<pre class='cython code score-134 '>static PyObject *__pyx_pf_11trajeometry_36__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_memoryview_fromslice(<span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_self)-&gt;__pyx_arg_scores, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='refnanny'>__Pyx_GIVEREF</span>(Py_None);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_1, 1, Py_None)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>;
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_25strip_angles(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_24strip_angles, "Cut out the points that make too sharp angles in the curve\n\t   - curve     : double[2, N] : Discrete curve to process\n\t   - max_angle : double       : Cut angles that are sharper than this (so, lower angle value), in radians\n\t   - scores    : double[N]    : Scores associated to each point of the curve, or None\n\t&lt;--------------- double[2, M] : Curve with sharp angles deleted\n\t&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the resulting curve, with the same points cut out\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_25strip_angles = {"strip_angles", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_25strip_angles, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_24strip_angles};
static PyObject *__pyx_pw_11trajeometry_25strip_angles(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_max_angle;
  __Pyx_memviewslice __pyx_v_scores = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("strip_angles (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_max_angle,&amp;__pyx_n_s_scores,0};
  PyObject* values[3] = {0,0,0};
    __pyx_defaults1 *__pyx_dynamic_args = <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_self);
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_max_angle)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("strip_angles", 0, 2, 3, 1); <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scores);
          if (value) { values[2] = <span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(value); kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "strip_angles") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 477, __pyx_L3_error)</span>
    __pyx_v_max_angle = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]); if (unlikely((__pyx_v_max_angle == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_scores = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_scores.memview)) __PYX_ERR(0, 477, __pyx_L3_error)</span>
    } else {
      __pyx_v_scores = __pyx_dynamic_args-&gt;__pyx_arg_scores;
      __PYX_INC_MEMVIEW(&amp;__pyx_v_scores, 1);
    }
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("strip_angles", 0, 2, 3, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.strip_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_24strip_angles(__pyx_self, __pyx_v_curve, __pyx_v_max_angle, __pyx_v_scores);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_scores, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_24strip_angles(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, double __pyx_v_max_angle, __Pyx_memviewslice __pyx_v_scores) {
  std::vector&lt;Py_ssize_t&gt;  __pyx_v_valid_indices;
  Py_ssize_t __pyx_v_i;
  double __pyx_v_angle;
  double __pyx_v_left_vector[2];
  double __pyx_v_right_vector[2];
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  size_t __pyx_v_result_index;
  __Pyx_memviewslice __pyx_v_result_scores_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result_scores = NULL;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_18, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.strip_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_view, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_scores_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result_scores);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__51 = <span class='py_c_api'>PyTuple_Pack</span>(15, __pyx_n_s_curve, __pyx_n_s_max_angle, __pyx_n_s_scores, __pyx_n_s_valid_indices, __pyx_n_s_i, __pyx_n_s_left_norm, __pyx_n_s_right_norm, __pyx_n_s_angle, __pyx_n_s_left_vector, __pyx_n_s_right_vector, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_result_index, __pyx_n_s_result_scores_view, __pyx_n_s_result_scores);<span class='error_goto'> if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__51);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__51);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_25strip_angles, 0, __pyx_n_s_strip_angles, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__52));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (!<span class='pyx_c_api'>__Pyx_CyFunction_InitDefaults</span>(__pyx_t_4, sizeof(__pyx_defaults1), 0)) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(Py_None, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='pyx_c_api'>__Pyx_CyFunction_Defaults</span>(__pyx_defaults1, __pyx_t_4)-&gt;__pyx_arg_scores = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsGetter</span>(__pyx_t_4, __pyx_pf_11trajeometry_36__defaults__);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_strip_angles, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 477, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__52 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__51, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_strip_angles, 477, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__52)) __PYX_ERR(0, 477, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">478</span>: 	"""Cut out the points that make too sharp angles in the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">479</span>: 	   - curve     : double[2, N] : Discrete curve to process</pre>
<pre class="cython line score-0">&#xA0;<span class="">480</span>: 	   - max_angle : double       : Cut angles that are sharper than this (so, lower angle value), in radians</pre>
<pre class="cython line score-0">&#xA0;<span class="">481</span>: 	   - scores    : double[N]    : Scores associated to each point of the curve, or None</pre>
<pre class="cython line score-0">&#xA0;<span class="">482</span>: 	&lt;--------------- double[2, M] : Curve with sharp angles deleted</pre>
<pre class="cython line score-0">&#xA0;<span class="">483</span>: 	&lt;--------------- double[M]    : ONLY IF `scores` is not None, scores associated to each point of the resulting curve, with the same points cut out</pre>
<pre class="cython line score-0">&#xA0;<span class="">484</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: 	cdef vector[Py_ssize_t] valid_indices</pre>
<pre class="cython line score-0">&#xA0;<span class="">486</span>: 	cdef Py_ssize_t i</pre>
<pre class="cython line score-0">&#xA0;<span class="">487</span>: 	cdef double left_norm, right_norm, angle</pre>
<pre class="cython line score-0">&#xA0;<span class="">488</span>: 	cdef double[2] left_vector, right_vector</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">489</span>: 	for i in range(1, curve.shape[1]-1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 1; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">490</span>: 		# Compute the angle between the outgoing vectors</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">491</span>: 		left_vector[0] = curve[0, i-1] - curve[0, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i - 1);
    __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_v_i;
    (__pyx_v_left_vector[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">492</span>: 		left_vector[1] = curve[1, i-1] - curve[1, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i - 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    (__pyx_v_left_vector[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">493</span>: 		right_vector[0] = curve[0, i+1] - curve[0, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = (__pyx_v_i + 1);
    __pyx_t_6 = 0;
    __pyx_t_7 = __pyx_v_i;
    (__pyx_v_right_vector[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>: 		right_vector[1] = curve[1, i+1] - curve[1, i]</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i + 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    (__pyx_v_right_vector[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">495</span>: 		angle = vector_angle(left_vector, right_vector)</pre>
<pre class='cython code score-17 '>    __pyx_t_10 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_9 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_8 = __pyx_array_new(__pyx_t_9, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_10), (char *) "fortran", (char *) __pyx_v_left_vector);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_8), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_9 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_8 = __pyx_array_new(__pyx_t_10, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_9), (char *) "fortran", (char *) __pyx_v_right_vector);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_8), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_13 = __pyx_f_11trajeometry_vector_angle(__pyx_t_11, __pyx_t_12, 0); if (unlikely(__pyx_t_13 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 495, __pyx_L1_error)</span>
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
    __pyx_v_angle = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">496</span>: 		if angle &gt; max_angle:</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = (__pyx_v_angle &gt; __pyx_v_max_angle);
    if (__pyx_t_14) {
/* … */
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">497</span>: 			valid_indices.push_back(i)</pre>
<pre class='cython code score-0 '>      try {
        __pyx_v_valid_indices.push_back(__pyx_v_i);
      } catch(...) {
        __Pyx_CppExn2PyErr();
        <span class='error_goto'>__PYX_ERR(0, 497, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">498</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>: 	# Copy the resulting point to a fixed numpy array</pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>: 	# Don’t forget to include the initial and final points</pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>: 	result = np.empty((2, valid_indices.size() + 2))</pre>
<pre class='cython code score-32 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>((__pyx_v_valid_indices.size() + 2));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_16 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_16, 0, __pyx_int_2)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_16, 1, __pyx_t_10)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>;
  __pyx_t_10 = 0;
  __pyx_t_10 = NULL;
  __pyx_t_17 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
    __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
    if (likely(__pyx_t_10)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
      __pyx_t_17 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_16};
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_15, __pyx_callargs+1-__pyx_t_17, 1+__pyx_t_17);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  }
  __pyx_v_result = __pyx_t_9;
  __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">502</span>: 	cdef double[:, :] result_view = result</pre>
<pre class='cython code score-2 '>  __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 502, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_18;
  __pyx_t_18.memview = NULL;
  __pyx_t_18.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">503</span>: 	result_view[:, 0] = curve[:, 0]</pre>
<pre class='cython code score-0 '>  __pyx_t_12.data = __pyx_v_curve.data;
  __pyx_t_12.memview = __pyx_v_curve.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
  __pyx_t_11.memview = __pyx_v_result_view.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely((__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 503, __pyx_L1_error)</span>
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">504</span>: 	result_view[:, valid_indices.size()+1] = curve[:, curve.shape[1]-1]</pre>
<pre class='cython code score-0 '>  __pyx_t_12.data = __pyx_v_curve.data;
  __pyx_t_12.memview = __pyx_v_curve.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = ((__pyx_v_curve.shape[1]) - 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
  __pyx_t_11.memview = __pyx_v_result_view.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_valid_indices.size() + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely((__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 504, __pyx_L1_error)</span>
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
  __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
  __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">505</span>: 	cdef size_t result_index</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">506</span>: 	for result_index in range(valid_indices.size()):</pre>
<pre class='cython code score-0 '>  __pyx_t_19 = __pyx_v_valid_indices.size();
  __pyx_t_20 = __pyx_t_19;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
    __pyx_v_result_index = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">507</span>: 		result_view[:, result_index+1] = curve[:, valid_indices[result_index]]</pre>
<pre class='cython code score-0 '>    __pyx_t_12.data = __pyx_v_curve.data;
    __pyx_t_12.memview = __pyx_v_curve.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.shape[0] = __pyx_v_curve.shape[0];
__pyx_t_12.strides[0] = __pyx_v_curve.strides[0];
    __pyx_t_12.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_valid_indices[__pyx_v_result_index]);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_curve.strides[1];
        __pyx_t_12.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_11.data = __pyx_v_result_view.data;
    __pyx_t_11.memview = __pyx_v_result_view.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.shape[0] = __pyx_v_result_view.shape[0];
__pyx_t_11.strides[0] = __pyx_v_result_view.strides[0];
    __pyx_t_11.suboffsets[0] = -1;

{
    Py_ssize_t __pyx_tmp_idx = (__pyx_v_result_index + 1);
    Py_ssize_t __pyx_tmp_stride = __pyx_v_result_view.strides[1];
        __pyx_t_11.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

if (unlikely((__pyx_memoryview_copy_contents(__pyx_t_12, __pyx_t_11, 1, 1, 0) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 507, __pyx_L1_error)</span>
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_11, 1);
    __pyx_t_11.memview = NULL; __pyx_t_11.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_12, 1);
    __pyx_t_12.memview = NULL; __pyx_t_12.data = NULL;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">508</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>: 	# If necessary, also filter the scores</pre>
<pre class="cython line score-0">&#xA0;<span class="">510</span>: 	cdef double[:] result_scores_view</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">511</span>: 	if scores is not None:</pre>
<pre class='cython code score-0 '>  __pyx_t_14 = (((PyObject *) __pyx_v_scores.memview) != Py_None);
  if (__pyx_t_14) {
/* … */
  }
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">512</span>: 		result_scores = np.empty(valid_indices.size() + 2)</pre>
<pre class='cython code score-22 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_15, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_15, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>((__pyx_v_valid_indices.size() + 2));<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 512, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_10 = NULL;
    __pyx_t_17 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_16))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_16);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_16, function);
        __pyx_t_17 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_15};
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_16, __pyx_callargs+1-__pyx_t_17, 1+__pyx_t_17);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
      if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 512, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    }
    __pyx_v_result_scores = __pyx_t_9;
    __pyx_t_9 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">513</span>: 		result_scores_view = result_scores</pre>
<pre class='cython code score-2 '>    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_result_scores, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 513, __pyx_L1_error)</span>
    __pyx_v_result_scores_view = __pyx_t_12;
    __pyx_t_12.memview = NULL;
    __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">514</span>: 		result_scores_view[0] = scores[0]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_5 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">515</span>: 		result_scores_view[valid_indices.size()+1] = scores[scores.shape[0]-1]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_v_scores.shape[0]) - 1);
    __pyx_t_19 = (__pyx_v_valid_indices.size() + 1);
    *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_19 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">516</span>: 		for result_index in range(valid_indices.size()):</pre>
<pre class='cython code score-0 '>    __pyx_t_19 = __pyx_v_valid_indices.size();
    __pyx_t_20 = __pyx_t_19;
    for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
      __pyx_v_result_index = __pyx_t_21;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">517</span>: 			result_scores_view[result_index+1] = scores[valid_indices[result_index]]</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = (__pyx_v_valid_indices[__pyx_v_result_index]);
      __pyx_t_22 = (__pyx_v_result_index + 1);
      *((double *) ( /* dim=0 */ (__pyx_v_result_scores_view.data + __pyx_t_22 * __pyx_v_result_scores_view.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_scores.data + __pyx_t_4 * __pyx_v_scores.strides[0]) )));
    }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">518</span>: 		return result, result_scores</pre>
<pre class='cython code score-12 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 518, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_v_result)) <span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result_scores);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_result_scores);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_v_result_scores)) <span class='error_goto'>__PYX_ERR(0, 518, __pyx_L1_error)</span>;
    __pyx_r = __pyx_t_9;
    __pyx_t_9 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">519</span>: 	else:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">520</span>: 		return result</pre>
<pre class='cython code score-2 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
    __pyx_r = __pyx_v_result;
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">521</span>: </pre>
<pre class="cython line score-89" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">522</span>: cpdef int savgol_window(int base_size, int array_size):</pre>
<pre class='cython code score-89 '>static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static int __pyx_f_11trajeometry_savgol_window(int __pyx_v_base_size, int __pyx_v_array_size, CYTHON_UNUSED int __pyx_skip_dispatch) {
  int __pyx_r;
/* … */
  /* function exit code */
  __pyx_L0:;
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_26savgol_window, "Compute the best window size of the Savitzky-Golay filter for the given array size\n\t   - base_size  : int : Initial target window size\n\t   - array_size : int : Array size the filter has to be applied to\n\t&lt;---------------- int : Optimal window size for the array (odd value, &lt; array_size)");
static PyMethodDef __pyx_mdef_11trajeometry_27savgol_window = {"savgol_window", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_27savgol_window, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_26savgol_window};
static PyObject *__pyx_pw_11trajeometry_27savgol_window(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  int __pyx_v_base_size;
  int __pyx_v_array_size;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_window (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_base_size,&amp;__pyx_n_s_array_size,0};
  PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_base_size)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_array_size)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_window", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "savgol_window") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_base_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[0]); if (unlikely((__pyx_v_base_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
    __pyx_v_array_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_array_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_window", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_window", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_26savgol_window(__pyx_self, __pyx_v_base_size, __pyx_v_array_size);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_26savgol_window(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_base_size, int __pyx_v_array_size) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_savgol_window(__pyx_v_base_size, __pyx_v_array_size, 0); if (unlikely(__pyx_t_1 == ((int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_window", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__53 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_base_size, __pyx_n_s_array_size);<span class='error_goto'> if (unlikely(!__pyx_tuple__53)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__53);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__53);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_27savgol_window, 0, __pyx_n_s_savgol_window, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__54));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_savgol_window, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 522, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__54 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__53, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_savgol_window, 522, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__54)) __PYX_ERR(0, 522, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">523</span>: 	"""Compute the best window size of the Savitzky-Golay filter for the given array size</pre>
<pre class="cython line score-0">&#xA0;<span class="">524</span>: 	   - base_size  : int : Initial target window size</pre>
<pre class="cython line score-0">&#xA0;<span class="">525</span>: 	   - array_size : int : Array size the filter has to be applied to</pre>
<pre class="cython line score-0">&#xA0;<span class="">526</span>: 	&lt;---------------- int : Optimal window size for the array (odd value, &lt; array_size)"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">527</span>: 	if base_size &lt; array_size:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_base_size &lt; __pyx_v_array_size);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">528</span>: 		return base_size - (1 - base_size % 2)  # Make it odd</pre>
<pre class='cython code score-0 '>    __pyx_r = (__pyx_v_base_size - (1 - __Pyx_mod_long(__pyx_v_base_size, 2)));
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">529</span>: 	else:  # Array size smaller than the window size : use the array size as window size</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">530</span>: 		return array_size - (1 - array_size % 2)</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_r = (__pyx_v_array_size - (1 - __Pyx_mod_long(__pyx_v_array_size, 2)));
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">531</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">532</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">533</span>: cdef void _savgol_coeffs_degree23(double[:] coeffs, int window_size):</pre>
<pre class='cython code score-2 '>static void __pyx_f_11trajeometry__savgol_coeffs_degree23(__Pyx_memviewslice __pyx_v_coeffs, int __pyx_v_window_size) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_i_first;
  Py_ssize_t __pyx_v_i_last;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry._savgol_coeffs_degree23", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">534</span>: 	"""Compute the Savitzky-Golay filter coefficients for the given `window_size` and polynomial degree 2 or 3,</pre>
<pre class="cython line score-0">&#xA0;<span class="">535</span>: 	   and put them in `coeffs`. There are `window_size` coefficients"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>: 	cdef Py_ssize_t i, i_first = (1 - window_size) // 2, i_last = (window_size - 1) // 2</pre>
<pre class='cython code score-0 '>  __pyx_v_i_first = __Pyx_div_long((1 - __pyx_v_window_size), 2);
  __pyx_v_i_last = __Pyx_div_long((__pyx_v_window_size - 1), 2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">537</span>: 	for i in range(i_first, i_last + 1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_i_last + 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = __pyx_v_i_first; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">538</span>: 		coeffs[i - i_first] = ((3 * window_size*window_size - 7 - 20 * i*i) / 4) / (window_size * (window_size**2 - 4) / 3)</pre>
<pre class='cython code score-5 '>    __pyx_t_4 = (((double)((((3 * __pyx_v_window_size) * __pyx_v_window_size) - 7) - ((20 * __pyx_v_i) * __pyx_v_i))) / 4.0);
    __pyx_t_5 = (((double)(__pyx_v_window_size * (__Pyx_pow_long(((long)__pyx_v_window_size), 2) - 4))) / 3.0);
    if (unlikely(__pyx_t_5 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 538, __pyx_L1_error)</span>
    }
    __pyx_t_6 = (__pyx_v_i - __pyx_v_i_first);
    *((double *) ( /* dim=0 */ (__pyx_v_coeffs.data + __pyx_t_6 * __pyx_v_coeffs.strides[0]) )) = (__pyx_t_4 / __pyx_t_5);
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">539</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">540</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">541</span>: # Cache for reused Savitzky-Golay coefficients</pre>
<pre class="cython line score-0">&#xA0;<span class="">542</span>: # TODO : Use a C++ map</pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>: cdef dict _savgol_coeffs_cache = {}</pre>
<pre class='cython code score-3 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_v_11trajeometry__savgol_coeffs_cache);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, ((PyObject*)__pyx_t_4));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">544</span>: </pre>
<pre class="cython line score-104" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>: def savgol_filter(double[:, :] curve, int window_size, int savgol_degree):</pre>
<pre class='cython code score-104 '>/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_29savgol_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_28savgol_filter, "Apply a Savitzky-Golay filter on the given curve samples\n\t   - curve         : double[2, N] : Numerical curve to smooth\n\t   - window_size   : int          : Filter window size, must be odd and greater than `savgol_degree`\n\t   - savgol_degree : int          : Polynomial degree of the filter. Currently only support 2 and 3\n\t&lt;------------------- double[2, N] : Filtered curve samples\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_29savgol_filter = {"savgol_filter", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_29savgol_filter, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_28savgol_filter};
static PyObject *__pyx_pw_11trajeometry_29savgol_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_window_size;
  int __pyx_v_savgol_degree;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("savgol_filter (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,&amp;__pyx_n_s_window_size,&amp;__pyx_n_s_savgol_degree,0};
  PyObject* values[3] = {0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_size)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_savgol_degree)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[2]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "savgol_filter") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 545, __pyx_L3_error)</span>
    __pyx_v_window_size = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_window_size == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
    __pyx_v_savgol_degree = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_savgol_degree == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("savgol_filter", 1, 3, 3, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_28savgol_filter(__pyx_self, __pyx_v_curve, __pyx_v_window_size, __pyx_v_savgol_degree);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_28savgol_filter(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve, int __pyx_v_window_size, int __pyx_v_savgol_degree) {
  PyObject *__pyx_v_coeffs = NULL;
  Py_ssize_t __pyx_v_row;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_x;
  Py_ssize_t __pyx_v_npoints;
  Py_ssize_t __pyx_v_nrows;
  Py_ssize_t __pyx_v_i_first;
  Py_ssize_t __pyx_v_conv_index;
  __Pyx_memviewslice __pyx_v_coeffs_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_v_result = NULL;
  __Pyx_memviewslice __pyx_v_result_view = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_start_vector;
  double __pyx_v_end_vector;
  double __pyx_v_conv_value;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_10, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_coeffs);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_coeffs_view, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_result);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_result_view, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__55 = <span class='py_c_api'>PyTuple_Pack</span>(18, __pyx_n_s_curve, __pyx_n_s_window_size, __pyx_n_s_savgol_degree, __pyx_n_s_coeffs, __pyx_n_s_row, __pyx_n_s_i, __pyx_n_s_x, __pyx_n_s_npoints, __pyx_n_s_nrows, __pyx_n_s_i_first, __pyx_n_s_conv_index, __pyx_n_s_conv_x, __pyx_n_s_coeffs_view, __pyx_n_s_result, __pyx_n_s_result_view, __pyx_n_s_start_vector, __pyx_n_s_end_vector, __pyx_n_s_conv_value);<span class='error_goto'> if (unlikely(!__pyx_tuple__55)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__55);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__55);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_29savgol_filter, 0, __pyx_n_s_savgol_filter, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__56));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_savgol_filter, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 545, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__56 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__55, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_savgol_filter, 545, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__56)) __PYX_ERR(0, 545, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">546</span>: 	"""Apply a Savitzky-Golay filter on the given curve samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">547</span>: 	   - curve         : double[2, N] : Numerical curve to smooth</pre>
<pre class="cython line score-0">&#xA0;<span class="">548</span>: 	   - window_size   : int          : Filter window size, must be odd and greater than `savgol_degree`</pre>
<pre class="cython line score-0">&#xA0;<span class="">549</span>: 	   - savgol_degree : int          : Polynomial degree of the filter. Currently only support 2 and 3</pre>
<pre class="cython line score-0">&#xA0;<span class="">550</span>: 	&lt;------------------- double[2, N] : Filtered curve samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">551</span>: 	"""</pre>
<pre class="cython line score-0">&#xA0;<span class="">552</span>: 	# Check the assumptions of this implementation</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">553</span>: 	assert savgol_degree in (2, 3)</pre>
<pre class='cython code score-2 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(__pyx_assertions_enabled())) {
    switch (__pyx_v_savgol_degree) {
      case 2:
      case 3:
      __pyx_t_1 = 1;
      break;
      default:
      __pyx_t_1 = 0;
      break;
    }
    __pyx_t_2 = __pyx_t_1;
    if (unlikely(!__pyx_t_2)) {
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_builtin_AssertionError, 0, 0, 0);
      <span class='error_goto'>__PYX_ERR(0, 553, __pyx_L1_error)</span>
    }
  }
  #else
  if ((1)); else <span class='error_goto'>__PYX_ERR(0, 553, __pyx_L1_error)</span>
  #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">554</span>: 	assert window_size % 2 == 1</pre>
<pre class='cython code score-2 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(__pyx_assertions_enabled())) {
    __pyx_t_2 = (__Pyx_mod_long(__pyx_v_window_size, 2) == 1);
    if (unlikely(!__pyx_t_2)) {
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_builtin_AssertionError, 0, 0, 0);
      <span class='error_goto'>__PYX_ERR(0, 554, __pyx_L1_error)</span>
    }
  }
  #else
  if ((1)); else <span class='error_goto'>__PYX_ERR(0, 554, __pyx_L1_error)</span>
  #endif
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">555</span>: 	assert window_size &lt;= curve.shape[1] and window_size &gt; savgol_degree</pre>
<pre class='cython code score-2 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(__pyx_assertions_enabled())) {
    __pyx_t_1 = (__pyx_v_window_size &lt;= (__pyx_v_curve.shape[1]));
    if (__pyx_t_1) {
    } else {
      __pyx_t_2 = __pyx_t_1;
      goto __pyx_L3_bool_binop_done;
    }
    __pyx_t_1 = (__pyx_v_window_size &gt; __pyx_v_savgol_degree);
    __pyx_t_2 = __pyx_t_1;
    __pyx_L3_bool_binop_done:;
    if (unlikely(!__pyx_t_2)) {
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_builtin_AssertionError, 0, 0, 0);
      <span class='error_goto'>__PYX_ERR(0, 555, __pyx_L1_error)</span>
    }
  }
  #else
  if ((1)); else <span class='error_goto'>__PYX_ERR(0, 555, __pyx_L1_error)</span>
  #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">556</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">557</span>: 	# Compute the convolution coefficients, or get them from the cache</pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">558</span>: 	if (window_size, savgol_degree) in _savgol_coeffs_cache:</pre>
<pre class='cython code score-21 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not iterable");
    <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>
  }
  __pyx_t_2 = (<span class='pyx_c_api'>__Pyx_PyDict_ContainsTF</span>(__pyx_t_5, __pyx_v_11trajeometry__savgol_coeffs_cache, Py_EQ)); if (unlikely((__pyx_t_2 &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 558, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_2) {
/* … */
    goto __pyx_L5;
  }
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>: 		coeffs = _savgol_coeffs_cache[(window_size, savgol_degree)]</pre>
<pre class='cython code score-21 '>    if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>
    }
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 559, __pyx_L1_error)</span>;
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_GetItem</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_coeffs = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">560</span>: 	else:</pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>: 		coeffs = np.empty(window_size)</pre>
<pre class='cython code score-22 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_3};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_v_coeffs = __pyx_t_4;
    __pyx_t_4 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">562</span>: 		_savgol_coeffs_degree23(coeffs, window_size)</pre>
<pre class='cython code score-2 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_coeffs, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 562, __pyx_L1_error)</span>
    __pyx_f_11trajeometry__savgol_coeffs_degree23(__pyx_t_8, __pyx_v_window_size);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 562, __pyx_L1_error)</span>
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
    __pyx_t_8.memview = NULL; __pyx_t_8.data = NULL;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">563</span>: 		_savgol_coeffs_cache[(window_size, savgol_degree)] = coeffs</pre>
<pre class='cython code score-24 '>    if (unlikely(__pyx_v_11trajeometry__savgol_coeffs_cache == Py_None)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "'NoneType' object is not subscriptable");
      <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>
    }
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_window_size);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_savgol_degree);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4)) <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>;
    __pyx_t_4 = 0;
    __pyx_t_5 = 0;
    if (unlikely((<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_11trajeometry__savgol_coeffs_cache, __pyx_t_3, __pyx_v_coeffs) &lt; 0))) <span class='error_goto'>__PYX_ERR(0, 563, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_L5:;
</pre><pre class="cython line score-0">&#xA0;<span class="">564</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">565</span>: 	# Now apply a simple convolution to the curve</pre>
<pre class="cython line score-0">&#xA0;<span class="">566</span>: 	# To avoid squishing the extreme points, we extrapolate the curve using its extreme vectors</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">567</span>: 	cdef Py_ssize_t row, i, x, npoints = curve.shape[1], nrows = curve.shape[0], i_first = (1 - window_size) // 2, conv_index</pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_curve.shape[1]);
  __pyx_v_nrows = (__pyx_v_curve.shape[0]);
  __pyx_v_i_first = __Pyx_div_long((1 - __pyx_v_window_size), 2);
</pre><pre class="cython line score-0">&#xA0;<span class="">568</span>: 	cdef double conv_x</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">569</span>: 	cdef double[:] coeffs_view = coeffs</pre>
<pre class='cython code score-2 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_v_coeffs, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 569, __pyx_L1_error)</span>
  __pyx_v_coeffs_view = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class="cython line score-39" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">570</span>: 	result = np.zeros((curve.shape[0], curve.shape[1]))</pre>
<pre class='cython code score-39 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_curve.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_curve.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 570, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 570, __pyx_L1_error)</span>;
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  if (<span class='pyx_c_api'>__Pyx_PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 570, __pyx_L1_error)</span>;
  __pyx_t_5 = 0;
  __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_9};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 570, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_v_result = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>: 	cdef double[:, :] result_view = result</pre>
<pre class='cython code score-2 '>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_result, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 571, __pyx_L1_error)</span>
  __pyx_v_result_view = __pyx_t_10;
  __pyx_t_10.memview = NULL;
  __pyx_t_10.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">572</span>: 	cdef double start_vector, end_vector, conv_value</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>: 	for row in range(nrows):</pre>
<pre class='cython code score-0 '>  __pyx_t_11 = __pyx_v_nrows;
  __pyx_t_12 = __pyx_t_11;
  for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
    __pyx_v_row = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>: 		start_vector = curve[row, 0] - curve[row, 1]</pre>
<pre class='cython code score-0 '>    __pyx_t_14 = __pyx_v_row;
    __pyx_t_15 = 0;
    __pyx_t_16 = __pyx_v_row;
    __pyx_t_17 = 1;
    __pyx_v_start_vector = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_14 * __pyx_v_curve.strides[0]) ) + __pyx_t_15 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_16 * __pyx_v_curve.strides[0]) ) + __pyx_t_17 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">575</span>: 		end_vector = curve[row, npoints-1] - curve[row, npoints-2]</pre>
<pre class='cython code score-0 '>    __pyx_t_17 = __pyx_v_row;
    __pyx_t_16 = (__pyx_v_npoints - 1);
    __pyx_t_15 = __pyx_v_row;
    __pyx_t_14 = (__pyx_v_npoints - 2);
    __pyx_v_end_vector = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_17 * __pyx_v_curve.strides[0]) ) + __pyx_t_16 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_15 * __pyx_v_curve.strides[0]) ) + __pyx_t_14 * __pyx_v_curve.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>: 		for x in range(npoints):</pre>
<pre class='cython code score-0 '>    __pyx_t_18 = __pyx_v_npoints;
    __pyx_t_19 = __pyx_t_18;
    for (__pyx_t_20 = 0; __pyx_t_20 &lt; __pyx_t_19; __pyx_t_20+=1) {
      __pyx_v_x = __pyx_t_20;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">577</span>: 			for i in range(window_size):</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_window_size;
      __pyx_t_21 = __pyx_t_7;
      for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_21; __pyx_t_22+=1) {
        __pyx_v_i = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">578</span>: 				# Index of the point to multiply this coefficient with</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">579</span>: 				conv_index = x + i + i_first</pre>
<pre class='cython code score-0 '>        __pyx_v_conv_index = ((__pyx_v_x + __pyx_v_i) + __pyx_v_i_first);
</pre><pre class="cython line score-0">&#xA0;<span class="">580</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>: 				# Index &lt; 0 -&gt; before the first sample. Extend with the first vector</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">582</span>: 				if conv_index &lt; 0:</pre>
<pre class='cython code score-0 '>        __pyx_t_2 = (__pyx_v_conv_index &lt; 0);
        if (__pyx_t_2) {
/* … */
          goto __pyx_L12;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">583</span>: 					conv_value = curve[row, 0] - start_vector*conv_index</pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_row;
          __pyx_t_15 = 0;
          __pyx_v_conv_value = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_14 * __pyx_v_curve.strides[0]) ) + __pyx_t_15 * __pyx_v_curve.strides[1]) ))) - (__pyx_v_start_vector * __pyx_v_conv_index));
</pre><pre class="cython line score-0">&#xA0;<span class="">584</span>: 				# Index &gt;= npoints -&gt; beyond the last sample. Extend with the last vector</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">585</span>: 				elif conv_index &gt;= npoints:</pre>
<pre class='cython code score-0 '>        __pyx_t_2 = (__pyx_v_conv_index &gt;= __pyx_v_npoints);
        if (__pyx_t_2) {
/* … */
          goto __pyx_L12;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>: 					conv_value = curve[row, npoints-1] + end_vector*(conv_index - (npoints-1))</pre>
<pre class='cython code score-0 '>          __pyx_t_15 = __pyx_v_row;
          __pyx_t_14 = (__pyx_v_npoints - 1);
          __pyx_v_conv_value = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_15 * __pyx_v_curve.strides[0]) ) + __pyx_t_14 * __pyx_v_curve.strides[1]) ))) + (__pyx_v_end_vector * (__pyx_v_conv_index - (__pyx_v_npoints - 1))));
</pre><pre class="cython line score-0">&#xA0;<span class="">587</span>: 				else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">588</span>: 					conv_value = curve[row, conv_index]</pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_14 = __pyx_v_row;
          __pyx_t_15 = __pyx_v_conv_index;
          __pyx_v_conv_value = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_14 * __pyx_v_curve.strides[0]) ) + __pyx_t_15 * __pyx_v_curve.strides[1]) )));
        }
        __pyx_L12:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">589</span>: 				result_view[row, x] += conv_value * coeffs_view[i]</pre>
<pre class='cython code score-0 '>        __pyx_t_15 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_row;
        __pyx_t_16 = __pyx_v_x;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_result_view.data + __pyx_t_14 * __pyx_v_result_view.strides[0]) ) + __pyx_t_16 * __pyx_v_result_view.strides[1]) )) += (__pyx_v_conv_value * (*((double *) ( /* dim=0 */ (__pyx_v_coeffs_view.data + __pyx_t_15 * __pyx_v_coeffs_view.strides[0]) ))));
      }
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>: 	return result</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">591</span>: </pre>
<pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>: cpdef double mean_curvature(double[:, :] curve):</pre>
<pre class='cython code score-65 '>static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static double __pyx_f_11trajeometry_mean_curvature(__Pyx_memviewslice __pyx_v_curve, CYTHON_UNUSED int __pyx_skip_dispatch) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_valid_points;
  double __pyx_v_prev_vector[2];
  double __pyx_v_next_vector[2];
  double __pyx_v_curvature_sum;
  double __pyx_v_prev_vector_norm;
  double __pyx_v_next_vector_norm;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_17, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_18, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_11trajeometry_30mean_curvature, "Compute the mean curvature of the given curve, in rad/unit\n\t   - curve : double[2, N] : Curve to process\n\t&lt;----------- Mean of the local curvatures in rad/length unit\n\t");
static PyMethodDef __pyx_mdef_11trajeometry_31mean_curvature = {"mean_curvature", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_31mean_curvature, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_11trajeometry_30mean_curvature};
static PyObject *__pyx_pw_11trajeometry_31mean_curvature(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_curvature (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve,0};
  PyObject* values[1] = {0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "mean_curvature") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
    }
    __pyx_v_curve = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve.memview)) __PYX_ERR(0, 592, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mean_curvature", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_30mean_curvature(__pyx_self, __pyx_v_curve);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_30mean_curvature(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_mean_curvature(__pyx_v_curve, 0); if (unlikely(__pyx_t_1 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L1_error)</span>
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_curvature", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_31mean_curvature, 0, __pyx_n_s_mean_curvature, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__57));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_mean_curvature, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
/* … */
  __pyx_codeobj__57 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_trajeometry_pyx, __pyx_n_s_mean_curvature, 592, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__57)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">593</span>: 	"""Compute the mean curvature of the given curve, in rad/unit</pre>
<pre class="cython line score-0">&#xA0;<span class="">594</span>: 	   - curve : double[2, N] : Curve to process</pre>
<pre class="cython line score-0">&#xA0;<span class="">595</span>: 	&lt;----------- Mean of the local curvatures in rad/length unit</pre>
<pre class="cython line score-0">&#xA0;<span class="">596</span>: 	"""</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">597</span>: 	cdef Py_ssize_t i, valid_points = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_valid_points = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">598</span>: 	cdef double[2] prev_vector, next_vector</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">599</span>: 	cdef double curvature_sum = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_curvature_sum = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">600</span>: 	# Our local curvature is the angle between the incoming and outgoing vectors, divided by the mean local segment length</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">601</span>: 	for i in range(1, curve.shape[1]-1):</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_curve.shape[1]) - 1);
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 1; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">602</span>: 		prev_vector = [curve[0, i] - curve[0, i-1], curve[1, i] - curve[1, i-1]]</pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_6 = 0;
    __pyx_t_7 = (__pyx_v_i - 1);
    __pyx_t_8 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_t_10 = 1;
    __pyx_t_11 = (__pyx_v_i - 1);
    __pyx_t_12[0] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_4 * __pyx_v_curve.strides[0]) ) + __pyx_t_5 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_6 * __pyx_v_curve.strides[0]) ) + __pyx_t_7 * __pyx_v_curve.strides[1]) ))));
    __pyx_t_12[1] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_8 * __pyx_v_curve.strides[0]) ) + __pyx_t_9 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_10 * __pyx_v_curve.strides[0]) ) + __pyx_t_11 * __pyx_v_curve.strides[1]) ))));
    memcpy(&amp;(__pyx_v_prev_vector[0]), __pyx_t_12, sizeof(__pyx_v_prev_vector[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">603</span>: 		next_vector = [curve[0, i+1] - curve[0, i], curve[1, i+1] - curve[1, i]]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 0;
    __pyx_t_10 = (__pyx_v_i + 1);
    __pyx_t_9 = 0;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_6 = (__pyx_v_i + 1);
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_13[0] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_11 * __pyx_v_curve.strides[0]) ) + __pyx_t_10 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_9 * __pyx_v_curve.strides[0]) ) + __pyx_t_8 * __pyx_v_curve.strides[1]) ))));
    __pyx_t_13[1] = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_7 * __pyx_v_curve.strides[0]) ) + __pyx_t_6 * __pyx_v_curve.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_curve.data + __pyx_t_5 * __pyx_v_curve.strides[0]) ) + __pyx_t_4 * __pyx_v_curve.strides[1]) ))));
    memcpy(&amp;(__pyx_v_next_vector[0]), __pyx_t_13, sizeof(__pyx_v_next_vector[0]) * (2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">604</span>: 		prev_vector_norm = sqrt(prev_vector[0]*prev_vector[0] + prev_vector[1]*prev_vector[1])</pre>
<pre class='cython code score-0 '>    __pyx_v_prev_vector_norm = sqrt((((__pyx_v_prev_vector[0]) * (__pyx_v_prev_vector[0])) + ((__pyx_v_prev_vector[1]) * (__pyx_v_prev_vector[1]))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">605</span>: 		next_vector_norm = sqrt(next_vector[0]*next_vector[0] + next_vector[1]*next_vector[1])</pre>
<pre class='cython code score-0 '>    __pyx_v_next_vector_norm = sqrt((((__pyx_v_next_vector[0]) * (__pyx_v_next_vector[0])) + ((__pyx_v_next_vector[1]) * (__pyx_v_next_vector[1]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">606</span>: </pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">607</span>: 		curvature_sum += vector_angle(prev_vector, next_vector) / ((prev_vector_norm + next_vector_norm) / 2)</pre>
<pre class='cython code score-22 '>    __pyx_t_16 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    __pyx_t_15 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_14 = __pyx_array_new(__pyx_t_15, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_16), (char *) "fortran", (char *) __pyx_v_prev_vector);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_14), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_format_from_typeinfo(&amp;__Pyx_TypeInfo_double);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_16 = Py_BuildValue((char*) "("  __PYX_BUILD_PY_SSIZE_T  ")", ((Py_ssize_t)2));<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    __pyx_t_14 = __pyx_array_new(__pyx_t_16, sizeof(double), <span class='py_macro_api'>PyBytes_AS_STRING</span>(__pyx_t_15), (char *) "fortran", (char *) __pyx_v_next_vector);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>((PyObject *)__pyx_t_14);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_t_14), PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 607, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>((PyObject *)__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_19 = __pyx_f_11trajeometry_vector_angle(__pyx_t_17, __pyx_t_18, 0); if (unlikely(__pyx_t_19 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_17, 1);
    __pyx_t_17.memview = NULL; __pyx_t_17.data = NULL;
    __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_18, 1);
    __pyx_t_18.memview = NULL; __pyx_t_18.data = NULL;
    __pyx_t_20 = ((__pyx_v_prev_vector_norm + __pyx_v_next_vector_norm) / 2.0);
    if (unlikely(__pyx_t_20 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 607, __pyx_L1_error)</span>
    }
    __pyx_v_curvature_sum = (__pyx_v_curvature_sum + (__pyx_t_19 / __pyx_t_20));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">608</span>: 		valid_points += 1</pre>
<pre class='cython code score-0 '>    __pyx_v_valid_points = (__pyx_v_valid_points + 1);
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">609</span>: 	return curvature_sum / valid_points</pre>
<pre class='cython code score-5 '>  if (unlikely(__pyx_v_valid_points == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 609, __pyx_L1_error)</span>
  }
  __pyx_r = (__pyx_v_curvature_sum / ((double)__pyx_v_valid_points));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">610</span>: </pre>
<pre class="cython line score-73" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">611</span>: cpdef mean_parallel_distance(double[:, :] curve1, double[:, :] curve2):</pre>
<pre class='cython code score-73 '>static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyObject *__pyx_f_11trajeometry_mean_parallel_distance(__Pyx_memviewslice __pyx_v_curve1, __Pyx_memviewslice __pyx_v_curve2, CYTHON_UNUSED int __pyx_skip_dispatch) {
  __Pyx_memviewslice __pyx_v_longest_line = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_shortest_line = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_paralleldiff;
  CYTHON_UNUSED double __pyx_v_vector1_x;
  CYTHON_UNUSED double __pyx_v_vector1_y;
  double __pyx_v_vector2_x;
  double __pyx_v_vector2_y;
  int __pyx_v_valid_points;
  Py_ssize_t __pyx_v_p;
  struct __pyx_t_11trajeometry__ProjectionIndex __pyx_v_projection;
  PyObject *__pyx_r = NULL;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_longest_line, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_shortest_line, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_11trajeometry_33mean_parallel_distance = {"mean_parallel_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_11trajeometry_33mean_parallel_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_11trajeometry_33mean_parallel_distance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_curve1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_curve2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("mean_parallel_distance (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #else
  __pyx_nargs = <span class='py_c_api'>PyTuple_Size</span>(__pyx_args); if (unlikely(__pyx_nargs &lt; 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_curve1,&amp;__pyx_n_s_curve2,0};
  PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve1)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[0]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_curve2)) != 0)) {
          (void)<span class='pyx_c_api'>__Pyx_Arg_NewRef_FASTCALL</span>(values[1]);
          kw_args--;
        }
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mean_parallel_distance", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "mean_parallel_distance") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_curve1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve1.memview)) __PYX_ERR(0, 611, __pyx_L3_error)</span>
    __pyx_v_curve2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_curve2.memview)) __PYX_ERR(0, 611, __pyx_L3_error)</span>
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("mean_parallel_distance", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L3_error)</span>
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve1, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve2, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_11trajeometry_32mean_parallel_distance(__pyx_self, __pyx_v_curve1, __pyx_v_curve2);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve1, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_curve2, 1);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp &lt; (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      <span class='pyx_c_api'>__Pyx_Arg_XDECREF_FASTCALL</span>(values[__pyx_temp]);
    }
  }
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_11trajeometry_32mean_parallel_distance(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_curve1, __Pyx_memviewslice __pyx_v_curve2) {
  PyObject *__pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = __pyx_f_11trajeometry_mean_parallel_distance(__pyx_v_curve1, __pyx_v_curve2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("trajeometry.mean_parallel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__58 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_s_curve1, __pyx_n_s_curve2);<span class='error_goto'> if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__58);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__58);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_11trajeometry_33mean_parallel_distance, 0, __pyx_n_s_mean_parallel_distance, NULL, __pyx_n_s_trajeometry, __pyx_d, ((PyObject *)__pyx_codeobj__59));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_mean_parallel_distance, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">612</span>: 	cdef double[:, :] longest_line, shortest_line</pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">613</span>: 	if line_length(curve1) &gt; line_length(curve2):</pre>
<pre class='cython code score-10 '>  __pyx_t_1 = __pyx_f_11trajeometry_line_length(__pyx_v_curve1, 0); if (unlikely(__pyx_t_1 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 613, __pyx_L1_error)</span>
  __pyx_t_2 = __pyx_f_11trajeometry_line_length(__pyx_v_curve2, 0); if (unlikely(__pyx_t_2 == ((double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 613, __pyx_L1_error)</span>
  __pyx_t_3 = (__pyx_t_1 &gt; __pyx_t_2);
  if (__pyx_t_3) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">614</span>: 		longest_line = curve1</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve1, 1);
    __pyx_v_longest_line = __pyx_v_curve1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">615</span>: 		shortest_line = curve2</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve2, 1);
    __pyx_v_shortest_line = __pyx_v_curve2;
</pre><pre class="cython line score-0">&#xA0;<span class="">616</span>: 	else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">617</span>: 		longest_line = curve2</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve2, 1);
    __pyx_v_longest_line = __pyx_v_curve2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">618</span>: 		shortest_line = curve1</pre>
<pre class='cython code score-0 '>    __PYX_INC_MEMVIEW(&amp;__pyx_v_curve1, 1);
    __pyx_v_shortest_line = __pyx_v_curve1;
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">619</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">620</span>: 	# Now compute the average orthogonal distance and the average angle difference</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">621</span>: 	cdef double paralleldiff = 0, vector1_x, vector1_y, vector2_x, vector2_y</pre>
<pre class='cython code score-0 '>  __pyx_v_paralleldiff = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">622</span>: 	cdef int valid_points = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_valid_points = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">623</span>: 	cdef Py_ssize_t p</pre>
<pre class="cython line score-0">&#xA0;<span class="">624</span>: 	cdef _ProjectionIndex projection</pre>
<pre class="cython line score-0">&#xA0;<span class="">625</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">626</span>: 	for p in range(longest_line.shape[1] - 1):</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_longest_line.shape[1]) - 1);
  __pyx_t_5 = __pyx_t_4;
  for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
    __pyx_v_p = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">627</span>: 		projection = _project_on_curve_index(longest_line[0, p], longest_line[1, p], shortest_line, False, 0)</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 0;
    __pyx_t_8 = __pyx_v_p;
    __pyx_t_9 = 1;
    __pyx_t_10 = __pyx_v_p;
    __pyx_t_11 = __pyx_f_11trajeometry__project_on_curve_index((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_7 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_longest_line.strides[1]) ))), (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_9 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_10 * __pyx_v_longest_line.strides[1]) ))), __pyx_v_shortest_line, 0, 0);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 627, __pyx_L1_error)</span>
    __pyx_v_projection = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">628</span>: 		if projection.index &lt; 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_v_projection.index &lt; 0);
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">629</span>: 			continue</pre>
<pre class='cython code score-0 '>      goto __pyx_L4_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">630</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">631</span>: 		vector1_x = longest_line[0, p+1] - longest_line[0, p]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = 0;
    __pyx_t_9 = (__pyx_v_p + 1);
    __pyx_t_8 = 0;
    __pyx_t_7 = __pyx_v_p;
    __pyx_v_vector1_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_10 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_9 * __pyx_v_longest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_8 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_longest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">632</span>: 		vector1_y = longest_line[1, p+1] - longest_line[1, p]</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_8 = (__pyx_v_p + 1);
    __pyx_t_9 = 1;
    __pyx_t_10 = __pyx_v_p;
    __pyx_v_vector1_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_7 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_longest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_9 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_10 * __pyx_v_longest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">633</span>: 		vector2_x = shortest_line[0, projection.index+1] - shortest_line[0, projection.index]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = 0;
    __pyx_t_9 = (__pyx_v_projection.index + 1);
    __pyx_t_8 = 0;
    __pyx_t_7 = __pyx_v_projection.index;
    __pyx_v_vector2_x = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_10 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_9 * __pyx_v_shortest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_8 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_shortest_line.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">634</span>: 		vector2_y = shortest_line[1, projection.index+1] - shortest_line[1, projection.index]</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = 1;
    __pyx_t_8 = (__pyx_v_projection.index + 1);
    __pyx_t_9 = 1;
    __pyx_t_10 = __pyx_v_projection.index;
    __pyx_v_vector2_y = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_7 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_8 * __pyx_v_shortest_line.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_9 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_10 * __pyx_v_shortest_line.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">635</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">636</span>: 		paralleldiff += sqrt((longest_line[0, p] - (shortest_line[0, projection.index] + vector2_x*projection.vector_factor))**2 + (longest_line[1, p] - (shortest_line[1, projection.index] + vector2_y*projection.vector_factor))**2)</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = 0;
    __pyx_t_9 = __pyx_v_p;
    __pyx_t_8 = 0;
    __pyx_t_7 = __pyx_v_projection.index;
    __pyx_t_12 = 1;
    __pyx_t_13 = __pyx_v_p;
    __pyx_t_14 = 1;
    __pyx_t_15 = __pyx_v_projection.index;
    __pyx_v_paralleldiff = (__pyx_v_paralleldiff + sqrt((pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_10 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_9 * __pyx_v_longest_line.strides[1]) ))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_8 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_7 * __pyx_v_shortest_line.strides[1]) ))) + (__pyx_v_vector2_x * __pyx_v_projection.vector_factor))), 2.0) + pow(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_longest_line.data + __pyx_t_12 * __pyx_v_longest_line.strides[0]) ) + __pyx_t_13 * __pyx_v_longest_line.strides[1]) ))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_shortest_line.data + __pyx_t_14 * __pyx_v_shortest_line.strides[0]) ) + __pyx_t_15 * __pyx_v_shortest_line.strides[1]) ))) + (__pyx_v_vector2_y * __pyx_v_projection.vector_factor))), 2.0))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">637</span>: 		valid_points += 1</pre>
<pre class='cython code score-0 '>    __pyx_v_valid_points = (__pyx_v_valid_points + 1);
    __pyx_L4_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">638</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">639</span>: 	if valid_points == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_3 = (__pyx_v_valid_points == 0);
  if (__pyx_t_3) {
/* … */
  }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">640</span>: 		return np.inf</pre>
<pre class='cython code score-6 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_16, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_16, __pyx_n_s_inf);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 640, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    __pyx_r = __pyx_t_17;
    __pyx_t_17 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">641</span>: 	else:</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">642</span>: 		return paralleldiff / valid_points</pre>
<pre class='cython code score-11 '>  /*else*/ {
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    if (unlikely(__pyx_v_valid_points == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 642, __pyx_L1_error)</span>
    }
    __pyx_t_17 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_paralleldiff / ((double)__pyx_v_valid_points)));<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 642, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
    __pyx_r = __pyx_t_17;
    __pyx_t_17 = 0;
    goto __pyx_L0;
  }
</pre></div></body></html>
