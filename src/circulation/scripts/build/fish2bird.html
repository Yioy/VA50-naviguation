<!DOCTYPE html>
<!-- Generated by Cython 3.0.0 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: fish2bird.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { color: #000000; margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 3.0.0</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="fish2bird.c">fish2bird.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># distutils: extra_compile_args=-fopenmp</span></pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="c"># distutils: extra_link_args=-fopenmp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: <span class="c">#   Copyright 2023 Grégori MIGNEROT, Élian BELMONTE, Benjamin STACH</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: <span class="c">#   Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: <span class="c">#   you may not use this file except in compliance with the License.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="c">#   You may obtain a copy of the License at</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: <span class="c">#       http://www.apache.org/licenses/LICENSE-2.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: <span class="c">#</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="c">#   Unless required by applicable law or agreed to in writing, software</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="c">#   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="c">#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: <span class="c">#   See the License for the specific language governing permissions and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="c">#   limitations under the License.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="sd">Retrieve the actual 3D position of points from an image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="sd">This assumes an omnidirection distortion model as described in the following paper by Christopher Mei :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="sd">https://www-sop.inria.fr/icare/personnel/Christopher.Mei/articles/projection_model.pdf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: <span class="sd">Frame and coordinate systems reference :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="sd"> - image  : (u, v)       : input image pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">026</span>: <span class="sd"> - input  : (x, y)       : metric plane associated to the image (&quot;sensor frame&quot;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">027</span>: <span class="sd"> - sphere : (x, y, z)    : projection on the surface of a unit sphere (Mei distortion model)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: <span class="sd"> - angles : (θ, φ)       : spheric coordinates angles of the 3D point in the camera frame relative to the center of the unit sphere (θ = colatitude, φ = longitude)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="sd"> - camera : (X, Y, Z, 1) : camera frame associated to the input image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="sd"> - target : (X, Y, Z, 1) : target plane frame (all target points are assumed to be on a plane where Z=0 in the target frame)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="sd"> - output : (u, v)       : output image frame (orthogonal projection along the z axis and scaling)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">033</span>: <span class="sd">This module helps retrieving original 3D points from an image.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">034</span>: <span class="sd">The original 3D points are assumed to be on a 3D plane</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">035</span>: <span class="sd">To do that, this modules needs three main parameters :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="sd">- camera_to_image  : The K matrix, that projects from metric coordinates to pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="sd">					 |αᵤ  0 u₀|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="sd">					 | 0 αᵥ v₀|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: <span class="sd">					 | 0  0  1|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: <span class="sd">					 camera_to_image @ input_points = image_points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: <span class="sd">- xi			   : The ξ parameter in Christopher Mei’s paper, that gives the displacement from the unit sphere center for the reprojection</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="sd">- camera_to_target : A full, homogeneous 4×4 transform matrix, that converts from the camera frame to another 3D frame,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: <span class="sd">					 where all relevant points in the image are assumed to be on the (X, Y) plane (such that Z = 0)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">					 For instance, for the forward camera of a vehicle, this may convert from the camera frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="sd">					 to a frame with its origin point on the road and the Z axis pointing upward,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="sd">					 all points are then assumed to be on the road (Z = 0 in the road frame)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: <span class="sd">					 |\ | / Tx|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: <span class="sd">					 |- R - Ty|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: <span class="sd">					 |/ | \ Tz|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: <span class="sd">					 |0 0 0  1|</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: <span class="sd">					 camera_to_target @ camera_point = target_points, target_points[2] == 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: <span class="sd">Main functions :</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">- to_birdeye(image, camera_to_image, camera_to_target, xi, x_range, y_range, output_size_y, flip_x=False, flip_y=False) -&gt; bird-eye view, scale factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">	Project the given image directly to a bird-eye view, with a simple scale factor to convert back and forth between pixel and metric measurements</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: <span class="sd">- image_to_target(image_points, camera_to_image, camera_to_target, xi) -&gt; target_points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>: <span class="sd">	Convert points from the initial image to the target plane</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>: <span class="sd"> </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: <span class="sd">- target_to_output(target_points, x_range, y_range, int output_size_y, bint flip_x=False, bint flip_y=False) -&gt; output_points, scale_factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>: <span class="sd">	Project points from the target frame to the bird-eye view pixel coordinates, and give the scale factor from pixel to metric coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>: <span class="sd">- birdeye_to_target(points, x_range, y_range, image_shape, flip_x=False, flip_y=False) -&gt; target_points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>: <span class="sd">	Convert bird-eye view pixel coordinates back to 3D target points, assuming Z = 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>: <span class="sd">- target_to_image(target_points, double[:, :] target_to_camera, double[:, :] camera_to_image, double xi) -&gt; image_points</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>: <span class="sd">	Project 3D points from the target frame to image pixel coordinates, like the camera would</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>: <span class="k">import</span> <span class="nn">cv2</span> <span class="k">as</span> <span class="nn">cv</span></pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_cv2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cv, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">071</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_ImportDottedModule</span>(__pyx_n_s_numpy, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 71, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 71, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">072</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>: <span class="k">import</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>: <span class="k">from</span> <span class="nn">numpy</span> <span class="k">cimport</span> <span class="n">uint8_t</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">ceil</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>: <span class="k">from</span> <span class="nn">cython.parallel</span> <span class="k">cimport</span> <span class="n">prange</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: <span class="c"># Legacy Python functions, for reference</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>: </pre>
<pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">080</span>: <span class="k">def</span> <span class="nf">get_image_points</span><span class="p">(</span><span class="n">image</span><span class="p">):</span></pre>
<pre class='cython code score-49 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_1get_image_points(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_get_image_points, "Get the [x, y] coordinates of all pixels in the image\n\t   - image : ndarray[y, x] : source image\n\t&lt;----------- ndarray[2, N] : Coordinates of all image points as columns (x, y)");
static PyMethodDef __pyx_mdef_9fish2bird_1get_image_points = {"get_image_points", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_1get_image_points, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_get_image_points};
static PyObject *__pyx_pw_9fish2bird_1get_image_points(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_image = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_image_points (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_image,0};
    PyObject* values[1] = {0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 80, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_image_points") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 80, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
    }
    __pyx_v_image = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("get_image_points", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 80, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.get_image_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_get_image_points(__pyx_self, __pyx_v_image);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_get_image_points(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_image) {
  PyObject *__pyx_v_y_positions = NULL;
  PyObject *__pyx_v_x_positions = NULL;
  PyObject *__pyx_v_x_2d = NULL;
  PyObject *__pyx_v_y_2d = NULL;
  PyObject *__pyx_v_image_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_image_points", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.get_image_points", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_y_positions);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_x_positions);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_x_2d);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_y_2d);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_image_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__23 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_image, __pyx_n_s_y_positions, __pyx_n_s_x_positions, __pyx_n_s_x_2d, __pyx_n_s_y_2d, __pyx_n_s_image_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__23);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__23);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_1get_image_points, 0, __pyx_n_s_get_image_points, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__24));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_get_image_points, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 80, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__24 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__23, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_get_image_points, 80, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__24)) __PYX_ERR(0, 80, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">081</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Get the [x, y] coordinates of all pixels in the image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>: <span class="sd">	   - image : ndarray[y, x] : source image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>: <span class="sd">	&lt;----------- ndarray[2, N] : Coordinates of all image points as columns (x, y)&quot;&quot;&quot;</span></pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>: 	<span class="n">y_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_2, __pyx_int_0, __pyx_t_4, __pyx_int_1};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 84, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_y_positions = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>: 	<span class="n">x_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_arange);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_3, __pyx_int_0, __pyx_t_2, __pyx_int_1};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_v_x_positions = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">086</span>: 	<span class="n">x_2d</span><span class="p">,</span> <span class="n">y_2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_positions</span><span class="p">,</span> <span class="n">y_positions</span><span class="p">)</span></pre>
<pre class='cython code score-65 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_meshgrid);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_x_positions, __pyx_v_y_positions};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_4 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_4 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_4 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 86, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_3);
    index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    index = 1; __pyx_t_4 = __pyx_t_6(__pyx_t_3); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_6(__pyx_t_3), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    __pyx_t_6 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_6 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 86, __pyx_L1_error)</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_v_x_2d = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_y_2d = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>: 	<span class="n">x_2d</span> <span class="o">=</span> <span class="n">x_2d</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></pre>
<pre class='cython code score-17 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_x_2d, __pyx_n_s_ravel);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[1] = {__pyx_t_2, };
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_x_2d, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-17" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>: 	<span class="n">y_2d</span> <span class="o">=</span> <span class="n">y_2d</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></pre>
<pre class='cython code score-17 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_y_2d, __pyx_n_s_ravel);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[1] = {__pyx_t_2, };
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_y_2d, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-29" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>: 	<span class="n">image_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">x_2d</span><span class="p">,</span> <span class="n">y_2d</span><span class="p">))</span></pre>
<pre class='cython code score-29 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 89, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_x_2d);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_x_2d);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_x_2d);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_y_2d);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_y_2d);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_v_y_2d);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_4};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 89, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_image_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>: 	<span class="k">return</span> <span class="n">image_points</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_image_points);
  __pyx_r = __pyx_v_image_points;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">091</span>: </pre>
<pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>: <span class="k">def</span> <span class="nf">image_to_input</span><span class="p">(</span><span class="n">image_points</span><span class="p">,</span> <span class="n">camera_to_image</span><span class="p">):</span></pre>
<pre class='cython code score-62 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_3image_to_input(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_2image_to_input, "Convert from image pixel coordinates to input frame (\"sensor\") homogeneous coordinates\n\t   - image_points    : ndarray[2, N] : Pixel coordinates in the image (vectors as columns)\n\t   - camera_to_image : ndarray[3, 3] : Projection matrix (K) to pixel coordinates\n\t&lt;--------------------- ndarray[2, N] : Coordinates in the metric plane associated to the image (input frame)");
static PyMethodDef __pyx_mdef_9fish2bird_3image_to_input = {"image_to_input", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_3image_to_input, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_2image_to_input};
static PyObject *__pyx_pw_9fish2bird_3image_to_input(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_image_points = 0;
  PyObject *__pyx_v_camera_to_image = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("image_to_input (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_image_points,&amp;__pyx_n_s_camera_to_image,0};
    PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_image_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_input", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "image_to_input") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_image_points = values[0];
    __pyx_v_camera_to_image = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_input", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.image_to_input", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_2image_to_input(__pyx_self, __pyx_v_image_points, __pyx_v_camera_to_image);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_2image_to_input(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_image_points, PyObject *__pyx_v_camera_to_image) {
  PyObject *__pyx_v_image_homogeneous = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("image_to_input", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.image_to_input", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_image_homogeneous);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__25 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_image_points, __pyx_n_s_camera_to_image, __pyx_n_s_image_homogeneous);<span class='error_goto'> if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__25);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__25);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_3image_to_input, 0, __pyx_n_s_image_to_input, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__26));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_image_to_input, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__26 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__25, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_image_to_input, 92, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">093</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Convert from image pixel coordinates to input frame (&quot;sensor&quot;) homogeneous coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>: <span class="sd">	   - image_points    : ndarray[2, N] : Pixel coordinates in the image (vectors as columns)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>: <span class="sd">	   - camera_to_image : ndarray[3, 3] : Projection matrix (K) to pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>: <span class="sd">	&lt;--------------------- ndarray[2, N] : Coordinates in the metric plane associated to the image (input frame)&quot;&quot;&quot;</span></pre>
<pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>: 	<span class="n">image_homogeneous</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">image_points</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">image_points</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">])))</span></pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_image_points, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_image_points, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image_points, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_6, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      __pyx_t_9 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_8};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_7, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 97, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 2, __pyx_t_5);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_9 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_7};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_image_homogeneous = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>: 	<span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">camera_to_image</span><span class="p">)</span> <span class="err">@</span> <span class="n">image_homogeneous</span><span class="p">)[:</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-34 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_linalg);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_inv);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_9 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_camera_to_image};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_MatrixMultiply</span>(__pyx_t_1, __pyx_v_image_homogeneous);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(__pyx_t_3, 0, 2, NULL, NULL, &amp;__pyx_slice__11, 0, 1, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
/* … */
  __pyx_slice__11 = <span class='py_c_api'>PySlice_New</span>(Py_None, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_slice__11)) __PYX_ERR(0, 98, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_slice__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_slice__11);
</pre><pre class="cython line score-0">&#xA0;<span class="">099</span>: </pre>
<pre class="cython line score-65" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>: <span class="k">def</span> <span class="nf">input_to_sphere</span><span class="p">(</span><span class="n">input_points</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span></pre>
<pre class='cython code score-65 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_5input_to_sphere(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_4input_to_sphere, "Project from the input (\"sensor\") plane to the unit sphere\n\t   - input_points : ndarray[2, N] : Coordinates in the metric plane associated to the image (input frame)\n\t   - xi           : float         : Mei\342\200\231s model center shifting parameter (\316\276 in the paper)\n\t&lt;------------------ ndarray[3, N] : 3D coordinates of the points\342\200\231 projection on the unit sphere");
static PyMethodDef __pyx_mdef_9fish2bird_5input_to_sphere = {"input_to_sphere", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_5input_to_sphere, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_4input_to_sphere};
static PyObject *__pyx_pw_9fish2bird_5input_to_sphere(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_input_points = 0;
  PyObject *__pyx_v_xi = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("input_to_sphere (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_input_points,&amp;__pyx_n_s_xi,0};
    PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_input_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xi)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("input_to_sphere", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "input_to_sphere") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_input_points = values[0];
    __pyx_v_xi = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("input_to_sphere", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.input_to_sphere", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_4input_to_sphere(__pyx_self, __pyx_v_input_points, __pyx_v_xi);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_4input_to_sphere(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_input_points, PyObject *__pyx_v_xi) {
  PyObject *__pyx_v_projected_x = NULL;
  PyObject *__pyx_v_projected_y = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("input_to_sphere", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.input_to_sphere", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_projected_x);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_projected_y);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__27 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_input_points, __pyx_n_s_xi, __pyx_n_s_projected_x, __pyx_n_s_projected_y);<span class='error_goto'> if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__27);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__27);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_5input_to_sphere, 0, __pyx_n_s_input_to_sphere, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__28));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_input_to_sphere, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__28 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_input_to_sphere, 100, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 100, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Project from the input (&quot;sensor&quot;) plane to the unit sphere</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>: <span class="sd">	   - input_points : ndarray[2, N] : Coordinates in the metric plane associated to the image (input frame)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: <span class="sd">	   - xi           : float         : Mei’s model center shifting parameter (ξ in the paper)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: <span class="sd">	&lt;------------------ ndarray[3, N] : 3D coordinates of the points’ projection on the unit sphere&quot;&quot;&quot;</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>: 	<span class="n">projected_x</span><span class="p">,</span> <span class="n">projected_y</span> <span class="o">=</span> <span class="n">input_points</span></pre>
<pre class='cython code score-44 '>  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_input_points))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_input_points))) {
    PyObject* sequence = __pyx_v_input_points;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    #else
    __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    #endif
  } else {
    Py_ssize_t index = -1;
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_input_points);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_3);
    index = 0; __pyx_t_1 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    index = 1; __pyx_t_2 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_4(__pyx_t_3), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span>
    __pyx_t_4 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_v_projected_x = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_projected_y = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>: 	<span class="c"># Equations directly taken from Christopher Mei’s paper (h⁻¹(mᵤ) = ...)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>: 	<span class="c"># We assume no other distortion factors so we can go directly from the image plane to the sphere</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>: 	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 109, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-114" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>: 		<span class="n">projected_x</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">xi</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">1</span><span class="p">),</span></pre>
<pre class='cython code score-114 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sqrt);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_xi, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_5, __pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_8, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_10 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_9};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 110, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_xi, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_projected_x, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_8 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_8, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_1, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_12);
  __pyx_t_8 = 0;
  __pyx_t_5 = 0;
  __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_10 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_t_1};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-91" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>: 		<span class="n">projected_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">xi</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">1</span><span class="p">),</span></pre>
<pre class='cython code score-91 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sqrt);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_xi, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractCObj</span>(__pyx_int_1, __pyx_t_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_5, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_10 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_11};
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (unlikely(!__pyx_t_9)) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_xi, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_projected_y, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_11 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_5, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_9, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 111, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
</pre><pre class="cython line score-91" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>: 		<span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">xi</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">xi</span><span class="p">,</span></pre>
<pre class='cython code score-91 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_sqrt);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_xi, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_SubtractCObj</span>(__pyx_int_1, __pyx_t_9, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_12 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_9, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_7, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_AddCObj</span>(__pyx_int_1, __pyx_t_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_10 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_12};
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    if (unlikely(!__pyx_t_11)) <span class='error_goto'>__PYX_ERR(0, 112, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_v_xi, __pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_x, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_12 = <span class='py_c_api'>PyNumber_Power</span>(__pyx_v_projected_y, __pyx_int_2, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_AddObjC</span>(__pyx_t_1, __pyx_int_1, 1, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_6, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_1, __pyx_v_xi);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 112, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">113</span>: 	<span class="p">))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: </pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>: <span class="k">def</span> <span class="nf">sphere_to_angles</span><span class="p">(</span><span class="n">sphere_points</span><span class="p">):</span></pre>
<pre class='cython code score-48 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_7sphere_to_angles(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_6sphere_to_angles, "Convert 3D cartesian coordinates on the surface of the unit sphere to spheric coordinates angles (colatitude, longitude)\n\t   - sphere_points : ndarray[3, N] : 3D coordinates on the surface of the unit sphere\n\t&lt;------------------- ndarray[2, N] : Spheric coordinates angles (colatitude \316\270, longitude \317\206)");
static PyMethodDef __pyx_mdef_9fish2bird_7sphere_to_angles = {"sphere_to_angles", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_7sphere_to_angles, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_6sphere_to_angles};
static PyObject *__pyx_pw_9fish2bird_7sphere_to_angles(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_sphere_points = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sphere_to_angles (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_sphere_points,0};
    PyObject* values[1] = {0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sphere_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "sphere_to_angles") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
    }
    __pyx_v_sphere_points = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sphere_to_angles", 1, 1, 1, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.sphere_to_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_6sphere_to_angles(__pyx_self, __pyx_v_sphere_points);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_6sphere_to_angles(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_sphere_points) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sphere_to_angles", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.sphere_to_angles", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__29 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_sphere_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 115, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__29);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__29);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_7sphere_to_angles, 0, __pyx_n_s_sphere_to_angles, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__30));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 115, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sphere_to_angles, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__30 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_sphere_to_angles, 115, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 115, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">116</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Convert 3D cartesian coordinates on the surface of the unit sphere to spheric coordinates angles (colatitude, longitude)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>: <span class="sd">	   - sphere_points : ndarray[3, N] : 3D coordinates on the surface of the unit sphere</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>: <span class="sd">	&lt;------------------- ndarray[2, N] : Spheric coordinates angles (colatitude θ, longitude φ)&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>: 	<span class="c"># We are on a unit sphere, so the radius is 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>: 	<span class="c"># Those are traditional physics-convention spheric coordinates (radius, colatitude, longitude)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>: 	<span class="c"># Except at this stage we don’t know the actual radius of the original 3D point yet</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">123</span>: 	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 123, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 123, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">124</span>: 		<span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">sphere_points</span><span class="p">[</span><span class="mf">2</span><span class="p">]),</span>					 <span class="c"># Colatitude θ = arccos(z/ρ), ρ = 1</span></pre>
<pre class='cython code score-44 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_arccos);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_sphere_points, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_7 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_4};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 124, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
/* … */
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 124, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  __pyx_t_2 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_6};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 123, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">125</span>: 		<span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sphere_points</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">sphere_points</span><span class="p">[</span><span class="mf">0</span><span class="p">]),</span>  <span class="c"># Longitude  φ = atan2(y, x)</span></pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 125, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_arctan2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 125, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_sphere_points, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 125, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_sphere_points, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 125, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_9, __pyx_t_4, __pyx_t_8};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 125, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">126</span>: 	<span class="p">))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-70" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">128</span>: <span class="k">def</span> <span class="nf">angles_to_camera</span><span class="p">(</span><span class="n">angles_points</span><span class="p">,</span> <span class="n">camera_to_target</span><span class="p">):</span></pre>
<pre class='cython code score-70 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_9angles_to_camera(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_8angles_to_camera, "Retrieve the original 3D point in the camera frame from their spheric coordinates angles relative to the camera unit sphere\n\t   - angles_points    : ndarray[2, N] : Spheric coordinates angles (colatitude \316\270, longitude \317\206, the radius is assumed to be 1)\n\t   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points\342\200\231 Z coordinate is null\n\t&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the camera frame");
static PyMethodDef __pyx_mdef_9fish2bird_9angles_to_camera = {"angles_to_camera", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_9angles_to_camera, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_8angles_to_camera};
static PyObject *__pyx_pw_9fish2bird_9angles_to_camera(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_angles_points = 0;
  PyObject *__pyx_v_camera_to_target = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angles_to_camera (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_angles_points,&amp;__pyx_n_s_camera_to_target,0};
    PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_angles_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_target)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angles_to_camera", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "angles_to_camera") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_angles_points = values[0];
    __pyx_v_camera_to_target = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angles_to_camera", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.angles_to_camera", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_8angles_to_camera(__pyx_self, __pyx_v_angles_points, __pyx_v_camera_to_target);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_8angles_to_camera(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_angles_points, PyObject *__pyx_v_camera_to_target) {
  PyObject *__pyx_v_colatitude = NULL;
  PyObject *__pyx_v_longitude = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_v_camera_radius = NULL;
  PyObject *__pyx_v_camera_x = NULL;
  PyObject *__pyx_v_camera_y = NULL;
  PyObject *__pyx_v_camera_z = NULL;
  PyObject *__pyx_v_camera_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angles_to_camera", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.angles_to_camera", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_colatitude);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_longitude);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_a);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_b);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_c);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_d);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_camera_radius);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_camera_x);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_camera_y);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_camera_z);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_camera_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__31 = <span class='py_c_api'>PyTuple_Pack</span>(13, __pyx_n_s_angles_points, __pyx_n_s_camera_to_target, __pyx_n_s_colatitude, __pyx_n_s_longitude, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_c, __pyx_n_s_d, __pyx_n_s_camera_radius, __pyx_n_s_camera_x, __pyx_n_s_camera_y, __pyx_n_s_camera_z, __pyx_n_s_camera_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__31);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__31);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_9angles_to_camera, 0, __pyx_n_s_angles_to_camera, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__32));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_angles_to_camera, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__32 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_angles_to_camera, 128, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 128, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">129</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Retrieve the original 3D point in the camera frame from their spheric coordinates angles relative to the camera unit sphere</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>: <span class="sd">	   - angles_points    : ndarray[2, N] : Spheric coordinates angles (colatitude θ, longitude φ, the radius is assumed to be 1)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>: <span class="sd">	   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points’ Z coordinate is null</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>: <span class="sd">	&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the camera frame&quot;&quot;&quot;</span></pre>
<pre class="cython line score-44" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">133</span>: 	<span class="n">colatitude</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">angles_points</span></pre>
<pre class='cython code score-44 '>  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_v_angles_points))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_v_angles_points))) {
    PyObject* sequence = __pyx_v_angles_points;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    #else
    __pyx_t_1 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    #endif
  } else {
    Py_ssize_t index = -1;
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_v_angles_points);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 133, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_3);
    index = 0; __pyx_t_1 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    index = 1; __pyx_t_2 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_4(__pyx_t_3), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    __pyx_t_4 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_4 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 133, __pyx_L1_error)</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_v_colatitude = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_longitude = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>: 	<span class="c"># When we convert those points in the camera frame to the target frame (camera_to_target @ camera_points),</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: 	<span class="c"># the resulting points have their Z coordinate equal to 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>: 	<span class="c"># So according to the matrix product, aX + bY + cZ + d = 0, with [a, b, c, d] the 3rd row of camera_to_target</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>: 	<span class="c"># (that, multiplied with a point vector, makes its target Z coordinate)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>: 	<span class="c"># Those are our plane’s parameters in the camera frame</span></pre>
<pre class="cython line score-53" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>: 	<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-53 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_camera_to_target, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_2))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_2))) {
    PyObject* sequence = __pyx_t_2;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 4)) {
      if (size &gt; 4) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(4);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
      __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 3); 
    } else {
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
      __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
      __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 3); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[4] = {&amp;__pyx_t_1,&amp;__pyx_t_3,&amp;__pyx_t_5,&amp;__pyx_t_6};
      for (i=0; i &lt; 4; i++) {
        PyObject* item = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, i);<span class='error_goto'> if (unlikely(!item)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(item);
        *(temps[i]) = item;
      }
    }
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    Py_ssize_t index = -1;
    PyObject** temps[4] = {&amp;__pyx_t_1,&amp;__pyx_t_3,&amp;__pyx_t_5,&amp;__pyx_t_6};
    __pyx_t_7 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetIterNextFunc</span>(__pyx_t_7);
    for (index=0; index &lt; 4; index++) {
      PyObject* item = __pyx_t_4(__pyx_t_7); if (unlikely(!item)) goto __pyx_L5_unpacking_failed;
      <span class='refnanny'>__Pyx_GOTREF</span>(item);
      *(temps[index]) = item;
    }
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_4(__pyx_t_7), 4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
    __pyx_t_4 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L6_unpacking_done;
    __pyx_L5_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_4 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
    __pyx_L6_unpacking_done:;
  }
  __pyx_v_a = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_b = __pyx_t_3;
  __pyx_t_3 = 0;
  __pyx_v_c = __pyx_t_5;
  __pyx_t_5 = 0;
  __pyx_v_d = __pyx_t_6;
  __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">141</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: 	<span class="c"># Then we take the system that converts from spheric coordinates to cartesian and add the plane equation,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>: 	<span class="c"># solving it for the radius ρ with the plane equation, then the 3D camera frame coordinates X, Y, Z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>: 	<span class="c"># | X = ρ·sin(θ)·cos(φ)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>: 	<span class="c"># | Y = ρ·sin(θ)·sin(φ)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: 	<span class="c"># | Z = ρ·cos(θ)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: 	<span class="c"># | aX + bY + cZ + d = 0</span></pre>
<pre class="cython line score-150" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">148</span>: 	<span class="n">camera_radius</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">colatitude</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">colatitude</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">colatitude</span><span class="p">))</span></pre>
<pre class='cython code score-150 '>  __pyx_t_2 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_v_d);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_colatitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_a, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_cos);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_longitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_3, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_colatitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_b, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_longitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_7, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_cos);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_colatitude};
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_5, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 148, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_c, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_2, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_camera_radius = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>: 	<span class="n">camera_x</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">colatitude</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_colatitude};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_camera_radius, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_cos);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_longitude};
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 149, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_camera_x = __pyx_t_6;
  __pyx_t_6 = 0;
</pre><pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>: 	<span class="n">camera_y</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">colatitude</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">longitude</span><span class="p">)</span></pre>
<pre class='cython code score-51 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_colatitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_camera_radius, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_sin);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_longitude};
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_7, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) <span class='error_goto'>__PYX_ERR(0, 150, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 150, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_camera_y = __pyx_t_7;
  __pyx_t_7 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>: 	<span class="n">camera_z</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">colatitude</span><span class="p">)</span></pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_cos);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_colatitude};
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 151, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_camera_radius, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_camera_z = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-57" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>: 	<span class="n">camera_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">((</span><span class="n">camera_x</span><span class="p">,</span> <span class="n">camera_y</span><span class="p">,</span> <span class="n">camera_z</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">angles_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">])))</span></pre>
<pre class='cython code score-57 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_asarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_ones);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_angles_points, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_3};
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_1, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_7)) <span class='error_goto'>__PYX_ERR(0, 152, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 152, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_camera_x);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_camera_x);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_camera_x);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_camera_y);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_camera_y);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_camera_y);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_camera_z);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_camera_z);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_v_camera_z);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_1};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 152, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_v_camera_points = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>: 	<span class="k">return</span> <span class="n">camera_points</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_camera_points);
  __pyx_r = __pyx_v_camera_points;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">154</span>: </pre>
<pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>: <span class="k">def</span> <span class="nf">camera_to_target_</span><span class="p">(</span><span class="n">camera_points</span><span class="p">,</span> <span class="n">camera_to_target</span><span class="p">):</span></pre>
<pre class='cython code score-56 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_11camera_to_target_(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_10camera_to_target_, "Convenience function that converts the 3D homogeneous points in the camera frame to the target frame. Only does `camera_to_target @ camera_points`\n\t   - camera_points    : ndarray[4, N] : Homogeneous 3D coordinates of the points in the camera frame\n\t   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points\342\200\231 Z coordinate is null\n\t&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame. All Z coordinates are 0, give or take floating-point shenanigans.");
static PyMethodDef __pyx_mdef_9fish2bird_11camera_to_target_ = {"camera_to_target_", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_11camera_to_target_, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_10camera_to_target_};
static PyObject *__pyx_pw_9fish2bird_11camera_to_target_(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_camera_points = 0;
  PyObject *__pyx_v_camera_to_target = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("camera_to_target_ (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_camera_points,&amp;__pyx_n_s_camera_to_target,0};
    PyObject* values[2] = {0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_target)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("camera_to_target_", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "camera_to_target_") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
    }
    __pyx_v_camera_points = values[0];
    __pyx_v_camera_to_target = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("camera_to_target_", 1, 2, 2, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.camera_to_target_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_10camera_to_target_(__pyx_self, __pyx_v_camera_points, __pyx_v_camera_to_target);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_10camera_to_target_(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_camera_points, PyObject *__pyx_v_camera_to_target) {
  CYTHON_UNUSED PyObject *__pyx_v_target_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("camera_to_target_", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.camera_to_target_", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__33 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_camera_points, __pyx_n_s_camera_to_target, __pyx_n_s_target_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__33);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__33);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_11camera_to_target_, 0, __pyx_n_s_camera_to_target_2, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__34));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_camera_to_target_2, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 155, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__34 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_camera_to_target_2, 155, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">156</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Convenience function that converts the 3D homogeneous points in the camera frame to the target frame. Only does `camera_to_target @ camera_points`</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>: <span class="sd">	   - camera_points    : ndarray[4, N] : Homogeneous 3D coordinates of the points in the camera frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>: <span class="sd">	   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points’ Z coordinate is null</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>: <span class="sd">	&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame. All Z coordinates are 0, give or take floating-point shenanigans.&quot;&quot;&quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>: 	<span class="n">target_points</span> <span class="o">=</span> <span class="n">camera_to_target</span> <span class="err">@</span> <span class="n">camera_points</span></pre>
<pre class='cython code score-2 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyNumber_MatrixMultiply</span>(__pyx_v_camera_to_target, __pyx_v_camera_points);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_target_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">161</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>: <span class="c">#### ---------- GAS GAS GAS ---------- ####</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_postprocess_gray</span><span class="p">(</span><span class="n">uint8_t</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">output_image</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>static void __pyx_f_9fish2bird__postprocess_gray(__Pyx_memviewslice __pyx_v_output_image) {
  Py_ssize_t __pyx_v_width;
  Py_ssize_t __pyx_v_height;
  Py_ssize_t __pyx_v_x;
  Py_ssize_t __pyx_v_y;
  Py_ssize_t __pyx_v_inter;
  Py_ssize_t __pyx_v_last_index;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  #ifdef WITH_THREAD
  __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._postprocess_gray", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">170</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Quick-and-dirty bilinear filtering. Unused now&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">171</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">width</span> <span class="o">=</span> <span class="n">output_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">height</span> <span class="o">=</span> <span class="n">output_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_width = (__pyx_v_output_image.shape[1]);
  __pyx_v_height = (__pyx_v_output_image.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">x</span><span class="p">,</span> <span class="nf">y</span><span class="p">,</span> <span class="nf">inter</span><span class="p">,</span> <span class="nf">last_index</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_last_index = -1L;
</pre><pre class="cython line score-0">&#xA0;<span class="">173</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">174</span>: 	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_width;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_x = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>: 		<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_height;
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_y = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>: 			<span class="k">if</span> <span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_y;
      __pyx_t_8 = __pyx_v_x;
      __pyx_t_9 = ((*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_7 * __pyx_v_output_image.strides[0]) ) + __pyx_t_8 * __pyx_v_output_image.strides[1]) ))) &gt; 0);
      if (__pyx_t_9) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>: 				<span class="k">if</span> <span class="n">last_index</span> <span class="o">&gt;=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = (__pyx_v_last_index &gt;= 0);
        if (__pyx_t_9) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>: 					<span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_y;
          __pyx_t_11 = __pyx_t_10;
          for (__pyx_t_12 = (__pyx_v_last_index + 1); __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
            __pyx_v_inter = __pyx_t_12;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>: 						<span class="n">output_image</span><span class="p">[</span><span class="n">inter</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">uint8_t</span><span class="o">&gt;</span><span class="p">((</span><span class="mf">1</span> <span class="o">-</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;(</span><span class="n">inter</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">))</span> <span class="o">*</span> <span class="n">output_image</span><span class="p">[</span><span class="n">last_index</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;((</span><span class="n">inter</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">))</span> <span class="o">*</span> <span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span></pre>
<pre class='cython code score-18 '>            __pyx_t_13 = ((double)(__pyx_v_inter - __pyx_v_last_index));
            __pyx_t_14 = (__pyx_v_y - __pyx_v_last_index);
            if (unlikely(__pyx_t_14 == 0)) {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
              #ifdef WITH_THREAD
              <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
              #endif
              <span class='error_goto'>__PYX_ERR(0, 179, __pyx_L1_error)</span>
            }
            __pyx_t_8 = __pyx_v_last_index;
            __pyx_t_7 = __pyx_v_x;
            __pyx_t_15 = (__pyx_v_inter - __pyx_v_last_index);
            __pyx_t_16 = (__pyx_v_y - __pyx_v_last_index);
            if (unlikely(__pyx_t_16 == 0)) {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
              #ifdef WITH_THREAD
              <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
              #endif
              <span class='error_goto'>__PYX_ERR(0, 179, __pyx_L1_error)</span>
            }
            __pyx_t_17 = __pyx_v_y;
            __pyx_t_18 = __pyx_v_x;
            __pyx_t_19 = __pyx_v_inter;
            __pyx_t_20 = __pyx_v_x;
            *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_19 * __pyx_v_output_image.strides[0]) ) + __pyx_t_20 * __pyx_v_output_image.strides[1]) )) = ((__pyx_t_5numpy_uint8_t)(((1.0 - (__pyx_t_13 / ((double)__pyx_t_14))) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_8 * __pyx_v_output_image.strides[0]) ) + __pyx_t_7 * __pyx_v_output_image.strides[1]) )))) + (((double)(((double)__pyx_t_15) / ((double)__pyx_t_16))) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_17 * __pyx_v_output_image.strides[0]) ) + __pyx_t_18 * __pyx_v_output_image.strides[1]) ))))));
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">180</span>: 				<span class="n">last_index</span> <span class="o">=</span> <span class="n">y</span></pre>
<pre class='cython code score-0 '>        __pyx_v_last_index = __pyx_v_y;
</pre><pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>: 	<span class="n">last_index</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_last_index = -1L;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>: 	<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_height;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_y = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>: 		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_width;
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_x = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>: 			<span class="k">if</span> <span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_y;
      __pyx_t_17 = __pyx_v_x;
      __pyx_t_9 = ((*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_18 * __pyx_v_output_image.strides[0]) ) + __pyx_t_17 * __pyx_v_output_image.strides[1]) ))) &gt; 0);
      if (__pyx_t_9) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>: 				<span class="k">if</span> <span class="n">last_index</span> <span class="o">&gt;=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = (__pyx_v_last_index &gt;= 0);
        if (__pyx_t_9) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>: 					<span class="k">for</span> <span class="n">inter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_index</span> <span class="o">+</span> <span class="mf">1</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_x;
          __pyx_t_11 = __pyx_t_10;
          for (__pyx_t_12 = (__pyx_v_last_index + 1); __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
            __pyx_v_inter = __pyx_t_12;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>: 						<span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">inter</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">uint8_t</span><span class="o">&gt;</span><span class="p">((</span><span class="mf">1</span> <span class="o">-</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;(</span><span class="n">inter</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">))</span> <span class="o">*</span> <span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">last_index</span><span class="p">]</span> <span class="o">+</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;((</span><span class="n">inter</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">last_index</span><span class="p">))</span> <span class="o">*</span> <span class="n">output_image</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span></pre>
<pre class='cython code score-18 '>            __pyx_t_13 = ((double)(__pyx_v_inter - __pyx_v_last_index));
            __pyx_t_16 = (__pyx_v_x - __pyx_v_last_index);
            if (unlikely(__pyx_t_16 == 0)) {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
              #ifdef WITH_THREAD
              <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
              #endif
              <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
            }
            __pyx_t_17 = __pyx_v_y;
            __pyx_t_18 = __pyx_v_last_index;
            __pyx_t_15 = (__pyx_v_inter - __pyx_v_last_index);
            __pyx_t_14 = (__pyx_v_x - __pyx_v_last_index);
            if (unlikely(__pyx_t_14 == 0)) {
              #ifdef WITH_THREAD
              PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
              #endif
              <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
              #ifdef WITH_THREAD
              <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
              #endif
              <span class='error_goto'>__PYX_ERR(0, 188, __pyx_L1_error)</span>
            }
            __pyx_t_7 = __pyx_v_y;
            __pyx_t_8 = __pyx_v_x;
            __pyx_t_20 = __pyx_v_y;
            __pyx_t_19 = __pyx_v_inter;
            *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_20 * __pyx_v_output_image.strides[0]) ) + __pyx_t_19 * __pyx_v_output_image.strides[1]) )) = ((__pyx_t_5numpy_uint8_t)(((1.0 - (__pyx_t_13 / ((double)__pyx_t_16))) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_17 * __pyx_v_output_image.strides[0]) ) + __pyx_t_18 * __pyx_v_output_image.strides[1]) )))) + (((double)(((double)__pyx_t_15) / ((double)__pyx_t_14))) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_image.data + __pyx_t_7 * __pyx_v_output_image.strides[0]) ) + __pyx_t_8 * __pyx_v_output_image.strides[1]) ))))));
          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>: 				<span class="n">last_index</span> <span class="o">=</span> <span class="n">x</span></pre>
<pre class='cython code score-0 '>        __pyx_v_last_index = __pyx_v_x;
</pre><pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">194</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_image_to_target</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">image_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_target</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">)</span> <span class="n">noexcept</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>static void __pyx_f_9fish2bird__image_to_target(__Pyx_memviewslice __pyx_v_image_points, __Pyx_memviewslice __pyx_v_target_points, __Pyx_memviewslice __pyx_v_camera_to_image, __Pyx_memviewslice __pyx_v_camera_to_target, double __pyx_v_xi) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_npoints;
  double __pyx_v_inverse_camera_matrix[2][3];
  double __pyx_v_a;
  double __pyx_v_b;
  double __pyx_v_c;
  double __pyx_v_d;
  double __pyx_v_projected_x;
  double __pyx_v_projected_y;
  double __pyx_v_projected_square;
  double __pyx_v_sphere_factor;
  double __pyx_v_sphere_x;
  double __pyx_v_sphere_y;
  double __pyx_v_sphere_z;
  double __pyx_v_sin_colatitude;
  double __pyx_v_sin_longitude;
  double __pyx_v_cos_longitude;
  double __pyx_v_camera_radius;
  double __pyx_v_camera_x;
  double __pyx_v_camera_y;
  double __pyx_v_camera_z;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_image_to_target", 0);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._image_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">195</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Internal : Convert 2D points from the input camera image to 3D points in the target plane. See `image_to_target`&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">npoints</span> <span class="o">=</span> <span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_image_points.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">197</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">198</span>: 	<span class="c"># Compute the inverse of the camera matrix. As it is an upper-triangular matrix with 1 at [2, 2], a few optimisations can be performed</span></pre>
<pre class="cython line score-15" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">199</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[2][3] <span class="nf">inverse_camera_matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1</span> <span class="o">/</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="o">-</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">])],</span></pre>
<pre class='cython code score-15 '>  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_3 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_1 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_2 * __pyx_v_camera_to_image.strides[1]) )));
  if (unlikely(__pyx_t_3 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_t_2 = 0;
  __pyx_t_1 = 1;
  __pyx_t_4 = (-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_2 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_1 * __pyx_v_camera_to_image.strides[1]) ))));
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_5 = 1;
  __pyx_t_6 = 1;
  __pyx_t_7 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_1 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_2 * __pyx_v_camera_to_image.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_5 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_6 * __pyx_v_camera_to_image.strides[1]) ))));
  if (unlikely(__pyx_t_7 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_t_6 = 0;
  __pyx_t_5 = 1;
  __pyx_t_2 = 1;
  __pyx_t_1 = 2;
  __pyx_t_8 = 0;
  __pyx_t_9 = 2;
  __pyx_t_10 = 1;
  __pyx_t_11 = 1;
  __pyx_t_12 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_6 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_5 * __pyx_v_camera_to_image.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_2 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_1 * __pyx_v_camera_to_image.strides[1]) )))) - ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_8 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_image.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_10 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_11 * __pyx_v_camera_to_image.strides[1]) )))));
  __pyx_t_11 = 0;
  __pyx_t_10 = 0;
  __pyx_t_9 = 1;
  __pyx_t_8 = 1;
  __pyx_t_13 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_11 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_10 * __pyx_v_camera_to_image.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_9 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_image.strides[1]) ))));
  if (unlikely(__pyx_t_13 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 199, __pyx_L1_error)</span>
  }
  __pyx_t_14[0] = (1.0 / __pyx_t_3);
  __pyx_t_14[1] = (__pyx_t_4 / __pyx_t_7);
  __pyx_t_14[2] = (__pyx_t_12 / __pyx_t_13);
/* … */
  memcpy(&amp;(__pyx_t_16[0]), __pyx_t_14, sizeof(__pyx_t_16[0]));
  memcpy(&amp;(__pyx_t_16[1]), __pyx_t_15, sizeof(__pyx_t_16[0]));
  memcpy(&amp;(__pyx_v_inverse_camera_matrix[0]), __pyx_t_16, sizeof(__pyx_v_inverse_camera_matrix[0]) * (2));
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>: 	                                           <span class="p">[</span><span class="mf">0</span>                        <span class="p">,</span> <span class="mf">1</span> <span class="o">/</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span>                                               <span class="p">,</span> <span class="o">-</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span>                                                                                             <span class="p">]]</span></pre>
<pre class='cython code score-10 '>  __pyx_t_8 = 1;
  __pyx_t_9 = 1;
  __pyx_t_13 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_8 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_image.strides[1]) )));
  if (unlikely(__pyx_t_13 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
  }
  __pyx_t_9 = 1;
  __pyx_t_8 = 2;
  __pyx_t_12 = (-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_9 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_image.strides[1]) ))));
  __pyx_t_8 = 1;
  __pyx_t_9 = 1;
  __pyx_t_7 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_8 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_image.strides[1]) )));
  if (unlikely(__pyx_t_7 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 200, __pyx_L1_error)</span>
  }
  __pyx_t_15[0] = 0.0;
  __pyx_t_15[1] = (1.0 / __pyx_t_13);
  __pyx_t_15[2] = (__pyx_t_12 / __pyx_t_7);
</pre><pre class="cython line score-0">&#xA0;<span class="">201</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">a</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="n">d</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_9 = 2;
  __pyx_t_8 = 0;
  __pyx_v_a = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_9 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_target.strides[1]) )));
  __pyx_t_8 = 2;
  __pyx_t_9 = 1;
  __pyx_v_b = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_8 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_target.strides[1]) )));
  __pyx_t_9 = 2;
  __pyx_t_8 = 2;
  __pyx_v_c = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_9 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_target.strides[1]) )));
  __pyx_t_8 = 2;
  __pyx_t_9 = 3;
  __pyx_v_d = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_8 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_target.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">203</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">projected_x</span><span class="p">,</span> <span class="nf">projected_y</span><span class="p">,</span> <span class="nf">projected_square</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sphere_factor</span><span class="p">,</span> <span class="nf">sphere_x</span><span class="p">,</span> <span class="nf">sphere_y</span><span class="p">,</span> <span class="nf">sphere_z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sin_colatitude</span><span class="p">,</span> <span class="nf">sin_longitude</span><span class="p">,</span> <span class="nf">cos_longitude</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">camera_radius</span><span class="p">,</span> <span class="nf">camera_x</span><span class="p">,</span> <span class="nf">camera_y</span><span class="p">,</span> <span class="nf">camera_z</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_17 = __pyx_v_npoints;
  __pyx_t_18 = __pyx_t_17;
  for (__pyx_t_19 = 0; __pyx_t_19 &lt; __pyx_t_18; __pyx_t_19+=1) {
    __pyx_v_i = __pyx_t_19;
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>: 		<span class="c"># Convert image pixel coordinates to metric coordinates on the sensor plane (inverse_camera_matrix @ (x, y))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>: 		<span class="n">projected_x</span> <span class="o">=</span> <span class="n">image_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">0</span><span class="p">][</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">image_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">0</span><span class="p">][</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">0</span><span class="p">][</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = 0;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_10 = 1;
    __pyx_t_11 = __pyx_v_i;
    __pyx_v_projected_x = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_9 * __pyx_v_image_points.strides[0]) ) + __pyx_t_8 * __pyx_v_image_points.strides[1]) ))) * ((__pyx_v_inverse_camera_matrix[0])[0])) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_10 * __pyx_v_image_points.strides[0]) ) + __pyx_t_11 * __pyx_v_image_points.strides[1]) ))) * ((__pyx_v_inverse_camera_matrix[0])[1]))) + ((__pyx_v_inverse_camera_matrix[0])[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>: 		<span class="n">projected_y</span> <span class="o">=</span> <span class="n">image_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">1</span><span class="p">][</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">image_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">1</span><span class="p">][</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">inverse_camera_matrix</span><span class="p">[</span><span class="mf">1</span><span class="p">][</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 0;
    __pyx_t_10 = __pyx_v_i;
    __pyx_t_8 = 1;
    __pyx_t_9 = __pyx_v_i;
    __pyx_v_projected_y = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_11 * __pyx_v_image_points.strides[0]) ) + __pyx_t_10 * __pyx_v_image_points.strides[1]) ))) * ((__pyx_v_inverse_camera_matrix[1])[0])) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_8 * __pyx_v_image_points.strides[0]) ) + __pyx_t_9 * __pyx_v_image_points.strides[1]) ))) * ((__pyx_v_inverse_camera_matrix[1])[1]))) + ((__pyx_v_inverse_camera_matrix[1])[2]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">211</span>: 		<span class="n">projected_square</span> <span class="o">=</span> <span class="n">projected_x</span><span class="o">**</span><span class="mf">2</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">**</span><span class="mf">2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_projected_square = (pow(__pyx_v_projected_x, 2.0) + pow(__pyx_v_projected_y, 2.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">212</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>: 		<span class="c"># Project onto the unit sphere, using the equations in Christopher Mei’s paper</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>: 		<span class="n">sphere_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">xi</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">xi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">*</span><span class="n">projected_square</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">projected_square</span> <span class="o">+</span> <span class="mf">1</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_7 = (__pyx_v_xi + sqrt((1.0 + ((1.0 - (__pyx_v_xi * __pyx_v_xi)) * __pyx_v_projected_square))));
    __pyx_t_12 = (__pyx_v_projected_square + 1.0);
    if (unlikely(__pyx_t_12 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 214, __pyx_L1_error)</span>
    }
    __pyx_v_sphere_factor = (__pyx_t_7 / __pyx_t_12);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">215</span>: 		<span class="n">sphere_x</span> <span class="o">=</span> <span class="n">projected_x</span> <span class="o">*</span> <span class="n">sphere_factor</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sphere_x = (__pyx_v_projected_x * __pyx_v_sphere_factor);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>: 		<span class="n">sphere_y</span> <span class="o">=</span> <span class="n">projected_y</span> <span class="o">*</span> <span class="n">sphere_factor</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sphere_y = (__pyx_v_projected_y * __pyx_v_sphere_factor);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">217</span>: 		<span class="n">sphere_z</span> <span class="o">=</span> <span class="n">sphere_factor</span> <span class="o">-</span> <span class="n">xi</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sphere_z = (__pyx_v_sphere_factor - __pyx_v_xi);
</pre><pre class="cython line score-0">&#xA0;<span class="">218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>: 		<span class="c"># Basically, convert cartesian coordinates at the surface of the unit sphere to spheric coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>: 		<span class="c"># But as those are arccos and arctans and we only reuse the sin() and cos() of those values afterwards,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>: 		<span class="c"># we can save some time and complexity by calculating those subresults directly</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>: 		<span class="n">sin_colatitude</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">sphere_z</span><span class="o">*</span><span class="n">sphere_z</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sin_colatitude = sqrt((1.0 - (__pyx_v_sphere_z * __pyx_v_sphere_z)));
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">223</span>: 		<span class="n">sin_longitude</span> <span class="o">=</span> <span class="n">sphere_y</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sphere_x</span><span class="o">*</span><span class="n">sphere_x</span> <span class="o">+</span> <span class="n">sphere_y</span><span class="o">*</span><span class="n">sphere_y</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_12 = sqrt(((__pyx_v_sphere_x * __pyx_v_sphere_x) + (__pyx_v_sphere_y * __pyx_v_sphere_y)));
    if (unlikely(__pyx_t_12 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 223, __pyx_L1_error)</span>
    }
    __pyx_v_sin_longitude = (__pyx_v_sphere_y / __pyx_t_12);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">224</span>: 		<span class="n">cos_longitude</span> <span class="o">=</span> <span class="n">sphere_x</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sphere_x</span><span class="o">*</span><span class="n">sphere_x</span> <span class="o">+</span> <span class="n">sphere_y</span><span class="o">*</span><span class="n">sphere_y</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_12 = sqrt(((__pyx_v_sphere_x * __pyx_v_sphere_x) + (__pyx_v_sphere_y * __pyx_v_sphere_y)));
    if (unlikely(__pyx_t_12 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 224, __pyx_L1_error)</span>
    }
    __pyx_v_cos_longitude = (__pyx_v_sphere_x / __pyx_t_12);
</pre><pre class="cython line score-0">&#xA0;<span class="">225</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>: 		<span class="c"># Solve the projection equations to get the cartesian point in the camera frame using the spheric coordinates and the target plane</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">227</span>: 		<span class="n">camera_radius</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">sin_colatitude</span><span class="o">*</span><span class="n">cos_longitude</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">sin_colatitude</span><span class="o">*</span><span class="n">sin_longitude</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">sphere_z</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_12 = (-__pyx_v_d);
    __pyx_t_7 = ((((__pyx_v_a * __pyx_v_sin_colatitude) * __pyx_v_cos_longitude) + ((__pyx_v_b * __pyx_v_sin_colatitude) * __pyx_v_sin_longitude)) + (__pyx_v_c * __pyx_v_sphere_z));
    if (unlikely(__pyx_t_7 == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 227, __pyx_L1_error)</span>
    }
    __pyx_v_camera_radius = (__pyx_t_12 / __pyx_t_7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">228</span>: 		<span class="n">camera_x</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">sin_colatitude</span> <span class="o">*</span> <span class="n">cos_longitude</span></pre>
<pre class='cython code score-0 '>    __pyx_v_camera_x = ((__pyx_v_camera_radius * __pyx_v_sin_colatitude) * __pyx_v_cos_longitude);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">229</span>: 		<span class="n">camera_y</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">sin_colatitude</span> <span class="o">*</span> <span class="n">sin_longitude</span></pre>
<pre class='cython code score-0 '>    __pyx_v_camera_y = ((__pyx_v_camera_radius * __pyx_v_sin_colatitude) * __pyx_v_sin_longitude);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">230</span>: 		<span class="n">camera_z</span> <span class="o">=</span> <span class="n">camera_radius</span> <span class="o">*</span> <span class="n">sphere_z</span></pre>
<pre class='cython code score-0 '>    __pyx_v_camera_z = (__pyx_v_camera_radius * __pyx_v_sphere_z);
</pre><pre class="cython line score-0">&#xA0;<span class="">231</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>: 		<span class="c"># Project to the target frame (matrix product camera_to_target @ (camera_x, camera_y, camera_z))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>: 		<span class="c"># No need to compute target_z as it is assumed to be 0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">234</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_x</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_y</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_z</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = 0;
    __pyx_t_8 = 0;
    __pyx_t_10 = 0;
    __pyx_t_11 = 1;
    __pyx_t_1 = 0;
    __pyx_t_2 = 2;
    __pyx_t_5 = 0;
    __pyx_t_6 = 3;
    __pyx_t_20 = 0;
    __pyx_t_21 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_20 * __pyx_v_target_points.strides[0]) ) + __pyx_t_21 * __pyx_v_target_points.strides[1]) )) = (((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_9 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_x) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_10 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_11 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_y)) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_1 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_2 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_z)) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_5 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_6 * __pyx_v_camera_to_target.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">235</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_x</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_y</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">camera_z</span> <span class="o">+</span> <span class="n">camera_to_target</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_5 = 0;
    __pyx_t_2 = 1;
    __pyx_t_1 = 1;
    __pyx_t_11 = 1;
    __pyx_t_10 = 2;
    __pyx_t_8 = 1;
    __pyx_t_9 = 3;
    __pyx_t_21 = 1;
    __pyx_t_20 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_21 * __pyx_v_target_points.strides[0]) ) + __pyx_t_20 * __pyx_v_target_points.strides[1]) )) = (((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_6 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_5 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_x) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_2 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_1 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_y)) + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_11 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_10 * __pyx_v_camera_to_target.strides[1]) ))) * __pyx_v_camera_z)) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_target.data + __pyx_t_8 * __pyx_v_camera_to_target.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_target.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">236</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = 2;
    __pyx_t_8 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_9 * __pyx_v_target_points.strides[0]) ) + __pyx_t_8 * __pyx_v_target_points.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = 3;
    __pyx_t_9 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_8 * __pyx_v_target_points.strides[0]) ) + __pyx_t_9 * __pyx_v_target_points.strides[1]) )) = 1.0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">238</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">240</span>: <span class="k">def</span> <span class="nf">image_to_target</span><span class="p">(</span><span class="n">image_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_target</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_13image_to_target(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_12image_to_target, "Directly calculate the 3D coordinates in the target frame of the given points in input image pixel coordinates\n\t   - image_points     : ndarray[2, N] : Pixel coordinates in the image (vectors as columns)\n\t   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates\n\t   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points\342\200\231 Z coordinate is null\n\t   - xi               : float         : Mei\342\200\231s model center shifting parameter (\316\276 in his paper)\n\t&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame. All Z coordinates are 0, give or take floating-point shenanigans.");
static PyMethodDef __pyx_mdef_9fish2bird_13image_to_target = {"image_to_target", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_13image_to_target, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_12image_to_target};
static PyObject *__pyx_pw_9fish2bird_13image_to_target(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_image_points = 0;
  __Pyx_memviewslice __pyx_v_camera_to_image = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_camera_to_target = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_xi;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("image_to_target (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_image_points,&amp;__pyx_n_s_camera_to_image,&amp;__pyx_n_s_camera_to_target,&amp;__pyx_n_s_xi,0};
    PyObject* values[4] = {0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_image_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_target", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_target)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_target", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xi)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_target", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "image_to_target") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 4)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
    }
    __pyx_v_image_points = values[0];
    __pyx_v_camera_to_image = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_camera_to_image.memview)) __PYX_ERR(0, 240, __pyx_L3_error)</span>
    __pyx_v_camera_to_target = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_camera_to_target.memview)) __PYX_ERR(0, 240, __pyx_L3_error)</span>
    __pyx_v_xi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_xi == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("image_to_target", 1, 4, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L3_error)</span>
  __pyx_L3_error:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_target, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.image_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_12image_to_target(__pyx_self, __pyx_v_image_points, __pyx_v_camera_to_image, __pyx_v_camera_to_target, __pyx_v_xi);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_target, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_12image_to_target(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_image_points, __Pyx_memviewslice __pyx_v_camera_to_image, __Pyx_memviewslice __pyx_v_camera_to_target, double __pyx_v_xi) {
  PyObject *__pyx_v_target_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("image_to_target", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.image_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__35 = <span class='py_c_api'>PyTuple_Pack</span>(5, __pyx_n_s_image_points, __pyx_n_s_camera_to_image, __pyx_n_s_camera_to_target, __pyx_n_s_xi, __pyx_n_s_target_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__35);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__35);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_13image_to_target, 0, __pyx_n_s_image_to_target, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__36));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_image_to_target, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__36 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_image_to_target, 240, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">241</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Directly calculate the 3D coordinates in the target frame of the given points in input image pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>: <span class="sd">	   - image_points     : ndarray[2, N] : Pixel coordinates in the image (vectors as columns)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: <span class="sd">	   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>: <span class="sd">	   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points’ Z coordinate is null</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>: <span class="sd">	   - xi               : float         : Mei’s model center shifting parameter (ξ in his paper)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>: <span class="sd">	&lt;---------------------- ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame. All Z coordinates are 0, give or take floating-point shenanigans.&quot;&quot;&quot;</span></pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>: 	<span class="n">target_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">4</span><span class="p">,</span> <span class="n">image_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image_points, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_int_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 247, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_target_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>: 	<span class="n">_image_to_target</span><span class="p">(</span><span class="n">image_points</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">camera_to_target</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span></pre>
<pre class='cython code score-21 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image_points, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, ((PyObject *)(&amp;PyFloat_Type))};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_target_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
  __pyx_f_9fish2bird__image_to_target(__pyx_t_6, __pyx_t_7, __pyx_v_camera_to_image, __pyx_v_camera_to_target, __pyx_v_xi);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL; __pyx_t_6.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  __pyx_t_7.memview = NULL; __pyx_t_7.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>: 	<span class="k">return</span> <span class="n">target_points</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_target_points);
  __pyx_r = __pyx_v_target_points;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">250</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">_target_to_output</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">output_points</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_max</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_max</span><span class="p">,</span> <span class="nb">int</span> <span class="n">output_height</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_x</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_y</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>static double __pyx_f_9fish2bird__target_to_output(__Pyx_memviewslice __pyx_v_target_points, __Pyx_memviewslice __pyx_v_output_points, double __pyx_v_x_range_min, double __pyx_v_x_range_max, double __pyx_v_y_range_min, double __pyx_v_y_range_max, int __pyx_v_output_height, int __pyx_v_flip_x, int __pyx_v_flip_y) {
  double __pyx_v_scale_factor;
  int __pyx_v_output_width;
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_npoints;
  double __pyx_v_output_x;
  double __pyx_v_output_y;
  double __pyx_r;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  #ifdef WITH_THREAD
  __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._target_to_output", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">254</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Internal : Convert points from the target plane to 2D bird-eye view pixel coordinates. See `target_to_output`&quot;&quot;&quot;</span></pre>
<pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">255</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">scale_factor</span> <span class="o">=</span> <span class="n">output_height</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_range_max</span> <span class="o">-</span> <span class="n">y_range_min</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>  __pyx_t_1 = (__pyx_v_y_range_max - __pyx_v_y_range_min);
  if (unlikely(__pyx_t_1 == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>__PYX_ERR(0, 255, __pyx_L1_error)</span>
  }
  __pyx_v_scale_factor = (((double)__pyx_v_output_height) / __pyx_t_1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>: 	<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">output_width</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;((</span><span class="n">x_range_max</span> <span class="o">-</span> <span class="n">x_range_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_output_width = ((int)((__pyx_v_x_range_max - __pyx_v_x_range_min) * __pyx_v_scale_factor));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">257</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">npoints</span> <span class="o">=</span> <span class="n">target_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_target_points.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">258</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">output_x</span><span class="p">,</span> <span class="nf">output_y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>: 	<span class="c"># This is just a scaling, and flipping if needed</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_npoints;
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">261</span>: 		<span class="n">output_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_range_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_i;
    __pyx_v_output_x = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_5 * __pyx_v_target_points.strides[0]) ) + __pyx_t_6 * __pyx_v_target_points.strides[1]) ))) - __pyx_v_x_range_min) * __pyx_v_scale_factor);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">262</span>: 		<span class="n">output_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_range_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_output_y = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_6 * __pyx_v_target_points.strides[0]) ) + __pyx_t_5 * __pyx_v_target_points.strides[1]) ))) - __pyx_v_y_range_min) * __pyx_v_scale_factor);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>: 		<span class="k">if</span> <span class="n">flip_x</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    if (__pyx_v_flip_x) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">264</span>: 			<span class="n">output_x</span> <span class="o">=</span> <span class="n">output_width</span> <span class="o">-</span> <span class="n">output_x</span></pre>
<pre class='cython code score-0 '>      __pyx_v_output_x = (__pyx_v_output_width - __pyx_v_output_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>: 		<span class="k">if</span> <span class="n">flip_y</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    if (__pyx_v_flip_y) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>: 			<span class="n">output_y</span> <span class="o">=</span> <span class="n">output_height</span> <span class="o">-</span> <span class="n">output_y</span></pre>
<pre class='cython code score-0 '>      __pyx_v_output_y = (__pyx_v_output_height - __pyx_v_output_y);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">267</span>: 		<span class="n">output_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_x</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_points.data + __pyx_t_5 * __pyx_v_output_points.strides[0]) ) + __pyx_t_6 * __pyx_v_output_points.strides[1]) )) = __pyx_v_output_x;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>: 		<span class="n">output_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_y</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_output_points.data + __pyx_t_6 * __pyx_v_output_points.strides[0]) ) + __pyx_t_5 * __pyx_v_output_points.strides[1]) )) = __pyx_v_output_y;
  }
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>: 	<span class="k">return</span> <span class="mf">1</span><span class="o">/</span><span class="n">scale_factor</span></pre>
<pre class='cython code score-9 '>  if (unlikely(__pyx_v_scale_factor == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>__PYX_ERR(0, 269, __pyx_L1_error)</span>
  }
  __pyx_r = (1.0 / __pyx_v_scale_factor);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">270</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-145" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>: <span class="k">def</span> <span class="nf">target_to_output</span><span class="p">(</span><span class="n">target_points</span><span class="p">,</span> <span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span> <span class="n">x_range</span><span class="p">,</span> <span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span> <span class="n">y_range</span><span class="p">,</span> <span class="nb">Py_ssize_t</span> <span class="n">output_size_y</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_x</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_y</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre>
<pre class='cython code score-145 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_15target_to_output(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_14target_to_output, "Make a bird-eye view image from the points in the target frame.\n\t   Make an orthogonal projection relative to the target Z axis (so parallel to the target plane)\n\t   Warning : the resulting coordinates are not rounded to integers and may lie outside of the image\n\t   - target_points : ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame\n\t   - x_range       : [xmin, xmax]  : Metric range to display on the image\342\200\231s x axis (for instance, [-25, 25] makes an image that shows all points within 25 meters on each side of the origin)\n\t   - y_range       : [ymin, ymax]  : Metric range to display on the image\342\200\231s y axis (for instance, [0, 50] makes an image that shows all points from the origin to 50 meters forward)\n\t   - output_size_y : int           : Height of the output image in pixels. The width is calculated accordingly to scale points right\n\t   - flip_x=False  : bool          : If `True`, reverse the X axis\n\t   - flip_y=False  : bool          : If `True`, reverse the Y axis\n\t&lt;------------------- ndarray[2, N] : Pixel coordinates of the given points for the output image described by the parameters\n\t&lt;------------------- float         : Scale factor from pixels to metric (pixels \303\227 scale_factor = metric. If flip_x or flip_y are set, don\342\200\231t forget to flip it back beforhand, scale_factor * (height-y) or scale_factor * (width-x)\n\t");
static PyMethodDef __pyx_mdef_9fish2bird_15target_to_output = {"target_to_output", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_15target_to_output, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_14target_to_output};
static PyObject *__pyx_pw_9fish2bird_15target_to_output(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_target_points = 0;
  __pyx_ctuple_double__and_double __pyx_v_x_range;
  __pyx_ctuple_double__and_double __pyx_v_y_range;
  Py_ssize_t __pyx_v_output_size_y;
  int __pyx_v_flip_x;
  int __pyx_v_flip_y;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("target_to_output (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_target_points,&amp;__pyx_n_s_x_range,&amp;__pyx_n_s_y_range,&amp;__pyx_n_s_output_size_y,&amp;__pyx_n_s_flip_x,&amp;__pyx_n_s_flip_y,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_output", 0, 4, 6, 1); <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_output", 0, 4, 6, 2); <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_output_size_y)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_output", 0, 4, 6, 3); <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_x);
          if (value) { values[4] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_y);
          if (value) { values[5] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "target_to_output") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_target_points = values[0];
    __pyx_v_x_range = <span class='pyx_c_api'>__pyx_convert__from_py___pyx_ctuple_double__and_double</span>(values[1]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 272, __pyx_L3_error)</span>
    __pyx_v_y_range = <span class='pyx_c_api'>__pyx_convert__from_py___pyx_ctuple_double__and_double</span>(values[2]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 272, __pyx_L3_error)</span>
    __pyx_v_output_size_y = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(values[3]); if (unlikely((__pyx_v_output_size_y == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
    if (values[4]) {
      __pyx_v_flip_x = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[4]); if (unlikely((__pyx_v_flip_x == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
    } else {
      __pyx_v_flip_x = ((int)((int)0));
    }
    if (values[5]) {
      __pyx_v_flip_y = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[5]); if (unlikely((__pyx_v_flip_y == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
    } else {
      __pyx_v_flip_y = ((int)((int)0));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_output", 0, 4, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.target_to_output", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_14target_to_output(__pyx_self, __pyx_v_target_points, __pyx_v_x_range, __pyx_v_y_range, __pyx_v_output_size_y, __pyx_v_flip_x, __pyx_v_flip_y);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_14target_to_output(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_target_points, __pyx_ctuple_double__and_double __pyx_v_x_range, __pyx_ctuple_double__and_double __pyx_v_y_range, Py_ssize_t __pyx_v_output_size_y, int __pyx_v_flip_x, int __pyx_v_flip_y) {
  PyObject *__pyx_v_output_points = NULL;
  double __pyx_v_scale_factor;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("target_to_output", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.target_to_output", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_output_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__37 = <span class='py_c_api'>PyTuple_Pack</span>(8, __pyx_n_s_target_points, __pyx_n_s_x_range, __pyx_n_s_y_range, __pyx_n_s_output_size_y, __pyx_n_s_flip_x, __pyx_n_s_flip_y, __pyx_n_s_output_points, __pyx_n_s_scale_factor);<span class='error_goto'> if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__37);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__37);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_7 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_15target_to_output, 0, __pyx_n_s_target_to_output, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__38));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_target_to_output, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 272, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_codeobj__38 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_target_to_output, 272, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 272, __pyx_L1_error)</span>
/* … */
struct __pyx_ctuple_double__and_double {
  double f0;
  double f1;
};
</pre><pre class="cython line score-0">&#xA0;<span class="">273</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Make a bird-eye view image from the points in the target frame.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>: <span class="sd">	   Make an orthogonal projection relative to the target Z axis (so parallel to the target plane)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>: <span class="sd">	   Warning : the resulting coordinates are not rounded to integers and may lie outside of the image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: <span class="sd">	   - target_points : ndarray[4, N] : Homogeneous 3D coordinates of the points in the target frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>: <span class="sd">	   - x_range       : [xmin, xmax]  : Metric range to display on the image’s x axis (for instance, [-25, 25] makes an image that shows all points within 25 meters on each side of the origin)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>: <span class="sd">	   - y_range       : [ymin, ymax]  : Metric range to display on the image’s y axis (for instance, [0, 50] makes an image that shows all points from the origin to 50 meters forward)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>: <span class="sd">	   - output_size_y : int           : Height of the output image in pixels. The width is calculated accordingly to scale points right</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>: <span class="sd">	   - flip_x=False  : bool          : If `True`, reverse the X axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>: <span class="sd">	   - flip_y=False  : bool          : If `True`, reverse the Y axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>: <span class="sd">	&lt;------------------- ndarray[2, N] : Pixel coordinates of the given points for the output image described by the parameters</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: <span class="sd">	&lt;------------------- float         : Scale factor from pixels to metric (pixels × scale_factor = metric. If flip_x or flip_y are set, don’t forget to flip it back beforhand, scale_factor * (height-y) or scale_factor * (width-x)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>: 	<span class="n">output_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="n">target_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_target_points, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_output_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">scale_factor</span> <span class="o">=</span> <span class="n">_target_to_output</span><span class="p">(</span><span class="n">target_points</span><span class="p">,</span> <span class="n">output_points</span><span class="p">,</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">x_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">x_range</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">y_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">y_range</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">output_size_y</span><span class="p">,</span> <span class="n">flip_x</span><span class="p">,</span> <span class="n">flip_y</span><span class="p">)</span></pre>
<pre class='cython code score-4 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_target_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 286, __pyx_L1_error)</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_output_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 286, __pyx_L1_error)</span>
  __pyx_v_scale_factor = __pyx_f_9fish2bird__target_to_output(__pyx_t_6, __pyx_t_7, ((double)__pyx_v_x_range.f0), ((double)__pyx_v_x_range.f1), ((double)__pyx_v_y_range.f0), ((double)__pyx_v_y_range.f1), __pyx_v_output_size_y, __pyx_v_flip_x, __pyx_v_flip_y);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL; __pyx_t_6.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  __pyx_t_7.memview = NULL; __pyx_t_7.data = NULL;
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">287</span>: 	<span class="k">return</span> <span class="n">output_points</span><span class="p">,</span> <span class="n">scale_factor</span></pre>
<pre class='cython code score-14 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_scale_factor);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 287, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 287, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_output_points);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_output_points);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_v_output_points);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">288</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">290</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">291</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">292</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">293</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_to_birdeye</span><span class="p">(</span><span class="n">uint8_t</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">image</span><span class="p">,</span> <span class="n">uint8_t</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">birdeye</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_max</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_max</span><span class="p">,</span> <span class="nb">int</span> <span class="n">output_size_x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">output_size_y</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">interpolate</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_x</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_y</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>static void __pyx_f_9fish2bird__to_birdeye(__Pyx_memviewslice __pyx_v_image, __Pyx_memviewslice __pyx_v_birdeye, __Pyx_memviewslice __pyx_v_camera_to_image, __Pyx_memviewslice __pyx_v_target_to_camera, double __pyx_v_xi, double __pyx_v_x_range_min, CYTHON_UNUSED double __pyx_v_x_range_max, double __pyx_v_y_range_min, double __pyx_v_y_range_max, int __pyx_v_output_size_x, int __pyx_v_output_size_y, int __pyx_v_interpolate, int __pyx_v_flip_x, int __pyx_v_flip_y) {
  CYTHON_UNUSED Py_ssize_t __pyx_v_image_width;
  CYTHON_UNUSED Py_ssize_t __pyx_v_image_height;
  Py_ssize_t __pyx_v_output_x;
  Py_ssize_t __pyx_v_output_y;
  double __pyx_v_target_x;
  double __pyx_v_target_y;
  double __pyx_v_camera_x;
  double __pyx_v_camera_y;
  double __pyx_v_camera_z;
  double __pyx_v_projected_x;
  double __pyx_v_projected_y;
  double __pyx_v_projection_norm;
  double __pyx_v_image_x;
  double __pyx_v_image_y;
  double __pyx_v_scale_factor;
  double __pyx_v_x_factor;
  double __pyx_v_y_factor;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  #ifdef WITH_THREAD
  __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._to_birdeye", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">294</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Internal : Project the input image from the camera into bird-eye view along the (x, y) plane of the target frame. See `to_birdeye`&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">x</span><span class="p">,</span> <span class="nf">y</span><span class="p">,</span> <span class="nf">image_width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">image_height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_image_width = (__pyx_v_image.shape[1]);
  __pyx_v_image_height = (__pyx_v_image.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">296</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">output_x</span><span class="p">,</span> <span class="nf">output_y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">target_x</span><span class="p">,</span> <span class="nf">target_y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">298</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">camera_x</span><span class="p">,</span> <span class="nf">camera_y</span><span class="p">,</span> <span class="nf">camera_z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">299</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">projected_x</span><span class="p">,</span> <span class="nf">projected_y</span><span class="p">,</span> <span class="nf">projection_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">image_x</span><span class="p">,</span> <span class="nf">image_y</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_range_max</span> <span class="o">-</span> <span class="n">y_range_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">output_size_y</span></pre>
<pre class='cython code score-0 '>  __pyx_v_scale_factor = ((__pyx_v_y_range_max - __pyx_v_y_range_min) / ((double)__pyx_v_output_size_y));
</pre><pre class="cython line score-0">&#xA0;<span class="">302</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x_factor</span><span class="p">,</span> <span class="nf">y_factor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: 	<span class="c"># Here the problem is kinda reversed : we take each point of the final bird-eye view,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">305</span>: 	<span class="c"># and see which point of the original image it projects onto</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>: 	<span class="c"># Then that bird-eye view pixel is assigned the value at that point of the original image, with bilinear interpolation if needed</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>: 	<span class="k">for</span> <span class="n">output_y</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">birdeye</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-2 '>  if (unlikely(!__pyx_v_birdeye.memview)) { <span class='pyx_c_api'>__Pyx_RaiseUnboundMemoryviewSliceNogil</span>("birdeye"); <span class='error_goto'>__PYX_ERR(0, 307, __pyx_L1_error)</span> }
  __pyx_t_1 = (__pyx_v_birdeye.shape[0]);
  {
      #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
          #undef likely
          #undef unlikely
          #define likely(x)   (x)
          #define unlikely(x) (x)
      #endif
      __pyx_t_3 = (__pyx_t_1 - 0 + 1 - 1/abs(1)) / 1;
      if (__pyx_t_3 &gt; 0)
      {
          #ifdef _OPENMP
          #pragma omp parallel
          #endif /* _OPENMP */
          {
              #ifdef _OPENMP
              #pragma omp for lastprivate(__pyx_v_camera_x) lastprivate(__pyx_v_camera_y) lastprivate(__pyx_v_camera_z) lastprivate(__pyx_v_image_x) lastprivate(__pyx_v_image_y) lastprivate(__pyx_v_output_x) firstprivate(__pyx_v_output_y) lastprivate(__pyx_v_output_y) lastprivate(__pyx_v_projected_x) lastprivate(__pyx_v_projected_y) lastprivate(__pyx_v_projection_norm) lastprivate(__pyx_v_target_x) lastprivate(__pyx_v_target_y) lastprivate(__pyx_v_x_factor) lastprivate(__pyx_v_y_factor)
              #endif /* _OPENMP */
              for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_3; __pyx_t_2++){
                  {
                      __pyx_v_output_y = (Py_ssize_t)(0 + 1 * __pyx_t_2);
                      /* Initialize private variables to invalid values */
                      __pyx_v_camera_x = ((double)__PYX_NAN());
                      __pyx_v_camera_y = ((double)__PYX_NAN());
                      __pyx_v_camera_z = ((double)__PYX_NAN());
                      __pyx_v_image_x = ((double)__PYX_NAN());
                      __pyx_v_image_y = ((double)__PYX_NAN());
                      __pyx_v_output_x = ((Py_ssize_t)0xbad0bad0);
                      __pyx_v_projected_x = ((double)__PYX_NAN());
                      __pyx_v_projected_y = ((double)__PYX_NAN());
                      __pyx_v_projection_norm = ((double)__PYX_NAN());
                      __pyx_v_target_x = ((double)__PYX_NAN());
                      __pyx_v_target_y = ((double)__PYX_NAN());
                      __pyx_v_x_factor = ((double)__PYX_NAN());
                      __pyx_v_y_factor = ((double)__PYX_NAN());
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>: 		<span class="k">for</span> <span class="n">output_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">birdeye</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>                      __pyx_t_4 = (__pyx_v_birdeye.shape[1]);
                      __pyx_t_5 = __pyx_t_4;
                      for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
                        __pyx_v_output_x = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">309</span>: 			<span class="c"># Get the metric point on the target plane corresponding to that point</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>: 			<span class="k">if</span> <span class="n">flip_x</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                        if (__pyx_v_flip_x) {
/* … */
                          goto __pyx_L9;
                        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>: 				<span class="n">target_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_size_x</span> <span class="o">-</span> <span class="n">output_x</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">+</span> <span class="n">x_range_min</span></pre>
<pre class='cython code score-0 '>                          __pyx_v_target_x = (((__pyx_v_output_size_x - __pyx_v_output_x) * __pyx_v_scale_factor) + __pyx_v_x_range_min);
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>: 			<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>: 				<span class="n">target_x</span> <span class="o">=</span> <span class="n">output_x</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">+</span> <span class="n">x_range_min</span></pre>
<pre class='cython code score-0 '>                        /*else*/ {
                          __pyx_v_target_x = ((__pyx_v_output_x * __pyx_v_scale_factor) + __pyx_v_x_range_min);
                        }
                        __pyx_L9:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">314</span>: 			<span class="k">if</span> <span class="n">flip_y</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                        if (__pyx_v_flip_y) {
/* … */
                          goto __pyx_L10;
                        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>: 				<span class="n">target_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_size_y</span> <span class="o">-</span> <span class="n">output_y</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">+</span> <span class="n">y_range_min</span></pre>
<pre class='cython code score-0 '>                          __pyx_v_target_y = (((__pyx_v_output_size_y - __pyx_v_output_y) * __pyx_v_scale_factor) + __pyx_v_y_range_min);
</pre><pre class="cython line score-0">&#xA0;<span class="">316</span>: 			<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">317</span>: 				<span class="n">target_y</span> <span class="o">=</span> <span class="n">output_y</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">+</span> <span class="n">y_range_min</span></pre>
<pre class='cython code score-0 '>                        /*else*/ {
                          __pyx_v_target_y = ((__pyx_v_output_y * __pyx_v_scale_factor) + __pyx_v_y_range_min);
                        }
                        __pyx_L10:;
</pre><pre class="cython line score-0">&#xA0;<span class="">318</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">319</span>: 			<span class="c"># Matrix product, target_to_camera @ (target_x, target_y, target_z) -&gt; camera frame</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">320</span>: 			<span class="n">camera_z</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_7 = 2;
                        __pyx_t_8 = 0;
                        __pyx_t_9 = 2;
                        __pyx_t_10 = 1;
                        __pyx_t_11 = 2;
                        __pyx_t_12 = 3;
                        __pyx_v_camera_z = (((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_7 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_8 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_9 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_10 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_11 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_12 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">321</span>: 			<span class="k">if</span> <span class="n">camera_z</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_13 = (__pyx_v_camera_z &lt; 0.0);
                        if (__pyx_t_13) {
/* … */
                        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">322</span>: 				<span class="n">birdeye</span><span class="p">[</span><span class="n">output_y</span><span class="p">,</span> <span class="n">output_x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>                          __pyx_t_12 = __pyx_v_output_y;
                          __pyx_t_11 = __pyx_v_output_x;
                          *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_birdeye.data + __pyx_t_12 * __pyx_v_birdeye.strides[0]) )) + __pyx_t_11)) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">323</span>: 				<span class="k">continue</span></pre>
<pre class='cython code score-0 '>                          goto __pyx_L7_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">324</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">325</span>: 			<span class="n">camera_x</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_11 = 0;
                        __pyx_t_12 = 0;
                        __pyx_t_10 = 0;
                        __pyx_t_9 = 1;
                        __pyx_t_8 = 0;
                        __pyx_t_7 = 3;
                        __pyx_v_camera_x = (((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_11 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_12 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_10 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_9 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_8 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_7 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">326</span>: 			<span class="n">camera_y</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_7 = 1;
                        __pyx_t_8 = 0;
                        __pyx_t_9 = 1;
                        __pyx_t_10 = 1;
                        __pyx_t_12 = 1;
                        __pyx_t_11 = 3;
                        __pyx_v_camera_y = (((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_7 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_8 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_9 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_10 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_12 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_11 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">327</span>: 			<span class="n">projection_norm</span> <span class="o">=</span>  <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">camera_z</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">camera_x</span><span class="o">*</span><span class="n">camera_x</span> <span class="o">+</span> <span class="n">camera_y</span><span class="o">*</span><span class="n">camera_y</span> <span class="o">+</span> <span class="n">camera_z</span><span class="o">*</span><span class="n">camera_z</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>                        __pyx_v_projection_norm = (1.0 / (__pyx_v_camera_z + (__pyx_v_xi * sqrt((((__pyx_v_camera_x * __pyx_v_camera_x) + (__pyx_v_camera_y * __pyx_v_camera_y)) + (__pyx_v_camera_z * __pyx_v_camera_z))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">328</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>: 			<span class="c"># Project on the sensor plane</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>: 			<span class="n">projected_x</span> <span class="o">=</span> <span class="n">camera_x</span> <span class="o">*</span> <span class="n">projection_norm</span></pre>
<pre class='cython code score-0 '>                        __pyx_v_projected_x = (__pyx_v_camera_x * __pyx_v_projection_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>: 			<span class="n">projected_y</span> <span class="o">=</span> <span class="n">camera_y</span> <span class="o">*</span> <span class="n">projection_norm</span></pre>
<pre class='cython code score-0 '>                        __pyx_v_projected_y = (__pyx_v_camera_y * __pyx_v_projection_norm);
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>: 			<span class="c"># Convert to pixel coordinates (matrix product, camera_to_image @ (projected_x, projected_y))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>: 			<span class="n">image_x</span> <span class="o">=</span> <span class="n">projected_x</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_11 = 0;
                        __pyx_t_12 = 0;
                        __pyx_t_10 = 0;
                        __pyx_t_9 = 1;
                        __pyx_t_8 = 0;
                        __pyx_t_7 = 2;
                        __pyx_v_image_x = (((__pyx_v_projected_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_11 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_12 * __pyx_v_camera_to_image.strides[1]) )))) + (__pyx_v_projected_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_10 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_image.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_8 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_7 * __pyx_v_camera_to_image.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">335</span>: 			<span class="n">image_y</span> <span class="o">=</span> <span class="n">projected_x</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_7 = 1;
                        __pyx_t_8 = 0;
                        __pyx_t_9 = 1;
                        __pyx_t_10 = 1;
                        __pyx_t_12 = 1;
                        __pyx_t_11 = 2;
                        __pyx_v_image_y = (((__pyx_v_projected_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_7 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_image.strides[1]) )))) + (__pyx_v_projected_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_9 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_10 * __pyx_v_camera_to_image.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_12 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_11 * __pyx_v_camera_to_image.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">336</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">337</span>: 			<span class="k">if</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">image_x</span> <span class="ow">and</span> <span class="n">image_x</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="ow">and</span> <span class="mf">0</span> <span class="o">&lt;=</span> <span class="n">image_y</span> <span class="ow">and</span> <span class="n">image_y</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>                        __pyx_t_14 = (0.0 &lt;= __pyx_v_image_x);
                        if (__pyx_t_14) {
                        } else {
                          __pyx_t_13 = __pyx_t_14;
                          goto __pyx_L13_bool_binop_done;
                        }
                        __pyx_t_14 = (__pyx_v_image_x &lt; (__pyx_v_image.shape[1]));
                        if (__pyx_t_14) {
                        } else {
                          __pyx_t_13 = __pyx_t_14;
                          goto __pyx_L13_bool_binop_done;
                        }
                        __pyx_t_14 = (0.0 &lt;= __pyx_v_image_y);
                        if (__pyx_t_14) {
                        } else {
                          __pyx_t_13 = __pyx_t_14;
                          goto __pyx_L13_bool_binop_done;
                        }
                        __pyx_t_14 = (__pyx_v_image_y &lt; (__pyx_v_image.shape[0]));
                        __pyx_t_13 = __pyx_t_14;
                        __pyx_L13_bool_binop_done:;
                        if (__pyx_t_13) {
/* … */
                          goto __pyx_L12;
                        }
</pre><pre class="cython line score-0">&#xA0;<span class="">338</span>: 				<span class="c"># Without interpolation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">339</span>: 				<span class="k">if</span> <span class="ow">not</span> <span class="n">interpolate</span> <span class="ow">or</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_x</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">floor</span><span class="p">(</span><span class="n">image_x</span><span class="p">)</span> <span class="o">==</span> <span class="n">image_x</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                          __pyx_t_14 = (!__pyx_v_interpolate);
                          if (!__pyx_t_14) {
                          } else {
                            __pyx_t_13 = __pyx_t_14;
                            goto __pyx_L18_bool_binop_done;
                          }
                          __pyx_t_14 = (ceil(__pyx_v_image_x) &gt;= (__pyx_v_image.shape[1]));
                          if (!__pyx_t_14) {
                          } else {
                            __pyx_t_13 = __pyx_t_14;
                            goto __pyx_L18_bool_binop_done;
                          }
                          __pyx_t_14 = (ceil(__pyx_v_image_y) &gt;= (__pyx_v_image.shape[0]));
                          if (!__pyx_t_14) {
                          } else {
                            __pyx_t_13 = __pyx_t_14;
                            goto __pyx_L18_bool_binop_done;
                          }
                          __pyx_t_14 = (floor(__pyx_v_image_x) == __pyx_v_image_x);
                          __pyx_t_13 = __pyx_t_14;
                          __pyx_L18_bool_binop_done:;
                          if (__pyx_t_13) {
/* … */
                            goto __pyx_L17;
                          }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">340</span>: 					<span class="n">birdeye</span><span class="p">[</span><span class="n">output_y</span><span class="p">,</span> <span class="n">output_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_y</span><span class="p">),</span> <span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_x</span><span class="p">)]</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_11 = ((Py_ssize_t)floor(__pyx_v_image_y));
                            __pyx_t_12 = ((Py_ssize_t)floor(__pyx_v_image_x));
                            __pyx_t_10 = __pyx_v_output_y;
                            __pyx_t_9 = __pyx_v_output_x;
                            *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_birdeye.data + __pyx_t_10 * __pyx_v_birdeye.strides[0]) )) + __pyx_t_9)) )) = (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_image.data + __pyx_t_11 * __pyx_v_image.strides[0]) )) + __pyx_t_12)) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">341</span>: 				<span class="c"># With interpolation</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>: 				<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">343</span>: 					<span class="n">x_factor</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">image_x</span></pre>
<pre class='cython code score-0 '>                          /*else*/ {
                            __pyx_v_x_factor = (ceil(__pyx_v_image_x) - __pyx_v_image_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">344</span>: 					<span class="n">y_factor</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">image_y</span></pre>
<pre class='cython code score-0 '>                            __pyx_v_y_factor = (ceil(__pyx_v_image_y) - __pyx_v_image_y);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">345</span>: 					<span class="n">birdeye</span><span class="p">[</span><span class="n">output_y</span><span class="p">,</span> <span class="n">output_x</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">uint8_t</span><span class="o">&gt;</span><span class="p">(</span>     <span class="n">x_factor</span>  <span class="o">*</span> <span class="p">(</span>     <span class="n">y_factor</span>  <span class="o">*</span> <span class="n">image</span><span class="p">[</span><span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_y</span><span class="p">),</span> <span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_x</span><span class="p">)]</span> <span class="o">+</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_12 = ((Py_ssize_t)floor(__pyx_v_image_y));
                            __pyx_t_11 = ((Py_ssize_t)floor(__pyx_v_image_x));
/* … */
                            __pyx_t_17 = __pyx_v_output_y;
                            __pyx_t_18 = __pyx_v_output_x;
                            *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_birdeye.data + __pyx_t_17 * __pyx_v_birdeye.strides[0]) )) + __pyx_t_18)) )) = ((__pyx_t_5numpy_uint8_t)((__pyx_v_x_factor * ((__pyx_v_y_factor * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_image.data + __pyx_t_12 * __pyx_v_image.strides[0]) )) + __pyx_t_11)) )))) + ((1.0 - __pyx_v_y_factor) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_image.data + __pyx_t_9 * __pyx_v_image.strides[0]) )) + __pyx_t_10)) )))))) + ((1.0 - __pyx_v_x_factor) * ((__pyx_v_y_factor * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_image.data + __pyx_t_8 * __pyx_v_image.strides[0]) )) + __pyx_t_7)) )))) + ((1.0 - __pyx_v_y_factor) * (*((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_image.data + __pyx_t_15 * __pyx_v_image.strides[0]) )) + __pyx_t_16)) ))))))));
                          }
                          __pyx_L17:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">346</span>: 					                                                          <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">y_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">image</span><span class="p">[</span><span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_y</span><span class="p">),</span> <span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_x</span><span class="p">)])</span> <span class="o">+</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_9 = ((Py_ssize_t)ceil(__pyx_v_image_y));
                            __pyx_t_10 = ((Py_ssize_t)floor(__pyx_v_image_x));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">347</span>: 					                                        <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">x_factor</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>     <span class="n">y_factor</span>  <span class="o">*</span> <span class="n">image</span><span class="p">[</span><span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span><span class="n">floor</span><span class="p">(</span><span class="n">image_y</span><span class="p">),</span> <span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_x</span><span class="p">)]</span> <span class="o">+</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_8 = ((Py_ssize_t)floor(__pyx_v_image_y));
                            __pyx_t_7 = ((Py_ssize_t)ceil(__pyx_v_image_x));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">348</span>: 					                                                          <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">y_factor</span><span class="p">)</span> <span class="o">*</span> <span class="n">image</span><span class="p">[</span><span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_y</span><span class="p">),</span> <span class="o">&lt;</span><span class="nb">Py_ssize_t</span><span class="o">&gt;</span> <span class="n">ceil</span><span class="p">(</span><span class="n">image_x</span><span class="p">)]))</span></pre>
<pre class='cython code score-0 '>                            __pyx_t_15 = ((Py_ssize_t)ceil(__pyx_v_image_y));
                            __pyx_t_16 = ((Py_ssize_t)ceil(__pyx_v_image_x));
</pre><pre class="cython line score-0">&#xA0;<span class="">349</span>: 			<span class="c"># Outside of the image, no data</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: 			<span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>: 				<span class="n">birdeye</span><span class="p">[</span><span class="n">output_y</span><span class="p">,</span> <span class="n">output_x</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>                        /*else*/ {
                          __pyx_t_16 = __pyx_v_output_y;
                          __pyx_t_15 = __pyx_v_output_x;
                          *((__pyx_t_5numpy_uint8_t *) ( /* dim=1 */ ((char *) (((__pyx_t_5numpy_uint8_t *) ( /* dim=0 */ (__pyx_v_birdeye.data + __pyx_t_16 * __pyx_v_birdeye.strides[0]) )) + __pyx_t_15)) )) = 0;
                        }
                        __pyx_L12:;
                        __pyx_L7_continue:;
                      }
                  }
              }
          }
      }
  }
  #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
      #undef likely
      #undef unlikely
      #define likely(x)   __builtin_expect(!!(x), 1)
      #define unlikely(x) __builtin_expect(!!(x), 0)
  #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-220" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>: <span class="k">def</span> <span class="nf">to_birdeye</span><span class="p">(</span><span class="n">uint8_t</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">image</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">,</span> <span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span> <span class="n">x_range</span><span class="p">,</span> <span class="p">(</span><span class="n">double</span><span class="p">,</span> <span class="n">double</span><span class="p">)</span> <span class="n">y_range</span><span class="p">,</span> <span class="nb">int</span> <span class="n">output_size_y</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">interpolate</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_x</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_y</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre>
<pre class='cython code score-220 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_17to_birdeye(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_16to_birdeye, "Directly creates a bird-eye view from an image\n\t   - image            : ndarray[y, x] : Original image\n\t   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates\n\t   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points\342\200\231 Z coordinate is null\n\t   - xi               : float         : Mei\342\200\231s model center shifting parameter (\316\276 in his paper)\n\t   - x_range          : [xmin, xmax]  : Metric range to display on the image\342\200\231s x axis (for instance, [-25, 25] makes an image that shows all points within 25 meters on each side of the origin)\n\t   - y_range          : [ymin, ymax]  : Metric range to display on the image\342\200\231s y axis (for instance, [0, 50] makes an image that shows all points from the origin to 50 meters forward)\n\t   - output_size_y    : int           : Height of the output image in pixels. The width is calculated accordingly to scale points right\n\t   - interpolate=True : bool          : If `True, apply bilinear interpolation to bird-eye view pixels, otherwise nearest-neighbor\n\t   - flip_x=False     : bool          : If `True`, reverse the X axis\n\t   - flip_y=False     : bool          : If `True`, reverse the Y axis\n\t&lt;---------------------- ndarray[y, x] : Resulting bird-eye view image (with bilinear interpolation)\n\t&lt;---------------------- float         : Scale factor from pixels to metric (pixels \303\227 scale_factor = metric. If flip_x or flip_y are set, don\342\200\231t forget to flip it back beforhand, scale_factor * (height-y) or scale_factor * (width-x)");
static PyMethodDef __pyx_mdef_9fish2bird_17to_birdeye = {"to_birdeye", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_17to_birdeye, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_16to_birdeye};
static PyObject *__pyx_pw_9fish2bird_17to_birdeye(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_image = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_camera_to_image = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_target_to_camera = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_xi;
  __pyx_ctuple_double__and_double __pyx_v_x_range;
  __pyx_ctuple_double__and_double __pyx_v_y_range;
  int __pyx_v_output_size_y;
  int __pyx_v_interpolate;
  int __pyx_v_flip_x;
  int __pyx_v_flip_y;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("to_birdeye (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_image,&amp;__pyx_n_s_camera_to_image,&amp;__pyx_n_s_target_to_camera,&amp;__pyx_n_s_xi,&amp;__pyx_n_s_x_range,&amp;__pyx_n_s_y_range,&amp;__pyx_n_s_output_size_y,&amp;__pyx_n_s_interpolate,&amp;__pyx_n_s_flip_x,&amp;__pyx_n_s_flip_y,0};
    PyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 1); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_to_camera)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 2); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xi)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 3); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 4); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 5); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_output_size_y)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, 6); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_interpolate);
          if (value) { values[7] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_x);
          if (value) { values[8] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_y);
          if (value) { values[9] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "to_birdeye") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case 10: values[9] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 6);
        values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_image = __Pyx_PyObject_to_MemoryviewSlice_d_dc_nn___pyx_t_5numpy_uint8_t(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_image.memview)) __PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_camera_to_image = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_camera_to_image.memview)) __PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_target_to_camera = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_target_to_camera.memview)) __PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_xi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_xi == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_x_range = <span class='pyx_c_api'>__pyx_convert__from_py___pyx_ctuple_double__and_double</span>(values[4]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_y_range = <span class='pyx_c_api'>__pyx_convert__from_py___pyx_ctuple_double__and_double</span>(values[5]);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 354, __pyx_L3_error)</span>
    __pyx_v_output_size_y = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[6]); if (unlikely((__pyx_v_output_size_y == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
    if (values[7]) {
      __pyx_v_interpolate = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[7]); if (unlikely((__pyx_v_interpolate == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
    } else {
      __pyx_v_interpolate = ((int)((int)1));
    }
    if (values[8]) {
      __pyx_v_flip_x = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[8]); if (unlikely((__pyx_v_flip_x == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
    } else {
      __pyx_v_flip_x = ((int)((int)0));
    }
    if (values[9]) {
      __pyx_v_flip_y = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[9]); if (unlikely((__pyx_v_flip_y == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
    } else {
      __pyx_v_flip_y = ((int)((int)0));
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("to_birdeye", 0, 7, 10, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
  __pyx_L3_error:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_to_camera, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.to_birdeye", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_16to_birdeye(__pyx_self, __pyx_v_image, __pyx_v_camera_to_image, __pyx_v_target_to_camera, __pyx_v_xi, __pyx_v_x_range, __pyx_v_y_range, __pyx_v_output_size_y, __pyx_v_interpolate, __pyx_v_flip_x, __pyx_v_flip_y);

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_to_camera, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_16to_birdeye(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_image, __Pyx_memviewslice __pyx_v_camera_to_image, __Pyx_memviewslice __pyx_v_target_to_camera, double __pyx_v_xi, __pyx_ctuple_double__and_double __pyx_v_x_range, __pyx_ctuple_double__and_double __pyx_v_y_range, int __pyx_v_output_size_y, int __pyx_v_interpolate, int __pyx_v_flip_x, int __pyx_v_flip_y) {
  double __pyx_v_x_range_min;
  double __pyx_v_x_range_max;
  double __pyx_v_y_range_min;
  double __pyx_v_y_range_max;
  int __pyx_v_output_size_x;
  PyObject *__pyx_v_output_image = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("to_birdeye", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.to_birdeye", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_output_image);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__39 = <span class='py_c_api'>PyTuple_Pack</span>(16, __pyx_n_s_image, __pyx_n_s_camera_to_image, __pyx_n_s_target_to_camera, __pyx_n_s_xi, __pyx_n_s_x_range, __pyx_n_s_y_range, __pyx_n_s_output_size_y, __pyx_n_s_interpolate, __pyx_n_s_flip_x, __pyx_n_s_flip_y, __pyx_n_s_x_range_min, __pyx_n_s_x_range_max, __pyx_n_s_y_range_min, __pyx_n_s_y_range_max, __pyx_n_s_output_size_x, __pyx_n_s_output_image);<span class='error_goto'> if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__39);
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>(((int)0));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2, __pyx_t_7);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_17to_birdeye, 0, __pyx_n_s_to_birdeye, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__40));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_7, __pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_to_birdeye, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_codeobj__40 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(10, 0, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_to_birdeye, 354, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__40)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">355</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Directly creates a bird-eye view from an image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>: <span class="sd">	   - image            : ndarray[y, x] : Original image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">357</span>: <span class="sd">	   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">358</span>: <span class="sd">	   - camera_to_target : ndarray[4, 4] : Transform matrix from the camera frame to the target frame where all points’ Z coordinate is null</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">359</span>: <span class="sd">	   - xi               : float         : Mei’s model center shifting parameter (ξ in his paper)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">360</span>: <span class="sd">	   - x_range          : [xmin, xmax]  : Metric range to display on the image’s x axis (for instance, [-25, 25] makes an image that shows all points within 25 meters on each side of the origin)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">361</span>: <span class="sd">	   - y_range          : [ymin, ymax]  : Metric range to display on the image’s y axis (for instance, [0, 50] makes an image that shows all points from the origin to 50 meters forward)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">362</span>: <span class="sd">	   - output_size_y    : int           : Height of the output image in pixels. The width is calculated accordingly to scale points right</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">363</span>: <span class="sd">	   - interpolate=True : bool          : If `True, apply bilinear interpolation to bird-eye view pixels, otherwise nearest-neighbor</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>: <span class="sd">	   - flip_x=False     : bool          : If `True`, reverse the X axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>: <span class="sd">	   - flip_y=False     : bool          : If `True`, reverse the Y axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>: <span class="sd">	&lt;---------------------- ndarray[y, x] : Resulting bird-eye view image (with bilinear interpolation)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>: <span class="sd">	&lt;---------------------- float         : Scale factor from pixels to metric (pixels × scale_factor = metric. If flip_x or flip_y are set, don’t forget to flip it back beforhand, scale_factor * (height-y) or scale_factor * (width-x)&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">368</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">x_range_min</span> <span class="o">=</span> <span class="n">x_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">x_range_max</span> <span class="o">=</span> <span class="n">x_range</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">y_range_min</span> <span class="o">=</span> <span class="n">y_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">y_range_max</span> <span class="o">=</span> <span class="n">y_range</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_x_range_min = __pyx_v_x_range.f0;
  __pyx_v_x_range_max = __pyx_v_x_range.f1;
  __pyx_v_y_range_min = __pyx_v_y_range.f0;
  __pyx_v_y_range_max = __pyx_v_y_range.f1;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">369</span>: 	<span class="k">cdef</span> <span class="kt">int</span> <span class="nf">output_size_x</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">output_size_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_range_min</span> <span class="o">-</span> <span class="n">x_range_max</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_range_min</span> <span class="o">-</span> <span class="n">y_range_max</span><span class="p">))</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = (__pyx_v_output_size_y * (__pyx_v_x_range_min - __pyx_v_x_range_max));
  __pyx_t_2 = (__pyx_v_y_range_min - __pyx_v_y_range_max);
  if (unlikely(__pyx_t_2 == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 369, __pyx_L1_error)</span>
  }
  __pyx_v_output_size_x = ((int)(__pyx_t_1 / __pyx_t_2));
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">370</span>: 	<span class="n">output_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">output_size_y</span><span class="p">,</span> <span class="n">output_size_x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span></pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_output_size_y);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_output_size_x);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  __pyx_t_3 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_uint8);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_5, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_output_image = __pyx_t_7;
  __pyx_t_7 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>: 	<span class="n">_to_birdeye</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_image</span><span class="p">,</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x_range_min</span><span class="p">,</span> <span class="n">x_range_max</span><span class="p">,</span> <span class="n">y_range_min</span><span class="p">,</span> <span class="n">y_range_max</span><span class="p">,</span> <span class="n">output_size_x</span><span class="p">,</span> <span class="n">output_size_y</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">flip_x</span><span class="p">,</span> <span class="n">flip_y</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_d_dc_nn___pyx_t_5numpy_uint8_t(__pyx_v_output_image, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 371, __pyx_L1_error)</span>
  __pyx_f_9fish2bird__to_birdeye(__pyx_v_image, __pyx_t_8, __pyx_v_camera_to_image, __pyx_v_target_to_camera, __pyx_v_xi, __pyx_v_x_range_min, __pyx_v_x_range_max, __pyx_v_y_range_min, __pyx_v_y_range_max, __pyx_v_output_size_x, __pyx_v_output_size_y, __pyx_v_interpolate, __pyx_v_flip_x, __pyx_v_flip_y);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_8, 1);
  __pyx_t_8.memview = NULL; __pyx_t_8.data = NULL;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">372</span>: 	<span class="k">return</span> <span class="n">output_image</span><span class="p">,</span> <span class="p">(</span><span class="n">y_range_max</span> <span class="o">-</span> <span class="n">y_range_min</span><span class="p">)</span><span class="o">/</span><span class="n">output_size_y</span></pre>
<pre class='cython code score-19 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_2 = (__pyx_v_y_range_max - __pyx_v_y_range_min);
  if (unlikely(__pyx_v_output_size_y == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    <span class='error_goto'>__PYX_ERR(0, 372, __pyx_L1_error)</span>
  }
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_t_2 / ((double)__pyx_v_output_size_y)));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_output_image);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_output_image);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_v_output_image);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_7);
  __pyx_t_7 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">373</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">374</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">375</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">376</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_birdeye_to_target</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">x_range_max</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_min</span><span class="p">,</span> <span class="n">double</span> <span class="n">y_range_max</span><span class="p">,</span> <span class="nb">int</span> <span class="n">image_height</span><span class="p">,</span> <span class="nb">int</span> <span class="n">image_width</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_x</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">flip_y</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>static void __pyx_f_9fish2bird__birdeye_to_target(__Pyx_memviewslice __pyx_v_points, __Pyx_memviewslice __pyx_v_target_points, double __pyx_v_x_range_min, CYTHON_UNUSED double __pyx_v_x_range_max, double __pyx_v_y_range_min, double __pyx_v_y_range_max, int __pyx_v_image_height, int __pyx_v_image_width, int __pyx_v_flip_x, int __pyx_v_flip_y) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_npoints;
  double __pyx_v_scale_factor;
  double __pyx_v_point_x;
  double __pyx_v_point_y;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  #ifdef WITH_THREAD
  __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._birdeye_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">377</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Internal : Convert pixel coordinates on the bird-eye view to 3D metric points in the target frame. See `birdeye_to_target`&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">npoints</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_points.shape[1]);
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">379</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_range_max</span> <span class="o">-</span> <span class="n">y_range_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">image_height</span></pre>
<pre class='cython code score-9 '>  __pyx_t_1 = (__pyx_v_y_range_max - __pyx_v_y_range_min);
  if (unlikely(__pyx_v_image_height == 0)) {
    #ifdef WITH_THREAD
    PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
    #endif
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
    #ifdef WITH_THREAD
    <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
    #endif
    <span class='error_goto'>__PYX_ERR(0, 379, __pyx_L1_error)</span>
  }
  __pyx_v_scale_factor = (__pyx_t_1 / ((double)__pyx_v_image_height));
</pre><pre class="cython line score-0">&#xA0;<span class="">380</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">point_x</span><span class="p">,</span> <span class="nf">point_y</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">381</span>: 	<span class="c"># This is just scaling and flipping when necessary</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_npoints;
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_i = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">383</span>: 		<span class="n">point_x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_i;
    __pyx_v_point_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_5 * __pyx_v_points.strides[0]) ) + __pyx_t_6 * __pyx_v_points.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">384</span>: 		<span class="n">point_y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_point_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_points.data + __pyx_t_6 * __pyx_v_points.strides[0]) ) + __pyx_t_5 * __pyx_v_points.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>: 		<span class="k">if</span> <span class="n">flip_x</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    if (__pyx_v_flip_x) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">386</span>: 			<span class="n">point_x</span> <span class="o">=</span> <span class="n">image_width</span> <span class="o">-</span> <span class="n">point_x</span></pre>
<pre class='cython code score-0 '>      __pyx_v_point_x = (__pyx_v_image_width - __pyx_v_point_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>: 		<span class="k">if</span> <span class="n">flip_y</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    if (__pyx_v_flip_y) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">388</span>: 			<span class="n">point_y</span> <span class="o">=</span> <span class="n">image_height</span> <span class="o">-</span> <span class="n">point_y</span></pre>
<pre class='cython code score-0 '>      __pyx_v_point_y = (__pyx_v_image_height - __pyx_v_point_y);
</pre><pre class="cython line score-0">&#xA0;<span class="">389</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">390</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_x</span><span class="o">*</span><span class="n">scale_factor</span> <span class="o">+</span> <span class="n">x_range_min</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_5 * __pyx_v_target_points.strides[0]) ) + __pyx_t_6 * __pyx_v_target_points.strides[1]) )) = ((__pyx_v_point_x * __pyx_v_scale_factor) + __pyx_v_x_range_min);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">391</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_y</span><span class="o">*</span><span class="n">scale_factor</span> <span class="o">+</span> <span class="n">y_range_min</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_6 * __pyx_v_target_points.strides[0]) ) + __pyx_t_5 * __pyx_v_target_points.strides[1]) )) = ((__pyx_v_point_y * __pyx_v_scale_factor) + __pyx_v_y_range_min);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">392</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 2;
    __pyx_t_6 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_5 * __pyx_v_target_points.strides[0]) ) + __pyx_t_6 * __pyx_v_target_points.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>: 		<span class="n">target_points</span><span class="p">[</span><span class="mf">3</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 3;
    __pyx_t_5 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_6 * __pyx_v_target_points.strides[0]) ) + __pyx_t_5 * __pyx_v_target_points.strides[1]) )) = 1.0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">394</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">395</span>: </pre>
<pre class="cython line score-113" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>: <span class="k">def</span> <span class="nf">birdeye_to_target</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">image_shape</span><span class="p">,</span> <span class="n">flip_x</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">flip_y</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span></pre>
<pre class='cython code score-113 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_19birdeye_to_target(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_18birdeye_to_target, "Convert pixel points on the bird-eye view to the actual 3D point in the target frame, using the parameters given to to_birdeye\n\t   - points           : ndarray[2, N]   : Pixel coordinates in the bird-eye view to convert\n\t   - x_range          : [xmin, xmax]    : Metric range displayed on the bird-eye view\342\200\231s x axis\n\t   - y_range          : [ymin, ymax]    : Metric range displayed on the bird-eye view\342\200\231s y axis\n\t   - output_shape     : [height, width] : Shape of the bird-eye view in pixels\n\t   - flip_x=False     : bool            : Set to the value given to to_birdeye\n\t   - flip_y=False     : bool            : Set to the value given to to_birdeye\n\t&lt;---------------------- ndarray[4, N]   : Corresponding points in the target frame, as homogeneous vectors in columns");
static PyMethodDef __pyx_mdef_9fish2bird_19birdeye_to_target = {"birdeye_to_target", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_19birdeye_to_target, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_18birdeye_to_target};
static PyObject *__pyx_pw_9fish2bird_19birdeye_to_target(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_points = 0;
  PyObject *__pyx_v_x_range = 0;
  PyObject *__pyx_v_y_range = 0;
  PyObject *__pyx_v_image_shape = 0;
  PyObject *__pyx_v_flip_x = 0;
  PyObject *__pyx_v_flip_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("birdeye_to_target (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_points,&amp;__pyx_n_s_x_range,&amp;__pyx_n_s_y_range,&amp;__pyx_n_s_image_shape,&amp;__pyx_n_s_flip_x,&amp;__pyx_n_s_flip_y,0};
    PyObject* values[6] = {0,0,0,0,0,0};
    values[4] = ((PyObject *)((PyObject *)Py_False));
    values[5] = ((PyObject *)((PyObject *)Py_False));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("birdeye_to_target", 0, 4, 6, 1); <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_range)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("birdeye_to_target", 0, 4, 6, 2); <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_image_shape)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("birdeye_to_target", 0, 4, 6, 3); <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_x);
          if (value) { values[4] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_flip_y);
          if (value) { values[5] = value; kw_args--; }
          else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "birdeye_to_target") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
      }
    } else {
      switch (__pyx_nargs) {
        case  6: values[5] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_points = values[0];
    __pyx_v_x_range = values[1];
    __pyx_v_y_range = values[2];
    __pyx_v_image_shape = values[3];
    __pyx_v_flip_x = values[4];
    __pyx_v_flip_y = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("birdeye_to_target", 0, 4, 6, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.birdeye_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_18birdeye_to_target(__pyx_self, __pyx_v_points, __pyx_v_x_range, __pyx_v_y_range, __pyx_v_image_shape, __pyx_v_flip_x, __pyx_v_flip_y);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_18birdeye_to_target(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_points, PyObject *__pyx_v_x_range, PyObject *__pyx_v_y_range, PyObject *__pyx_v_image_shape, PyObject *__pyx_v_flip_x, PyObject *__pyx_v_flip_y) {
  PyObject *__pyx_v_target_points = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("birdeye_to_target", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.birdeye_to_target", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_target_points);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_points, __pyx_n_s_x_range, __pyx_n_s_y_range, __pyx_n_s_image_shape, __pyx_n_s_flip_x, __pyx_n_s_flip_y, __pyx_n_s_target_points);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
  __pyx_codeobj__42 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(6, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_fish2bird_pyx, __pyx_n_s_birdeye_to_target, 396, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_19birdeye_to_target, 0, __pyx_n_s_birdeye_to_target, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__42));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_CyFunction_SetDefaultsTuple</span>(__pyx_t_7, __pyx_tuple__43);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_birdeye_to_target, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(2, ((PyObject *)Py_False), ((PyObject *)Py_False));<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 396, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
</pre><pre class="cython line score-0">&#xA0;<span class="">397</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Convert pixel points on the bird-eye view to the actual 3D point in the target frame, using the parameters given to to_birdeye</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">398</span>: <span class="sd">	   - points           : ndarray[2, N]   : Pixel coordinates in the bird-eye view to convert</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">399</span>: <span class="sd">	   - x_range          : [xmin, xmax]    : Metric range displayed on the bird-eye view’s x axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: <span class="sd">	   - y_range          : [ymin, ymax]    : Metric range displayed on the bird-eye view’s y axis</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: <span class="sd">	   - output_shape     : [height, width] : Shape of the bird-eye view in pixels</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">402</span>: <span class="sd">	   - flip_x=False     : bool            : Set to the value given to to_birdeye</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">403</span>: <span class="sd">	   - flip_y=False     : bool            : Set to the value given to to_birdeye</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>: <span class="sd">	&lt;---------------------- ndarray[4, N]   : Corresponding points in the target frame, as homogeneous vectors in columns&quot;&quot;&quot;</span></pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">405</span>: 	<span class="n">target_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">4</span><span class="p">,</span> <span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_points, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_int_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 405, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_target_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-90" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">406</span>: 	<span class="n">_birdeye_to_target</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">target_points</span><span class="p">,</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">x_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">x_range</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">y_range</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="p">&lt;</span><span class="kt">double</span><span class="p">&gt;</span><span class="n">y_range</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">image_shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">image_shape</span><span class="p">[</span><span class="mf">1</span><span class="p">],</span> <span class="n">flip_x</span><span class="p">,</span> <span class="n">flip_y</span><span class="p">)</span></pre>
<pre class='cython code score-90 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_target_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x_range, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_8 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_8 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x_range, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_9 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_9 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_y_range, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_y_range, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_11 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_image_shape, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_image_shape, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_12 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_flip_x); if (unlikely((__pyx_t_13 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_flip_y); if (unlikely((__pyx_t_14 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
  __pyx_f_9fish2bird__birdeye_to_target(__pyx_t_6, __pyx_t_7, ((double)__pyx_t_8), ((double)__pyx_t_9), ((double)__pyx_t_10), ((double)__pyx_t_11), __pyx_t_5, __pyx_t_12, __pyx_t_13, __pyx_t_14);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __pyx_t_6.memview = NULL; __pyx_t_6.data = NULL;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  __pyx_t_7.memview = NULL; __pyx_t_7.data = NULL;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>: 	<span class="k">return</span> <span class="n">target_points</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_target_points);
  __pyx_r = __pyx_v_target_points;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">411</span>: <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_target_to_image</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">image_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">)</span> <span class="n">noexcept</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-6 '>static void __pyx_f_9fish2bird__target_to_image(__Pyx_memviewslice __pyx_v_target_points, __Pyx_memviewslice __pyx_v_image_points, __Pyx_memviewslice __pyx_v_target_to_camera, __Pyx_memviewslice __pyx_v_camera_to_image, double __pyx_v_xi) {
  Py_ssize_t __pyx_v_i;
  Py_ssize_t __pyx_v_npoints;
  double __pyx_v_target_x;
  double __pyx_v_target_y;
  double __pyx_v_target_z;
  double __pyx_v_camera_x;
  double __pyx_v_camera_y;
  double __pyx_v_camera_z;
  double __pyx_v_camera_norm;
  double __pyx_v_sphere_x;
  double __pyx_v_sphere_y;
  double __pyx_v_sphere_biased_z;
  double __pyx_v_projected_x;
  double __pyx_v_projected_y;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  #ifdef WITH_THREAD
  __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
  #endif
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("fish2bird._target_to_image", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  #ifdef WITH_THREAD
  <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
  #endif
  __pyx_L0:;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">412</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Internal : Project 3D points in the target frame to image pixel coordinates, like the camera would. See `target_to_image`&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">413</span>: 	<span class="k">cdef</span> <span class="kt">Py_ssize_t</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">npoints</span> <span class="o">=</span> <span class="n">target_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_npoints = (__pyx_v_target_points.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">414</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">target_x</span><span class="p">,</span> <span class="nf">target_y</span><span class="p">,</span> <span class="nf">target_z</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">camera_x</span><span class="p">,</span> <span class="nf">camera_y</span><span class="p">,</span> <span class="nf">camera_z</span><span class="p">,</span> <span class="nf">camera_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>: 	<span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sphere_x</span><span class="p">,</span> <span class="nf">sphere_y</span><span class="p">,</span> <span class="nf">sphere_biased_z</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">417</span>: 	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_npoints;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">418</span>: 		<span class="n">target_x</span> <span class="o">=</span> <span class="n">target_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_target_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_4 * __pyx_v_target_points.strides[0]) ) + __pyx_t_5 * __pyx_v_target_points.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">419</span>: 		<span class="n">target_y</span> <span class="o">=</span> <span class="n">target_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_v_target_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_5 * __pyx_v_target_points.strides[0]) ) + __pyx_t_4 * __pyx_v_target_points.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">420</span>: 		<span class="n">target_z</span> <span class="o">=</span> <span class="n">target_points</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = 2;
    __pyx_t_5 = __pyx_v_i;
    __pyx_v_target_z = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_points.data + __pyx_t_4 * __pyx_v_target_points.strides[0]) ) + __pyx_t_5 * __pyx_v_target_points.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: 		<span class="c"># Matrix product, target_to_camera @ (target_x, target_y, target_z) -&gt; camera frame</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>: 		<span class="n">camera_x</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_z</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_6 = 0;
    __pyx_t_7 = 1;
    __pyx_t_8 = 0;
    __pyx_t_9 = 2;
    __pyx_t_10 = 0;
    __pyx_t_11 = 3;
    __pyx_v_camera_x = ((((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_5 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_4 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_6 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_7 * __pyx_v_target_to_camera.strides[1]) ))))) + (__pyx_v_target_z * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_8 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_9 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_10 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_11 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">424</span>: 		<span class="n">camera_y</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_z</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 1;
    __pyx_t_10 = 0;
    __pyx_t_9 = 1;
    __pyx_t_8 = 1;
    __pyx_t_7 = 1;
    __pyx_t_6 = 2;
    __pyx_t_4 = 1;
    __pyx_t_5 = 3;
    __pyx_v_camera_y = ((((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_11 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_10 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_9 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_8 * __pyx_v_target_to_camera.strides[1]) ))))) + (__pyx_v_target_z * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_7 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_6 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_4 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_5 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">425</span>: 		<span class="n">camera_z</span> <span class="o">=</span> <span class="n">target_x</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_y</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_z</span><span class="o">*</span><span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">target_to_camera</span><span class="p">[</span><span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 2;
    __pyx_t_4 = 0;
    __pyx_t_6 = 2;
    __pyx_t_7 = 1;
    __pyx_t_8 = 2;
    __pyx_t_9 = 2;
    __pyx_t_10 = 2;
    __pyx_t_11 = 3;
    __pyx_v_camera_z = ((((__pyx_v_target_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_5 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_4 * __pyx_v_target_to_camera.strides[1]) )))) + (__pyx_v_target_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_6 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_7 * __pyx_v_target_to_camera.strides[1]) ))))) + (__pyx_v_target_z * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_8 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_9 * __pyx_v_target_to_camera.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_target_to_camera.data + __pyx_t_10 * __pyx_v_target_to_camera.strides[0]) ) + __pyx_t_11 * __pyx_v_target_to_camera.strides[1]) ))));
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">426</span>: 		<span class="n">camera_norm</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">camera_x</span><span class="o">*</span><span class="n">camera_x</span> <span class="o">+</span> <span class="n">camera_y</span><span class="o">*</span><span class="n">camera_y</span> <span class="o">+</span> <span class="n">camera_z</span><span class="o">*</span><span class="n">camera_z</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>    __pyx_t_12 = sqrt((((__pyx_v_camera_x * __pyx_v_camera_x) + (__pyx_v_camera_y * __pyx_v_camera_y)) + (__pyx_v_camera_z * __pyx_v_camera_z)));
    if (unlikely(__pyx_t_12 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>__PYX_ERR(0, 426, __pyx_L1_error)</span>
    }
    __pyx_v_camera_norm = (1.0 / __pyx_t_12);
</pre><pre class="cython line score-0">&#xA0;<span class="">427</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">428</span>: 		<span class="c"># Project on the unit sphere</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>: 		<span class="n">sphere_x</span> <span class="o">=</span> <span class="n">camera_x</span> <span class="o">*</span> <span class="n">camera_norm</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sphere_x = (__pyx_v_camera_x * __pyx_v_camera_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>: 		<span class="n">sphere_y</span> <span class="o">=</span> <span class="n">camera_y</span> <span class="o">*</span> <span class="n">camera_norm</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sphere_y = (__pyx_v_camera_y * __pyx_v_camera_norm);
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">431</span>: 		<span class="n">sphere_biased_z</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">camera_z</span> <span class="o">*</span> <span class="n">camera_norm</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span></pre>
<pre class='cython code score-9 '>    __pyx_t_12 = ((__pyx_v_camera_z * __pyx_v_camera_norm) + __pyx_v_xi);
    if (unlikely(__pyx_t_12 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>__PYX_ERR(0, 431, __pyx_L1_error)</span>
    }
    __pyx_v_sphere_biased_z = (1.0 / __pyx_t_12);
</pre><pre class="cython line score-0">&#xA0;<span class="">432</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">433</span>: 		<span class="c"># Project on the sensor plane</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>: 		<span class="n">projected_x</span> <span class="o">=</span> <span class="n">sphere_x</span> <span class="o">*</span> <span class="n">sphere_biased_z</span></pre>
<pre class='cython code score-0 '>    __pyx_v_projected_x = (__pyx_v_sphere_x * __pyx_v_sphere_biased_z);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">435</span>: 		<span class="n">projected_y</span> <span class="o">=</span> <span class="n">sphere_y</span> <span class="o">*</span> <span class="n">sphere_biased_z</span></pre>
<pre class='cython code score-0 '>    __pyx_v_projected_y = (__pyx_v_sphere_y * __pyx_v_sphere_biased_z);
</pre><pre class="cython line score-0">&#xA0;<span class="">436</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">437</span>: 		<span class="c"># Convert to pixel coordinates (matrix product, camera_to_image @ (projected_x, projected_y))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>: 		<span class="n">image_points</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">projected_x</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = 0;
    __pyx_t_10 = 0;
    __pyx_t_9 = 0;
    __pyx_t_8 = 1;
    __pyx_t_7 = 0;
    __pyx_t_6 = 2;
    __pyx_t_4 = 0;
    __pyx_t_5 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_4 * __pyx_v_image_points.strides[0]) ) + __pyx_t_5 * __pyx_v_image_points.strides[1]) )) = (((__pyx_v_projected_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_11 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_10 * __pyx_v_camera_to_image.strides[1]) )))) + (__pyx_v_projected_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_9 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_8 * __pyx_v_camera_to_image.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_7 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_6 * __pyx_v_camera_to_image.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">439</span>: 		<span class="n">image_points</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">projected_x</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">projected_y</span><span class="o">*</span><span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">camera_to_image</span><span class="p">[</span><span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = 1;
    __pyx_t_7 = 0;
    __pyx_t_8 = 1;
    __pyx_t_9 = 1;
    __pyx_t_10 = 1;
    __pyx_t_11 = 2;
    __pyx_t_5 = 1;
    __pyx_t_4 = __pyx_v_i;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_image_points.data + __pyx_t_5 * __pyx_v_image_points.strides[0]) ) + __pyx_t_4 * __pyx_v_image_points.strides[1]) )) = (((__pyx_v_projected_x * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_6 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_7 * __pyx_v_camera_to_image.strides[1]) )))) + (__pyx_v_projected_y * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_8 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_9 * __pyx_v_camera_to_image.strides[1]) ))))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_camera_to_image.data + __pyx_t_10 * __pyx_v_camera_to_image.strides[0]) ) + __pyx_t_11 * __pyx_v_camera_to_image.strides[1]) ))));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">440</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">441</span>: </pre>
<pre class="cython line score-98" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>: <span class="k">def</span> <span class="nf">target_to_image</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">target_points</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">double</span><span class="p">[:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">double</span> <span class="n">xi</span><span class="p">):</span></pre>
<pre class='cython code score-98 '>/* Python wrapper */
static PyObject *__pyx_pw_9fish2bird_21target_to_image(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
<span class='py_macro_api'>PyDoc_STRVAR</span>(__pyx_doc_9fish2bird_20target_to_image, "Projects 3D points from the target frame to image pixel coordinates, like the camera would\n\t   - target_points    : ndarray[3, N] : Points in the target frame\n\t   - target_to_camera : ndarray[4, 4] : Transform matrix from the target frame to the camera frame\n\t   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates\n\t   - xi               : float         : Mei\342\200\231s model center shifting parameter (\316\276 in his paper)\n\t&lt;---------------------- ndarray[2, N] : Projected points as image pixel coordinates. Those coordinates may not be integers nor within the actual image\n\t");
static PyMethodDef __pyx_mdef_9fish2bird_21target_to_image = {"target_to_image", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9fish2bird_21target_to_image, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9fish2bird_20target_to_image};
static PyObject *__pyx_pw_9fish2bird_21target_to_image(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  __Pyx_memviewslice __pyx_v_target_points = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_target_to_camera = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_camera_to_image = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_xi;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = <span class='pyx_c_api'>__Pyx_KwValues_FASTCALL</span>(__pyx_args, __pyx_nargs);
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("target_to_image (wrapper)", 0);
  {
    PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_target_points,&amp;__pyx_n_s_target_to_camera,&amp;__pyx_n_s_camera_to_image,&amp;__pyx_n_s_xi,0};
    PyObject* values[4] = {0,0,0,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='pyx_c_api'>__Pyx_NumKwargs_FASTCALL</span>(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_points)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_target_to_camera)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_image", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_camera_to_image)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_image", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_GetKwValue_FASTCALL</span>(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xi)) != 0)) kw_args--;
        else if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_image", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "target_to_image") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
      }
    } else if (unlikely(__pyx_nargs != 4)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 0);
      values[1] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 1);
      values[2] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 2);
      values[3] = <span class='pyx_c_api'>__Pyx_Arg_FASTCALL</span>(__pyx_args, 3);
    }
    __pyx_v_target_points = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_target_points.memview)) __PYX_ERR(0, 442, __pyx_L3_error)</span>
    __pyx_v_target_to_camera = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_target_to_camera.memview)) __PYX_ERR(0, 442, __pyx_L3_error)</span>
    __pyx_v_camera_to_image = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_camera_to_image.memview)) __PYX_ERR(0, 442, __pyx_L3_error)</span>
    __pyx_v_xi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]); if (unlikely((__pyx_v_xi == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("target_to_image", 1, 4, 4, __pyx_nargs); <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L3_error)</span>
  __pyx_L3_error:;
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_points, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_to_camera, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.target_to_image", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_9fish2bird_20target_to_image(__pyx_self, __pyx_v_target_points, __pyx_v_target_to_camera, __pyx_v_camera_to_image, __pyx_v_xi);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_points, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_target_to_camera, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_camera_to_image, 1);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_9fish2bird_20target_to_image(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_target_points, __Pyx_memviewslice __pyx_v_target_to_camera, __Pyx_memviewslice __pyx_v_camera_to_image, double __pyx_v_xi) {
  PyObject *__pyx_v_image_points = NULL;
  CYTHON_UNUSED __Pyx_memviewslice __pyx_v_image_points_data = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("target_to_image", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("fish2bird.target_to_image", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_image_points);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_v_image_points_data, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__44 = <span class='py_c_api'>PyTuple_Pack</span>(6, __pyx_n_s_target_points, __pyx_n_s_target_to_camera, __pyx_n_s_camera_to_image, __pyx_n_s_xi, __pyx_n_s_image_points, __pyx_n_s_image_points_data);<span class='error_goto'> if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__44);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__44);
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_CyFunction_New</span>(&amp;__pyx_mdef_9fish2bird_21target_to_image, 0, __pyx_n_s_target_to_image, NULL, __pyx_n_s_fish2bird, __pyx_d, ((PyObject *)__pyx_codeobj__45));<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_target_to_image, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">443</span>: <span class="w">	</span><span class="sd">&quot;&quot;&quot;Projects 3D points from the target frame to image pixel coordinates, like the camera would</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">444</span>: <span class="sd">	   - target_points    : ndarray[3, N] : Points in the target frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">445</span>: <span class="sd">	   - target_to_camera : ndarray[4, 4] : Transform matrix from the target frame to the camera frame</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">446</span>: <span class="sd">	   - camera_to_image  : ndarray[3, 3] : Projection matrix (K) to pixel coordinates</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">447</span>: <span class="sd">	   - xi               : float         : Mei’s model center shifting parameter (ξ in his paper)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>: <span class="sd">	&lt;---------------------- ndarray[2, N] : Projected points as image pixel coordinates. Those coordinates may not be integers nor within the actual image</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">449</span>: <span class="sd">	&quot;&quot;&quot;</span></pre>
<pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>: 	<span class="n">image_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mf">2</span><span class="p">,</span> <span class="n">target_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-33 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_target_points.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 450, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_int_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_4};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_FastCall</span>(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 450, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_image_points = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">451</span>: 	<span class="k">cdef</span> <span class="kt">double</span>[<span class="p">:,</span> <span class="p">::</span><span class="mf">1</span><span class="p">]</span> <span class="n">image_points_data</span> <span class="o">=</span> <span class="n">image_points</span></pre>
<pre class='cython code score-2 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_d_dc_double</span>(__pyx_v_image_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 451, __pyx_L1_error)</span>
  __pyx_v_image_points_data = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">452</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">453</span>: 	<span class="n">_target_to_image</span><span class="p">(</span><span class="n">target_points</span><span class="p">,</span> <span class="n">image_points</span><span class="p">,</span> <span class="n">target_to_camera</span><span class="p">,</span> <span class="n">camera_to_image</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span></pre>
<pre class='cython code score-2 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_v_image_points, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 453, __pyx_L1_error)</span>
  __pyx_f_9fish2bird__target_to_image(__pyx_v_target_points, __pyx_t_7, __pyx_v_target_to_camera, __pyx_v_camera_to_image, __pyx_v_xi);
  __PYX_XCLEAR_MEMVIEW(&amp;__pyx_t_7, 1);
  __pyx_t_7.memview = NULL; __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">454</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>: 	<span class="k">return</span> <span class="n">image_points</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_image_points);
  __pyx_r = __pyx_v_image_points;
  goto __pyx_L0;
</pre></div></body></html>
